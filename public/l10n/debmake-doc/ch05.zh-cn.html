<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>第 5 章 基本内容</title>
    <link rel="stylesheet" type="text/css" href="debian.css"/>
    <meta name="generator" content="DocBook XSL Stylesheets V1.79.1"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <link rel="home" href="index.zh-cn.html" title="Debian 维护者指南"/>
    <link rel="up" href="index.zh-cn.html" title="Debian 维护者指南"/>
    <link rel="prev" href="ch04.zh-cn.html" title="第 4 章 简单例子"/>
    <link rel="next" href="ch06.zh-cn.html" title="第 6 章 debmake 选项"/>
  </head>
  <body>
    <div class="navheader">
      <table width="100%" summary="Navigation header">
        <tr>
          <th colspan="3" align="center">第 5 章 基本内容</th>
        </tr>
        <tr>
          <td align="left"><a accesskey="p" href="ch04.zh-cn.html"><img src="images/prev.png" alt="上一页"/></a> </td>
          <th width="60%" align="center"> </th>
          <td align="right"> <a accesskey="n" href="ch06.zh-cn.html"><img src="images/next.png" alt="下一页"/></a></td>
        </tr>
      </table>
      <hr/>
    </div>
    <div class="chapter">
      <div class="titlepage">
        <div>
          <div>
            <h1 class="title"><a id="basics"/>第 5 章 基本内容</h1>
          </div>
        </div>
      </div>
      <div class="toc">
        <p>
          <strong>目录</strong>
        </p>
        <dl class="toc">
          <dt>
            <span class="section">
              <a href="ch05.zh-cn.html#workflow">5.1. 打包工作流</a>
            </span>
          </dt>
          <dd>
            <dl>
              <dt>
                <span class="section">
                  <a href="ch05.zh-cn.html#debhelper">5.1.1. <span class="strong"><strong>debhelper</strong></span> 软件包</a>
                </span>
              </dt>
            </dl>
          </dd>
          <dt>
            <span class="section">
              <a href="ch05.zh-cn.html#name-version">5.2. 软件包名称和版本</a>
            </span>
          </dt>
          <dt>
            <span class="section">
              <a href="ch05.zh-cn.html#native">5.3. 本土 Debian 软件包</a>
            </span>
          </dt>
          <dt>
            <span class="section">
              <a href="ch05.zh-cn.html#rules">5.4. debian/rules</a>
            </span>
          </dt>
          <dd>
            <dl>
              <dt>
                <span class="section">
                  <a href="ch05.zh-cn.html#dh">5.4.1. dh</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="ch05.zh-cn.html#simplerules">5.4.2. 简单的 debian/rules</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="ch05.zh-cn.html#customrules">5.4.3. 自定义 debian/rules</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="ch05.zh-cn.html#variablesrules">5.4.4. debian/rules 中的变量</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="ch05.zh-cn.html#reproducible">5.4.5. 可重现的构建</a>
                </span>
              </dt>
            </dl>
          </dd>
          <dt>
            <span class="section">
              <a href="ch05.zh-cn.html#control">5.5. debian/control</a>
            </span>
          </dt>
          <dd>
            <dl>
              <dt>
                <span class="section">
                  <a href="ch05.zh-cn.html#split">5.5.1. Debian 二进制软件包的拆分</a>
                </span>
              </dt>
              <dd>
                <dl>
                  <dt>
                    <span class="section">
                      <a href="ch05.zh-cn.html#boption">5.5.1.1. debmake -b</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="ch05.zh-cn.html#package-split-example">5.5.1.2. 拆包的场景和例子</a>
                    </span>
                  </dt>
                  <dt>
                    <span class="section">
                      <a href="ch05.zh-cn.html#libnames">5.5.1.3. 库软件包名称</a>
                    </span>
                  </dt>
                </dl>
              </dd>
              <dt>
                <span class="section">
                  <a href="ch05.zh-cn.html#substvar">5.5.2. Substvar</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="ch05.zh-cn.html#binnmu">5.5.3. binNMU 安全</a>
                </span>
              </dt>
            </dl>
          </dd>
          <dt>
            <span class="section">
              <a href="ch05.zh-cn.html#changelog">5.6. debian/changelog</a>
            </span>
          </dt>
          <dt>
            <span class="section">
              <a href="ch05.zh-cn.html#copyright">5.7. debian/copyright</a>
            </span>
          </dt>
          <dt>
            <span class="section">
              <a href="ch05.zh-cn.html#patches">5.8. debian/patches/*</a>
            </span>
          </dt>
          <dd>
            <dl>
              <dt>
                <span class="section">
                  <a href="ch05.zh-cn.html#dpkg-source-x">5.8.1. dpkg-source -x</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="ch05.zh-cn.html#quilt-dpkg">5.8.2. dquilt 和 dpkg-source</a>
                </span>
              </dt>
            </dl>
          </dd>
          <dt>
            <span class="section">
              <a href="ch05.zh-cn.html#signing-key">5.9. debian/upstream/signing-key.asc</a>
            </span>
          </dt>
          <dt>
            <span class="section">
              <a href="ch05.zh-cn.html#dfsg">5.10. debian/watch 和 DFSG</a>
            </span>
          </dt>
          <dt>
            <span class="section">
              <a href="ch05.zh-cn.html#debianconf">5.11. 其它 debian/* 文件</a>
            </span>
          </dt>
          <dt>
            <span class="section">
              <a href="ch05.zh-cn.html#custom">5.12. Debian 打包的定制化</a>
            </span>
          </dt>
          <dt>
            <span class="section">
              <a href="ch05.zh-cn.html#vcs">5.13. 在版本控制系统中进行记录（标准）</a>
            </span>
          </dt>
          <dt>
            <span class="section">
              <a href="ch05.zh-cn.html#alt-vcs">5.14. 在版本控制系统中进行记录（备选方案）</a>
            </span>
          </dt>
          <dt>
            <span class="section">
              <a href="ch05.zh-cn.html#build-noextra">5.15. 构建软件包时排除不必要的内容</a>
            </span>
          </dt>
          <dd>
            <dl>
              <dt>
                <span class="section">
                  <a href="ch05.zh-cn.html#rules-clean">5.15.1. 使用 debian/rules clean 进行修复</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="ch05.zh-cn.html#git-clean">5.15.2. 使用版本控制系统修复</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="ch05.zh-cn.html#extend-diff-ignore">5.15.3. 使用 extend-diff-ignore 修复</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="ch05.zh-cn.html#tar-ignore">5.15.4. 使用 tar-ignore 修复</a>
                </span>
              </dt>
            </dl>
          </dd>
          <dt>
            <span class="section">
              <a href="ch05.zh-cn.html#build">5.16. 上游构建系统</a>
            </span>
          </dt>
          <dd>
            <dl>
              <dt>
                <span class="section">
                  <a href="ch05.zh-cn.html#autotools">5.16.1. Autotools</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="ch05.zh-cn.html#cmake">5.16.2. CMake</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="ch05.zh-cn.html#distutils">5.16.3. Python distutils</a>
                </span>
              </dt>
            </dl>
          </dd>
          <dt>
            <span class="section">
              <a href="ch05.zh-cn.html#dbg">5.17. 调试信息</a>
            </span>
          </dt>
          <dd>
            <dl>
              <dt>
                <span class="section">
                  <a href="ch05.zh-cn.html#dbgsym">5.17.1. 新的 -dbgsym 软件包（Stretch 9.0 或更新）</a>
                </span>
              </dt>
            </dl>
          </dd>
          <dt>
            <span class="section">
              <a href="ch05.zh-cn.html#lib">5.18. 库软件包</a>
            </span>
          </dt>
          <dd>
            <dl>
              <dt>
                <span class="section">
                  <a href="ch05.zh-cn.html#symbols">5.18.1. 库符号</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="ch05.zh-cn.html#lib-trans">5.18.2. 库变迁</a>
                </span>
              </dt>
            </dl>
          </dd>
          <dt>
            <span class="section">
              <a href="ch05.zh-cn.html#debconf">5.19. debconf</a>
            </span>
          </dt>
          <dt>
            <span class="section">
              <a href="ch05.zh-cn.html#multiarch">5.20. 多体系结构</a>
            </span>
          </dt>
          <dd>
            <dl>
              <dt>
                <span class="section">
                  <a href="ch05.zh-cn.html#_the_multiarch_library_path">5.20.1. 多架构库路径</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="ch05.zh-cn.html#_the_multiarch_header_file_path">5.20.2. 多架构头文件路径</a>
                </span>
              </dt>
              <dt>
                <span class="section">
                  <a href="ch05.zh-cn.html#_the_multiarch_emphasis_role_strong_pc_emphasis_file_path">5.20.3. 多架构支持下的 <span class="strong"><strong>*.pc</strong></span> 文件路径</a>
                </span>
              </dt>
            </dl>
          </dd>
          <dt>
            <span class="section">
              <a href="ch05.zh-cn.html#harden">5.21. 编译加固</a>
            </span>
          </dt>
          <dt>
            <span class="section">
              <a href="ch05.zh-cn.html#ci">5.22. 持续集成</a>
            </span>
          </dt>
          <dt>
            <span class="section">
              <a href="ch05.zh-cn.html#bootstrap">5.23. 自举</a>
            </span>
          </dt>
          <dt>
            <span class="section">
              <a href="ch05.zh-cn.html#bug">5.24. 错误报告</a>
            </span>
          </dt>
        </dl>
      </div>
      <p>这里展示了 Debian 打包工作中针对非本土软件包使用“<span class="strong"><strong>3.0 (quilt)</strong></span>”格式进行打包所遵循基本规则的一个全局性概览。</p>
      <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
        <table border="0" summary="Note">
          <tr>
            <td rowspan="2" align="center" valign="top">
              <img alt="[注意]" src="images/note.png"/>
            </td>
            <th align="left">注意</th>
          </tr>
          <tr>
            <td align="left" valign="top">
              <p>为简明起见，某些细节被有意跳过。请按需查阅对应命令的手册页，例如<span class="strong"><strong>dpkg-source</strong></span>(1)、<span class="strong"><strong>dpkg-buildpackage</strong></span>(1)、<span class="strong"><strong>dpkg</strong></span>(1)、<span class="strong"><strong>dpkg-deb</strong></span>(1)、<span class="strong"><strong>deb</strong></span>(5)，等等。</p>
            </td>
          </tr>
        </table>
      </div>
      <p>Debian 源码包是一组用于构建 Debian 二进制软件包的输入文件，而非单个文件。</p>
      <p>Debian 二进制软件包是一个特殊的档案文件，其中包含了一系列可安装的二进制数据及与它们相关的信息。</p>
      <p>单个 Debian 源码包可能根据 <span class="strong"><strong>debian/control</strong></span> 文件定义的内容产生多个 Debian 二进制软件包。</p>
      <p>使用 “<span class="strong"><strong>3.0 (quilt)</strong></span>”格式的非本土 Debian 软件包是最普通的 Debian 源码包格式。</p>
      <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
        <table border="0" summary="Note">
          <tr>
            <td rowspan="2" align="center" valign="top">
              <img alt="[注意]" src="images/note.png"/>
            </td>
            <th align="left">注意</th>
          </tr>
          <tr>
            <td align="left" valign="top">
              <p>有许多封装脚本可用。合理使用它们可以帮助您理顺工作流程，但是请确保您能理解它们内部的基本工作原理。</p>
            </td>
          </tr>
        </table>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="workflow"/>5.1. 打包工作流</h2>
            </div>
          </div>
        </div>
        <p>创建 Debian 二进制软件包的 Debian 打包工作流涉及创建数个特定名称的文件（参见 <a class="xref" href="ch05.zh-cn.html#name-version" title="5.2. 软件包名称和版本">第 5.2 节 “软件包名称和版本”</a>），与“Debian 政策手册”的定义保持一致。</p>
        <p>一个极其简化的 Debian 打包工作流可以概括为以下五步。</p>
        <div class="orderedlist">
          <ol class="orderedlist">
            <li class="listitem">下载上游源码压缩包（tarball）并命名为 <span class="emphasis"><em>package-version</em></span><span class="strong"><strong>.tar.gz</strong></span> 文件。</li>
            <li class="listitem">使上游提供的源码压缩包解压缩后的所有文件存储在 <span class="emphasis"><em>package-version</em></span><span class="strong"><strong>/</strong></span> 目录中。</li>
            <li class="listitem">
              <p class="simpara">上游的源码压缩包被复制（或符号链接）至一个特定的文件名 <span class="emphasis"><em>packagename_version</em></span><span class="strong"><strong>.orig.tar.gz</strong></span>。</p>
              <div class="itemizedlist">
                <ul class="itemizedlist">
                  <li class="listitem">分隔 <span class="emphasis"><em>package</em></span> 和 <span class="emphasis"><em>version</em></span> 的符号从 <span class="strong"><strong>-</strong></span>（连字符）更改为 <span class="strong"><strong>_</strong></span>（下划线）</li>
                  <li class="listitem">文件扩展名添加了 <span class="strong"><strong>.orig</strong></span> 部分。</li>
                </ul>
              </div>
            </li>
            <li class="listitem">
              <p class="simpara">Debian 软件包规范文件将被添加至上游源代码中，存放在 <span class="emphasis"><em>package-version</em></span><span class="strong"><strong>/debian/</strong></span> 目录下。</p>
              <div class="itemizedlist">
                <ul class="itemizedlist">
                  <li class="listitem">
                    <p class="simpara"><span class="strong"><strong>debian/</strong></span>* 目录下的必需技术说明文件：</p>
                    <div class="variablelist">
                      <dl class="variablelist">
                        <dt>
                          <span class="term">
                            <span class="strong">
                              <strong>debian/rules</strong>
                            </span>
                          </span>
                        </dt>
                        <dd>构建 Debian 软件包所需的可执行脚本（参见 <a class="xref" href="ch05.zh-cn.html#rules" title="5.4. debian/rules">第 5.4 节 “debian/rules”</a>）</dd>
                        <dt>
                          <span class="term">
                            <span class="strong">
                              <strong>debian/control</strong>
                            </span>
                          </span>
                        </dt>
                        <dd>软件包配置文件包含了源码包名称、源码构建依赖、二进制软件包名称、二进制软件包依赖，等等。（参见 <a class="xref" href="ch05.zh-cn.html#control" title="5.5. debian/control">第 5.5 节 “debian/control”</a>）</dd>
                        <dt>
                          <span class="term">
                            <span class="strong">
                              <strong>debian/changelog</strong>
                            </span>
                          </span>
                        </dt>
                        <dd>Debian 软件包历史文件，其中第一行定义了上游软件包版本号和 Debian 修订版本号（参见 <a class="xref" href="ch05.zh-cn.html#changelog" title="5.6. debian/changelog">第 5.6 节 “debian/changelog”</a>）</dd>
                        <dt>
                          <span class="term">
                            <span class="strong">
                              <strong>debian/copyright</strong>
                            </span>
                          </span>
                        </dt>
                        <dd>版权和许可证摘要信息（参看 <a class="xref" href="ch05.zh-cn.html#copyright" title="5.7. debian/copyright">第 5.7 节 “debian/copyright”</a>）</dd>
                      </dl>
                    </div>
                  </li>
                  <li class="listitem">在 <span class="strong"><strong>debian/</strong></span>* 下的可选配置文件（参见 <a class="xref" href="ch05.zh-cn.html#debianconf" title="5.11. 其它 debian/* 文件">第 5.11 节 “其它 debian/* 文件”</a>）：</li>
                  <li class="listitem">
                    <p class="simpara">在 <span class="emphasis"><em>package-version/</em></span> 目录中调用 <span class="strong"><strong>debmake</strong></span> 命令将会提供这些配置文件的一套模板。</p>
                    <div class="itemizedlist">
                      <ul class="itemizedlist">
                        <li class="listitem">必备的配置文件总会生成，无论是否提供 <span class="strong"><strong>-x0</strong></span> 选项。</li>
                        <li class="listitem"><span class="strong"><strong>debmake</strong></span> 命令永远不会覆写任何已经存在的配置文件。</li>
                      </ul>
                    </div>
                  </li>
                  <li class="listitem">这些文件必须手工编辑以达到理想状态。请使用“Debian 政策手册”和“Debian 开发者参考”作为编辑依据。</li>
                </ul>
              </div>
            </li>
            <li class="listitem">
              <p class="simpara"><span class="strong"><strong>dpkg-buildpackage</strong></span> 命令（通常由它的封装命令 <span class="strong"><strong>debuild</strong></span> 或 <span class="strong"><strong>pdebuild</strong></span> 所使用）会在 <span class="emphasis"><em>package-version/</em></span> 目录中被调用，进而以调用 <span class="strong"><strong>debian/rules</strong></span> 脚本的方式制作 Debian 源码包和二进制软件包。</p>
              <div class="itemizedlist">
                <ul class="itemizedlist">
                  <li class="listitem">当前工作目录会被设为：<span class="strong"><strong>$(CURDIR)=</strong></span><span class="emphasis"><em>/path/to/package-version/</em></span></li>
                  <li class="listitem">
                    <p class="simpara">使用 <span class="strong"><strong>dpkg-source</strong></span>(1) 以“<span class="strong"><strong>3.0 (quilt)</strong></span>”格式创建 Debian 源码包</p>
                    <div class="itemizedlist">
                      <ul class="itemizedlist">
                        <li class="listitem"><span class="emphasis"><em>package_version</em></span>.<span class="strong"><strong>orig.tar.gz</strong></span>（<span class="emphasis"><em>package-version</em></span>.<span class="strong"><strong>tar.gz</strong></span> 的副本或符号链接）</li>
                        <li class="listitem"><span class="emphasis"><em>package_version-revision</em></span>.<span class="strong"><strong>debian.tar.xz</strong></span>（<span class="emphasis"><em>package-version</em></span>/<span class="strong"><strong>debian/</strong></span>* 的 tar 压缩包，即 tarball）</li>
                        <li class="listitem"><span class="emphasis"><em>package_version-revision</em></span>.<span class="strong"><strong>dsc</strong></span></li>
                      </ul>
                    </div>
                  </li>
                  <li class="listitem">
                    <p class="simpara">使用“<span class="strong"><strong>debian/rules build</strong></span>”构建源代码并安装到 <span class="strong"><strong>$(DESTDIR)</strong></span> 中</p>
                    <div class="itemizedlist">
                      <ul class="itemizedlist">
                        <li class="listitem"><span class="strong"><strong>DESTDIR=debian</strong></span>/<span class="emphasis"><em>binarypackage/</em></span>（单二进制包）</li>
                        <li class="listitem"><span class="strong"><strong>DESTDIR=debian/tmp/</strong></span>（多个二进制包）</li>
                      </ul>
                    </div>
                  </li>
                  <li class="listitem">
                    <p class="simpara">使用 <span class="strong"><strong>dpkg-deb</strong></span>(1)、<span class="strong"><strong>dpkg-genbuildinfo</strong></span>(1) 和 <span class="strong"><strong>dpkg-genchanges</strong></span>(1) 创建 Debian 二进制软件包。</p>
                    <div class="itemizedlist">
                      <ul class="itemizedlist">
                        <li class="listitem"><span class="emphasis"><em>binarypackage_version-revision_arch</em></span>.<span class="strong"><strong>deb</strong></span></li>
                        <li class="listitem">……（可能有多个 Debian 二进制包文件。）</li>
                        <li class="listitem"><span class="emphasis"><em>package_version-revision_arch</em></span>.<span class="strong"><strong>changes</strong></span></li>
                      </ul>
                    </div>
                  </li>
                </ul>
              </div>
            </li>
            <li class="listitem">
              <p class="simpara">使用 <span class="strong"><strong>lintian</strong></span> 命令检查 Debian 软件包的质量。（推荐）</p>
              <div class="itemizedlist">
                <ul class="itemizedlist">
                  <li class="listitem">
                    <p class="simpara">遵守 <a class="ulink" href="https://ftp-master.debian.org/">ftp-master</a> 的拒绝（rejection）指导方针。</p>
                    <div class="itemizedlist">
                      <ul class="itemizedlist">
                        <li class="listitem">
<a class="ulink" href="https://ftp-master.debian.org/REJECT-FAQ.html">软件包被拒绝常见问题解答（REJECT-FAQ）</a>
</li>
                        <li class="listitem">
<a class="ulink" href="https://ftp-master.debian.org/NEW-checklist.html">新软件包（NEW）检查清单</a>
</li>
                        <li class="listitem"><a class="ulink" href="https://ftp-master.debian.org/#lintianrejects">Lintian 自动拒绝（autoreject）</a>（<a class="ulink" href="https://ftp-master.debian.org/static/lintian.tags">lintian 标签列表</a>）</li>
                      </ul>
                    </div>
                  </li>
                </ul>
              </div>
            </li>
            <li class="listitem">使用 <span class="strong"><strong>debsign</strong></span> 命令，用您的 GPG 私钥为 <span class="emphasis"><em>package_version-revision</em></span>.<span class="strong"><strong>dsc</strong></span> 和 <span class="emphasis"><em>package_version-revision_arch</em></span>.<span class="strong"><strong>changes</strong></span> 文件进行签名。</li>
            <li class="listitem">使用 <span class="strong"><strong>dput</strong></span> 命令向 Debian 仓库上传一套 Debian 源码包和二进制软件包文件。</li>
          </ol>
        </div>
        <p>这里，请将文件名中对应的部分使用下面的方式进行替换：</p>
        <div class="itemizedlist">
          <ul class="itemizedlist">
            <li class="listitem">将 <span class="emphasis"><em>package</em></span> 部分替换为 Debian 源码包名称</li>
            <li class="listitem">将 <span class="emphasis"><em>binarypackage</em></span> 部分替换为 Debian 二进制软件包名称</li>
            <li class="listitem">将 <span class="emphasis"><em>version</em></span> 部分替换为上游版本号</li>
            <li class="listitem">将 <span class="emphasis"><em>revision</em></span> 部分替换为 Debian 修订号</li>
            <li class="listitem">将 <span class="emphasis"><em>arch</em></span> 部分替换为软件包对应架构</li>
          </ul>
        </div>
        <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">
          <table border="0" summary="Tip">
            <tr>
              <td rowspan="2" align="center" valign="top">
                <img alt="[提示]" src="images/tip.png"/>
              </td>
              <th align="left">提示</th>
            </tr>
            <tr>
              <td align="left" valign="top">
                <p>有很多种通过实践摸索而得到的补丁管理方法和版本控制系统的使用策略与技巧。您没有必要将它们全部用上。</p>
              </td>
            </tr>
          </table>
        </div>
        <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">
          <table border="0" summary="Tip">
            <tr>
              <td rowspan="2" align="center" valign="top">
                <img alt="[提示]" src="images/tip.png"/>
              </td>
              <th align="left">提示</th>
            </tr>
            <tr>
              <td align="left" valign="top">
                <p>在“Debian 开发者参考”一文的 <a class="ulink" href="https://www.debian.org/doc/manuals/developers-reference/best-pkging-practices.html">第 6 章 最佳打包实践</a> 部分有十分详尽的相关文档。请读一读这些内容。</p>
              </td>
            </tr>
          </table>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h3 class="title"><a id="debhelper"/>5.1.1. <span class="strong"><strong>debhelper</strong></span> 软件包</h3>
              </div>
            </div>
          </div>
          <p>尽管 Debian 软件包可以仅由编写 <span class="strong"><strong>debian/rules</strong></span> 脚本而不使用 <span class="strong"><strong>debhelper</strong></span> 软件包来生成，其实这样做是不切实际的。现代的 Debian“政策”对许多功能特性的实现做了要求，如应用适当的文件权限、使用合适的与硬件架构相关的软件库安装路径、安装脚本钩子的插入、调试符号软件包的生成、软件包依赖信息的生成、软件包信息文件的生成、对时间戳调节以符合可重现构建的要求，等等。</p>
          <p><span class="strong"><strong>Debhelper</strong></span> 软件包提供了一套实用脚本，用来简化 Debian 打包工作流并减轻软件包维护者的负担。若能适当运用，它们可以帮助打包者自动地处理并实现 Debian”政策“所要求的功能。</p>
          <p>现代化的 Debian 打包工作流可以组织成一个简单的模块化工作流，如下所示：</p>
          <div class="itemizedlist">
            <ul class="itemizedlist">
              <li class="listitem">使用 <span class="strong"><strong>dh</strong></span> 命令以自动调用来自 <span class="strong"><strong>debhelper</strong></span> 软件包的许多实用脚本，以及</li>
              <li class="listitem">使用 <span class="strong"><strong>debian/</strong></span> 目录下的声明式配置文件配置它们的行为。</li>
            </ul>
          </div>
          <p>您几乎总是应当将 <span class="strong"><strong>debhelper</strong></span> 列为您的软件包的构建依赖之一。本文档在接下来的内容中也假设您正在使用一个版本足够新的 <span class="strong"><strong>debhelper</strong></span> 协助进行打包工作。</p>
        </div>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="name-version"/>5.2. 软件包名称和版本</h2>
            </div>
          </div>
        </div>
        <p>如果所获取上游源代码的形式为 <span class="strong"><strong>hello-0.9.12.tar.gz</strong></span>，您可以将 <span class="strong"><strong>hello</strong></span> 作为上游源代码名称，并将 <span class="strong"><strong>0.9.12</strong></span> 作为上游版本号。</p>
        <p><span class="strong"><strong>debmake</strong></span> 的目的是为软件包维护者提供开始工作的模板文件。注释行以 <span class="strong"><strong>#</strong></span> 开始，其中包含一些教程性文字。您在将软件包上传至 Debian 仓库之前必须删除或者修改这样的注释行。</p>
        <p>许可证信息的提取和赋值过程应用了大量启发式操作，因此在某些情况下可能不会正常工作。强烈建议您搭配使用其它工具，例如来自 <span class="strong"><strong>devscripts</strong></span> 软件包的 <span class="strong"><strong>licensecheck</strong></span> 工具，以配合 <span class="strong"><strong>debmake</strong></span> 的使用。</p>
        <p>组成 Debian 软件包名称的字符选取存在一定的限制。最明显的限制应当是软件包名称中禁止出现大写字母。这里给出正则表达式形式的规则总结：</p>
        <div class="itemizedlist">
          <ul class="itemizedlist">
            <li class="listitem">上游软件包名称（<span class="strong"><strong>-p</strong></span>）：[-+.a-z0-9]{2,}</li>
            <li class="listitem">二进制软件包名称（<span class="strong"><strong>-b</strong></span>）：[-+.a-z0-9]{2,}</li>
            <li class="listitem">上游版本号（<span class="strong"><strong>-u</strong></span>）：[0-9][-+.:~a-z0-9A-Z]*</li>
            <li class="listitem">Debian 修订版本（<span class="strong"><strong>-r</strong></span>）： [0-9][+.~a-z0-9A-Z]*</li>
          </ul>
        </div>
        <p>请在“Debian 政策手册”的 <a class="ulink" href="https://www.debian.org/doc/debian-policy/#document-ch-controlfields">第 5 章 - Control 文件及其字段</a> 一节中查看其精确定义。</p>
        <p><span class="strong"><strong>debmake</strong></span> 所假设的打包情景是相对简单的。因此，所有与解释器相关的程序都会默认为“<span class="strong"><strong>Architecture: all</strong></span>”的情况。当然，这个假设并非总是成立。</p>
        <p>您必须为 Debian 打包工作适当地调整软件包名称和上游版本号。</p>
        <p>为了能有效地使用一些流行的工具（如 <span class="strong"><strong>aptitude</strong></span>）管理软件包名称和版本信息，最好能将软件包名称保持在 30 字符以下；版本号和修订号加起来最好能不超过 14 个字符。<a href="#ftn.idm1589" class="footnote" id="idm1589"><sup class="footnote">[10]</sup></a></p>
        <p>为了避免命名冲突，对用户可见的二进制软件包名称不应选择任何常用的单词。</p>
        <p>如果上游没有使用像 <span class="strong"><strong>2.30.32</strong></span> 这样正常的版本编号方案，而是使用了诸如 <span class="strong"><strong>11Apr29</strong></span> 这样包含日期、某些代号或者一个版本控制系统散列值等字符串作为版本号的一部分的话，请在上游版本号中将这些部分移除。这些信息可以稍后在 <span class="strong"><strong>debian/changelog</strong></span> 文件中进行记录。如果您需要为软件设计一个版本字符串，可以使用 <span class="strong"><strong>YYYYMMDD</strong></span> 格式，如 <span class="strong"><strong>20110429</strong></span> 的字符串作为上游版本号。这样能保证 <span class="strong"><strong>dpkg</strong></span> 命令在升级时能正确地确定版本的先后关系。如果您想要确保万一上游在未来重新采纳正常版本编号方案，例如 <span class="strong"><strong>0.1</strong></span> 时能够做到顺畅地迁移，可以另行使用 <span class="strong"><strong>0~YYMMDD</strong></span> 的格式，如 <span class="strong"><strong>0~110429</strong></span> 作为上游版本号。</p>
        <p>版本字符串可以按如下的方式使用 <span class="strong"><strong>dpkg</strong></span> 命令进行比较。</p>
        <pre class="screen">$ dpkg --compare-versions ver1 op ver2</pre>
        <p>版本比较的规则可以归纳如下：</p>
        <div class="itemizedlist">
          <ul class="itemizedlist">
            <li class="listitem">字符串按照起始到末尾的顺序进行比较。</li>
            <li class="listitem">字符比数字大。</li>
            <li class="listitem">数字按照整数顺序进行比较。</li>
            <li class="listitem">字符按照 ASCII 编码的顺序进行比较。</li>
          </ul>
        </div>
        <p>对于某些字符，如句点（<span class="strong"><strong>.</strong></span>）、加号（<span class="strong"><strong>+</strong></span>）和波浪号（<span class="strong"><strong>~</strong></span>），有如下的特殊规则。</p>
        <pre class="screen">0.0 &lt; 0.5 &lt; 0.10 &lt; 0.99 &lt; 1 &lt; 1.0~rc1 &lt; 1.0 &lt; 1.0+b1 &lt; 1.0+nmu1 &lt; 1.1 &lt; 2.0</pre>
        <p>有一个稍需注意的情况，即当上游将 <span class="strong"><strong>hello-0.9.12-ReleaseCandidate-99.tar.gz</strong></span> 这样的版本当作预发布版本，而将 <span class="strong"><strong>hello-0.9.12.tar.gz</strong></span> 作为正式版本时。为了确保 Debian 软件包升级能够顺畅进行，您应当修改版本号命名，如将上游源代码压缩包重命名为 <span class="strong"><strong>hello-0.9.12~rc99.tar.gz</strong></span>。</p>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="native"/>5.3. 本土 Debian 软件包</h2>
            </div>
          </div>
        </div>
        <p>使用“<span class="strong"><strong>3.0 (quilt)</strong></span>”格式的非本土 Debian 软件包是最常见最标准的 Debian 源码包格式。根据 <span class="strong"><strong>dpkg-source</strong></span>(1) 的描述，此时的 <span class="strong"><strong>debian/source/format</strong></span> 文件应当包含“<span class="strong"><strong>3.0 (quilt)</strong></span> 的文字内容。上述的工作流和接下来给出的打包示例都使用了这种格式。</p>
        <p>而本土 Debian 软件包是较罕见的一种 Debian 软件包格式。它通常只用于打包仅对 Debian 项目有价值、有意义的软件。因此，该格式的使用通常不被提倡。</p>
        <div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;">
          <table border="0" summary="Caution">
            <tr>
              <td rowspan="2" align="center" valign="top">
                <img alt="[小心]" src="images/caution.png"/>
              </td>
              <th align="left">小心</th>
            </tr>
            <tr>
              <td align="left" valign="top">
                <p>在上游 tarball 源码压缩包无法使用其正确名称 <span class="emphasis"><em>package_version</em></span>.<span class="strong"><strong>orig.tar.gz</strong></span> 被 <span class="strong"><strong>dpkg-buildpackage</strong></span> 获取到的时候，会出现意外地构建了本土 Debian 软件包的情况。这是新手常见的一个错误，通常是因构建中错误地在符号链接名称中使用了“<span class="strong"><strong>-</strong></span>”字符而非正确的“<span class="strong"><strong>_</strong></span>”字符。[译注：此处仍然假设打包的场景是已经获取或形成了名为 <span class="strong"><strong>package-version</strong></span>.<span class="strong"><strong>tar.gz</strong></span> 的上游源码 tarball。Debian 的打包工作很大程度上是以上游源码 tarball 作为基础的，这一点须时刻牢记在心。]</p>
              </td>
            </tr>
          </table>
        </div>
        <p>本土 Debian 软件包不对 <span class="strong"><strong>上游代码</strong></span> 和 <span class="strong"><strong>Debian 的修改</strong></span> 进行区分，仅包含以下内容：</p>
        <div class="itemizedlist">
          <ul class="itemizedlist">
            <li class="listitem"><span class="emphasis"><em>package_version</em></span>.<span class="strong"><strong>tar.gz</strong></span>（<span class="emphasis"><em>package-version</em></span>.<span class="strong"><strong>tar.gz</strong></span> 文件的副本或符号链接，包含 <span class="strong"><strong>debian/</strong></span>* 的各个文件。）</li>
            <li class="listitem"><span class="emphasis"><em>package_version</em></span>.<span class="strong"><strong>dsc</strong></span></li>
          </ul>
        </div>
        <p>如果您需要手动创建本土 Debian 软件包，可以使用 <span class="strong"><strong>dpkg-source</strong></span>(1) 工具以“<span class="strong"><strong>3.0 (native)</strong></span>”格式进行创建。</p>
        <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">
          <table border="0" summary="Tip">
            <tr>
              <td rowspan="2" align="center" valign="top">
                <img alt="[提示]" src="images/tip.png"/>
              </td>
              <th align="left">提示</th>
            </tr>
            <tr>
              <td align="left" valign="top">
                <p>某些人希望推行对那些即使是仅针对 Debian 编写的那些软件也使用非本土软件包格式的做法。这种做法所需要的不包含 <span class="strong"><strong>debian/</strong></span>* 文件的 tarball 压缩包事先需要手动生成以符合在 <a class="xref" href="ch05.zh-cn.html#workflow" title="5.1. 打包工作流">第 5.1 节 “打包工作流”</a> 中的标准工作流。他们认为使用非本土软件包格式可以方便与下游发行版之间的沟通与交流。</p>
              </td>
            </tr>
          </table>
        </div>
        <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">
          <table border="0" summary="Tip">
            <tr>
              <td rowspan="2" align="center" valign="top">
                <img alt="[提示]" src="images/tip.png"/>
              </td>
              <th align="left">提示</th>
            </tr>
            <tr>
              <td align="left" valign="top">
                <p>如果使用本土软件包格式，没有必要事先创建 tarball 压缩包。要创建一个本土 Debian 软件包，应当将 <span class="strong"><strong>debian/source/format</strong></span> 文件的内容设置为“<span class="strong"><strong>3.0 (native)</strong></span>”，适当编写 <span class="strong"><strong>debian/changelog</strong></span> 文件使得版本号中不包含 Debian 修订号（例如，<span class="strong"><strong>1.0</strong></span> 而非 <span class="strong"><strong>1.0-1</strong></span>），最后在源码树中调用“<span class="strong"><strong>dpkg-source -b .</strong></span>”命令。这样做便可以自动生成包含源代码的 tarball。</p>
              </td>
            </tr>
          </table>
        </div>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="rules"/>5.4. debian/rules</h2>
            </div>
          </div>
        </div>
        <p><span class="strong"><strong>debian/rules</strong></span> 脚本是用于实际构建 Debian 软件包的可执行脚本。</p>
        <div class="itemizedlist">
          <ul class="itemizedlist">
            <li class="listitem">
              <p class="simpara"><span class="strong"><strong>debian/rules</strong></span> 脚本重新封装了上游的构建系统（参见 <a class="xref" href="ch05.zh-cn.html#build" title="5.16. 上游构建系统">第 5.16 节 “上游构建系统”</a>）以达到将文件安装至 <span class="strong"><strong>$(DESTDIR)</strong></span>并将生成的文件存入各个 <span class="strong"><strong>deb</strong></span> 格式文件中的目的。</p>
              <div class="itemizedlist">
                <ul class="itemizedlist">
                  <li class="listitem">这里的 <span class="strong"><strong>deb</strong></span> 文件用于二进制的文件分发，并将被 <span class="strong"><strong>dpkg</strong></span> 命令所使用以将软件安装至系统中。</li>
                </ul>
              </div>
            </li>
            <li class="listitem"><span class="strong"><strong>dh</strong></span> 命令通常在 <span class="strong"><strong>debian/rules</strong></span> 脚本中使用，用作构建系统的一个前端。</li>
            <li class="listitem">
              <p class="simpara"><span class="strong"><strong>$(DESTDIR)</strong></span> 路径具体值依赖于构建的类型。</p>
              <div class="itemizedlist">
                <ul class="itemizedlist">
                  <li class="listitem"><span class="strong"><strong>$(DESTDIR)=debian/</strong></span><span class="emphasis"><em>binarypackage</em></span>（单个二进制软件包）</li>
                  <li class="listitem"><span class="strong"><strong>$(DESTDIR)=debian/tmp</strong></span>（多个二进制软件包）</li>
                </ul>
              </div>
            </li>
          </ul>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h3 class="title"><a id="dh"/>5.4.1. dh</h3>
              </div>
            </div>
          </div>
          <p>由 <span class="strong"><strong>debhelper</strong></span> 软件包提供的 <span class="strong"><strong>dh</strong></span> 命令与一些相关的软件包共同工作，作为典型的上游构建系统的一层封装，同时它支持所有 Debian 政策（Debian Policy）规定必须在 <span class="strong"><strong>debian/rules</strong></span> 实现的目标（target），以此提供一个统一的访问接口。</p>
          <div class="itemizedlist">
            <ul class="itemizedlist">
              <li class="listitem"><span class="strong"><strong>dh clean</strong></span>：清理源码树中的文件。</li>
              <li class="listitem"><span class="strong"><strong>dh build</strong></span>：在源码树中进行构建</li>
              <li class="listitem"><span class="strong"><strong>dh build-arch</strong></span>：在源码树中构建架构相关的软件包</li>
              <li class="listitem"><span class="strong"><strong>dh build-indep</strong></span>：在源代码中构建架构无关的软件包</li>
              <li class="listitem"><span class="strong"><strong>dh install</strong></span>：将二进制文件安装至 <span class="strong"><strong>$(DESTDIR)</strong></span></li>
              <li class="listitem"><span class="strong"><strong>dh install-arch</strong></span>：为架构相关的软件包将二进制文件安装至 <span class="strong"><strong>$(DESTDIR)</strong></span> 中</li>
              <li class="listitem"><span class="strong"><strong>dh install-indep</strong></span>：为架构无关的软件包将二进制文件安装进入 <span class="strong"><strong>$(DESTDIR)</strong></span> 中</li>
              <li class="listitem"><span class="strong"><strong>dh binary</strong></span>：产生 <span class="strong"><strong>deb</strong></span> 文件</li>
              <li class="listitem"><span class="strong"><strong>dh binary-arch</strong></span>：为架构相关的软件包产生 <span class="strong"><strong>deb</strong></span> 文件</li>
              <li class="listitem"><span class="strong"><strong>dh binary-indep</strong></span>：为架构无关的软件包产生 <span class="strong"><strong>deb</strong></span> 文件</li>
            </ul>
          </div>
          <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
            <table border="0" summary="Note">
              <tr>
                <td rowspan="2" align="center" valign="top">
                  <img alt="[注意]" src="images/note.png"/>
                </td>
                <th align="left">注意</th>
              </tr>
              <tr>
                <td align="left" valign="top">
                  <p>对使用了 <span class="strong"><strong>debhelper</strong></span>“compat &gt;=9”的情况，<span class="strong"><strong>dh</strong></span> 命令将在编译参数未事先设置的情况下根据 <span class="strong"><strong>dpkg-buildflags</strong></span> 命令返回的值设置并导出各个编译参数（如 <span class="strong"><strong>CFLAGS</strong></span>、<span class="strong"><strong>CXXFLAGS</strong></span>、<span class="strong"><strong>FFLAGS</strong></span>、<span class="strong"><strong>CPPFLAGS</strong></span> 和 <span class="strong"><strong>LDFLAGS</strong></span>）。（<span class="strong"><strong>dh</strong></span> 命令将调用在 <span class="strong"><strong>Debian::Debhelper::Dh_Lib</strong></span> 模块中定义的 <span class="strong"><strong>set_buildflags</strong></span>。）</p>
                </td>
              </tr>
            </table>
          </div>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h3 class="title"><a id="simplerules"/>5.4.2. 简单的 debian/rules</h3>
              </div>
            </div>
          </div>
          <p>受益于 <span class="strong"><strong>dh</strong></span> 命令对构建目标的抽象化 <a href="#ftn.idm1762" class="footnote" id="idm1762"><sup class="footnote">[11]</sup></a>，一个符合 Debian 政策而支持所有必需目标（target）的 <span class="strong"><strong>debian/rules</strong></span> 文件可以简单地写成如下形式<a href="#ftn.idm1767" class="footnote" id="idm1767"><sup class="footnote">[12]</sup></a>：</p>
          <p><strong>简单的 <span class="strong"><strong>debian/rules</strong></span>：. </strong>
</p>
          <pre class="screen">#!/usr/bin/make -f
#export DH_VERBOSE = 1

%:
        dh $@</pre>
          <p>
</p>
          <p>从本质上来看，这里的 <span class="strong"><strong>dh</strong></span> 命令的作用是作为一个序列化工具，在合适的时候调用所有所需的 <span class="strong"><strong>dh_</strong></span>* 命令。</p>
          <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
            <table border="0" summary="Note">
              <tr>
                <td rowspan="2" align="center" valign="top">
                  <img alt="[注意]" src="images/note.png"/>
                </td>
                <th align="left">注意</th>
              </tr>
              <tr>
                <td align="left" valign="top">
                  <p><span class="strong"><strong>debmake</strong></span> 命令会在 <span class="strong"><strong>debian/control</strong></span> 文件中写入“<span class="strong"><strong>Build-Depends: debhelper (&gt;=9)</strong></span>”，并在 <span class="strong"><strong>debian/compat</strong></span> 文件中写入“<span class="strong"><strong>9</strong></span>”。</p>
                </td>
              </tr>
            </table>
          </div>
          <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">
            <table border="0" summary="Tip">
              <tr>
                <td rowspan="2" align="center" valign="top">
                  <img alt="[提示]" src="images/tip.png"/>
                </td>
                <th align="left">提示</th>
              </tr>
              <tr>
                <td align="left" valign="top">
                  <p>设置“<span class="strong"><strong>export DH_VERBOSE = 1</strong></span>”会输出构建系统中每一条会修改文件内容的命令。它同时会在某些构建系统中启用详细输出构建日志的选项。</p>
                </td>
              </tr>
            </table>
          </div>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h3 class="title"><a id="customrules"/>5.4.3. 自定义 debian/rules</h3>
              </div>
            </div>
          </div>
          <p>通过添加合适的 <span class="strong"><strong>override_dh_</strong></span>* 目标（target）并编写对应的规则，可以实现对 <span class="strong"><strong>debian/rules</strong></span> 脚本的灵活定制。</p>
          <p>如果需要在 <span class="strong"><strong>dh</strong></span> 命令调用某些特定的 <span class="strong"><strong>dh_</strong></span><span class="emphasis"><em>foo</em></span> 命令时采取某些特别的操作，则任何自动执行的操作均可以被 <span class="strong"><strong>debian/rules</strong></span> 中额外添加的 <span class="strong"><strong>override_dh_</strong></span><span class="emphasis"><em>foo</em></span> 这样的 Makefile 目标所覆写。</p>
          <p>构建的过程可以使用某些上游提供的接口进行定制化，如使用传递给标准的源代码构建系统的参数。这些构建系统包括但不限于：</p>
          <div class="itemizedlist">
            <ul class="itemizedlist">
              <li class="listitem"><span class="strong"><strong>configure</strong></span>，</li>
              <li class="listitem"><span class="strong"><strong>Makefile</strong></span>，</li>
              <li class="listitem"><span class="strong"><strong>setup.py</strong></span>，或</li>
              <li class="listitem"><span class="strong"><strong>Build.PL</strong></span>。</li>
            </ul>
          </div>
          <p>在这种情况下，您应该添加一个 <span class="strong"><strong>override_dh_auto_build</strong></span> 目标并在其中执行“<span class="strong"><strong>dh_auto_build --</strong></span> <span class="emphasis"><em>自定义参数”</em></span> 的命令。这样可以在 <span class="strong"><strong>dh_auto_build</strong></span> 默认传递的参数之后确保将用户给出的 <span class="emphasis"><em>自定义参数</em></span> 继续传递给那些构建系统。</p>
          <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">
            <table border="0" summary="Tip">
              <tr>
                <td rowspan="2" align="center" valign="top">
                  <img alt="[提示]" src="images/tip.png"/>
                </td>
                <th align="left">提示</th>
              </tr>
              <tr>
                <td align="left" valign="top">
                  <p>如果上文提到的构建系统命令已知得到了 <span class="strong"><strong>dh_auto_build</strong></span> 命令的支持的话，请避免直接调用这些命令（而让 <span class="strong"><strong>dh_auto_build</strong></span> 自动处理）。</p>
                </td>
              </tr>
            </table>
          </div>
          <p><span class="strong"><strong>debmake</strong></span> 命令所创建的初始模版文件除了应用了上文提到的简单 <span class="strong"><strong>debian/rules</strong></span> 文件的优点外，同时为后续可能涉及的软件包加固等情景添加了一些额外的定制选项。您需要先了解整个构建系统背后的工作原理（参见 <a class="xref" href="ch05.zh-cn.html#build" title="5.16. 上游构建系统">第 5.16 节 “上游构建系统”</a>），之后才能收放自如地定制软件包来处理某些非常规的工作情况。</p>
          <div class="itemizedlist">
            <ul class="itemizedlist">
              <li class="listitem">请参考 <a class="xref" href="ch04.zh-cn.html#step-maintainer" title="4.6. 第三步：编辑模板文件">第 4.6 节 “第三步：编辑模板文件”</a> 一节以了解如何对 <span class="strong"><strong>debmake</strong></span> 命令生成的 <span class="strong"><strong>debian/rules</strong></span> 文件模版进行定制。</li>
              <li class="listitem">请参见 <a class="xref" href="ch05.zh-cn.html#multiarch" title="5.20. 多体系结构">第 5.20 节 “多体系结构”</a> 以了解与 multiarch 相关的定制方法。</li>
              <li class="listitem">请参见 <a class="xref" href="ch05.zh-cn.html#harden" title="5.21. 编译加固">第 5.21 节 “编译加固”</a> 以了解与软件包加固相关的定制方法。</li>
            </ul>
          </div>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h3 class="title"><a id="variablesrules"/>5.4.4. debian/rules 中的变量</h3>
              </div>
            </div>
          </div>
          <p>某些对自定义 <span class="strong"><strong>debian/rules</strong></span> 有用的变量定义可以在 <span class="strong"><strong>/usr/share/dpkg/</strong></span> 目录下的文件中找到。比较重要的包括：</p>
          <div class="variablelist">
            <dl class="variablelist">
              <dt>
                <span class="term">
                  <span class="strong">
                    <strong>pkg-info.mk</strong>
                  </span>
                </span>
              </dt>
              <dd><span class="strong"><strong>DEB_SOURCE</strong></span>、<span class="strong"><strong>DEB_VERSION</strong></span>、<span class="strong"><strong>DEB_VERSION_EPOCH_UPSTREAM</strong></span>、<span class="strong"><strong>DEB_VERSION_UPSTREAM_REVISION</strong></span>、<span class="strong"><strong>DEB_VERSION_UPSTREAM</strong></span> 和 <span class="strong"><strong>DEB_DISTRIBUTION</strong></span> 变量。它们在向后移植（backport）支持等场景下能起到一定的作用。</dd>
              <dt>
                <span class="term">
                  <span class="strong">
                    <strong>vendor.mk</strong>
                  </span>
                </span>
              </dt>
              <dd><span class="strong"><strong>DEB_VENDOR</strong></span> 和 <span class="strong"><strong>DEB_PARENT_VENDOR</strong></span> 变量，以及 <span class="strong"><strong>dpkg_vendor_derives_from</strong></span> 宏。它们在系统提供方的支持方面（Debian、Ubuntu 等）有其特定用处。</dd>
              <dt>
                <span class="term">
                  <span class="strong">
                    <strong>architecture.mk</strong>
                  </span>
                </span>
              </dt>
              <dd>设置 <span class="strong"><strong>DEB_HOST_</strong></span>* 和 <span class="strong"><strong>DEB_BUILD_</strong></span>* 变量。除此之外存在一种替代方案，即直接调用 <span class="strong"><strong>dpkg-architecture</strong></span> 来获取变量，一次调用查询得到一个变量值。如显式调用 <span class="strong"><strong>dpkg-architecture</strong></span> 以获取必需变量的话，便不再需要在 <span class="strong"><strong>debian/rules</strong></span> 中包含 <span class="strong"><strong>architecture.mk</strong></span> 了（后者会引入全部架构相关的变量）。</dd>
              <dt>
                <span class="term">
                  <span class="strong">
                    <strong>buildflags.mk</strong>
                  </span>
                </span>
              </dt>
              <dd>设置 <span class="strong"><strong>CFLAGS</strong></span>、<span class="strong"><strong>CPPFLAGS</strong></span>、<span class="strong"><strong>CXXFLAGS</strong></span>、<span class="strong"><strong>OBJCFLAGS</strong></span>、<span class="strong"><strong>OBJCXXFLAGS</strong></span>、<span class="strong"><strong>GCJFLAGS</strong></span>、<span class="strong"><strong>FFLAGS</strong></span>、<span class="strong"><strong>FCFLAGS</strong></span> 和 <span class="strong"><strong>LDFLAGS</strong></span> 这些构建标志（build flags）。</dd>
            </dl>
          </div>
          <p>如果您希望在 <span class="strong"><strong>debian/rules</strong></span> 中使用其中的某些变量，您可以将相关的代码复制到 <span class="strong"><strong>debian/rules</strong></span> 文件中，或是重写一份简单的替代实现。总而言之请保持 <span class="strong"><strong>debian/rules</strong></span> 文件尽量简单。</p>
          <p>例如，您按如下的方法在 <span class="strong"><strong>debian/rules</strong></span> 文件中添加内容，从而为 <span class="strong"><strong>linux-any</strong></span> 目标架构添加额外的 <span class="strong"><strong>CONFIGURE_FLAGS</strong></span>：</p>
          <pre class="screen">DEB_HOST_ARCH_OS ?= $(shell dpkg-architecture -qDEB_HOST_ARCH_OS)
 ...
ifeq ($(DEB_HOST_ARCH_OS),linux)
CONFIGURE_FLAGS += --enable-wayland
endif</pre>
          <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">
            <table border="0" summary="Tip">
              <tr>
                <td rowspan="2" align="center" valign="top">
                  <img alt="[提示]" src="images/tip.png"/>
                </td>
                <th align="left">提示</th>
              </tr>
              <tr>
                <td align="left" valign="top">
                  <p>历史上对于 <span class="strong"><strong>debhelper</strong></span> 兼容等级小于等于 8 的情况下，在 <span class="strong"><strong>debian/rules</strong></span> 文件中包含 <span class="strong"><strong>buildflags.mk</strong></span> 文件是很有用的，它可以合适地设置一些构建标志，如 <span class="strong"><strong>CPPFLAGS</strong></span>、<span class="strong"><strong>CFLAGS</strong></span>、<span class="strong"><strong>LDFLAGS</strong></span> 等，同时保证对特定选项，如 <span class="strong"><strong>DEB_CFLAGS_MAINT_APPEND</strong></span> 和 <span class="strong"><strong>DEB_BUILD_MAINT_OPTIONS</strong></span> 的合适处理。现在您应当使用的 <span class="strong"><strong>debhelper</strong></span> 兼容等级大于等于 9，故如无特殊原因，请不要继续包含 <span class="strong"><strong>buildflags.mk</strong></span>，请交由 <span class="strong"><strong>dh</strong></span> 命令来处理和设置这些构建标志。</p>
                </td>
              </tr>
            </table>
          </div>
          <p>参见 <a class="xref" href="ch05.zh-cn.html#multiarch" title="5.20. 多体系结构">第 5.20 节 “多体系结构”</a>、<span class="strong"><strong>dpkg-architecture</strong></span>(1) 和 <span class="strong"><strong>dpkg-buildflags</strong></span>(1)。</p>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h3 class="title"><a id="reproducible"/>5.4.5. 可重现的构建</h3>
              </div>
            </div>
          </div>
          <p>为了做到软件包可重现的构建，这里给出一些相关的建议。</p>
          <div class="itemizedlist">
            <ul class="itemizedlist">
              <li class="listitem">不要嵌入基于系统时间的时间戳。</li>
              <li class="listitem">在 <span class="strong"><strong>debian/rules</strong></span> 中使用“<span class="strong"><strong>dh $@</strong></span>”以应用最新的 <span class="strong"><strong>debhelper</strong></span> 特性。</li>
              <li class="listitem">
Export the build environment as “<span class="strong"><strong>LC_ALL=C.UTF-8</strong></span>” (see <a class="xref" href="ch07.zh-cn.html#utf-8-build" title="7.15. 在 UTF-8 环境下构建">第 7.15 节 “在 UTF-8 环境下构建”</a>).
</li>
              <li class="listitem">对上游源代码中使用的时间戳，使用 debhelper 提供的环境变量 <span class="strong"><strong>$SOURCE_DATE_EPOCH</strong></span> 的值。</li>
              <li class="listitem">
                <p class="simpara">阅读<a class="ulink" href="https://wiki.debian.org/ReproducibleBuilds">可重现构建</a>了解更多信息。</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist">
                    <li class="listitem"><a class="ulink" href="https://wiki.debian.org/ReproducibleBuilds/Howto">可重现构建操作方法</a>。</li>
                    <li class="listitem"><a class="ulink" href="https://wiki.debian.org/ReproducibleBuilds/TimestampsProposal">可重现构建时间戳处理提议</a>。</li>
                  </ul>
                </div>
              </li>
            </ul>
          </div>
          <p>由 <span class="strong"><strong>dpkg-genbuildinfo</strong></span>(1) 生成的控制文件 <span class="emphasis"><em>source-name_source-version_arch</em></span><span class="strong"><strong>.buildinfo</strong></span> 记录了构建环境信息。参见 <span class="strong"><strong>deb-buildinfo</strong></span>(5)</p>
        </div>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="control"/>5.5. debian/control</h2>
            </div>
          </div>
        </div>
        <p><span class="strong"><strong>debian/control</strong></span> 文件包含了由空行分隔的数块元信息数据。每块元数据按照如下的顺序定义了下面这些内容：</p>
        <div class="itemizedlist">
          <ul class="itemizedlist">
            <li class="listitem">Debian 源码包的元信息数据</li>
            <li class="listitem">Debian 二进制软件包的元信息</li>
          </ul>
        </div>
        <p>参见“Debian 政策手册”中的 <a class="ulink" href="https://www.debian.org/doc/debian-policy/#document-ch-controlfields">第 5 章 - Control 文件及其字段</a> 一章以了解每块元信息的具体定义。</p>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h3 class="title"><a id="split"/>5.5.1. Debian 二进制软件包的拆分</h3>
              </div>
            </div>
          </div>
          <p>对行为良好的构建系统来说，对 Debian 二进制包的拆分可以由如下方式实现。</p>
          <div class="itemizedlist">
            <ul class="itemizedlist">
              <li class="listitem">为所有二进制软件包在 <span class="strong"><strong>debian/control</strong></span> 文件中创建对应的二进制软件包条目。</li>
              <li class="listitem">在对应的 <span class="strong"><strong>debian/</strong></span><span class="emphasis"><em>二进制软件包名</em></span><span class="strong"><strong>.install</strong></span> 文件中列出所有文件的路径（相对于 <span class="strong"><strong>debian/tmp</strong></span> 目录）。</li>
            </ul>
          </div>
          <p>请查看本指南中相关的例子：</p>
          <div class="itemizedlist">
            <ul class="itemizedlist">
              <li class="listitem"><a class="xref" href="ch08.zh-cn.html#autotools-multi" title="8.11. Autotools（多个二进制软件包）">第 8.11 节 “Autotools（多个二进制软件包）”</a>（基于 Autotools）</li>
              <li class="listitem"><a class="xref" href="ch08.zh-cn.html#cmake-multi" title="8.12. CMake（多个二进制软件包）">第 8.12 节 “CMake（多个二进制软件包）”</a>（基于 CMake）</li>
            </ul>
          </div>
          <div class="section">
            <div class="titlepage">
              <div>
                <div>
                  <h4 class="title"><a id="boption"/>5.5.1.1. debmake -b</h4>
                </div>
              </div>
            </div>
            <p><span class="strong"><strong>debmake</strong></span> 命令的 <span class="strong"><strong>-b</strong></span> 选项提供了一个符合直觉又灵活的功能，可以用来创建 <span class="strong"><strong>debian/control</strong></span> 的初始模板文件，其中可以定义多个 Debian 二进制软件包，每节中含有如下字段：</p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
                  <span class="strong">
                    <strong>Package:</strong>
                  </span>
                </li>
                <li class="listitem">
                  <span class="strong">
                    <strong>Architecture:</strong>
                  </span>
                </li>
                <li class="listitem">
                  <span class="strong">
                    <strong>Multi-Arch:</strong>
                  </span>
                </li>
                <li class="listitem">
                  <span class="strong">
                    <strong>Depends:</strong>
                  </span>
                </li>
                <li class="listitem">
                  <span class="strong">
                    <strong>Pre-Depends:</strong>
                  </span>
                </li>
              </ul>
            </div>
            <p><span class="strong"><strong>debmake</strong></span> 命令也会在每个适当的依赖字段中设置合适的变量替换占位符（substvars）。</p>
            <p>我们在这里直接引用 <span class="strong"><strong>debmake</strong></span> 手册页中的相关一部分内容。</p>
            <div class="variablelist">
              <dl class="variablelist">
                <dt>
                  <span class="term"><span class="strong"><strong>-b</strong></span> "<span class="emphasis"><em>二进制软件包名[:type],…</em></span>", <span class="strong"><strong>--binaryspec</strong></span> "<span class="emphasis"><em>二进制软件包名[:type],…</em></span>"</span>
                </dt>
                <dd>
                  <p class="simpara">设置二进制软件包的指定类型内容，使用一个用逗号分隔的<span class="emphasis"><em>二进制软件包名:类型</em></span>成对列表；例如，使用完整形式“<span class="strong"><strong>foo:bin,foo-doc:doc,libfoo1:lib,libfoo-dev:dev</strong></span>”或者使用短形式，“<span class="strong"><strong>-doc,libfoo1,libfoo-dev</strong></span>”。</p>
                  <p class="simpara">这里，<span class="emphasis"><em>二进制软件包</em></span>是二进制软件包名称，可选的<span class="emphasis"><em>类型</em></span>应当从下面的<span class="emphasis"><em>类型</em></span>值中进行选取：</p>
                  <div class="itemizedlist">
                    <ul class="itemizedlist">
                      <li class="listitem"><span class="strong"><strong>bin</strong></span>：C/C++ 预编译 ELF 二进制代码软件包（any，foreign）（默认，别名：<span class="strong"><strong>""</strong></span>，即，<span class="emphasis"><em>空字符串</em></span>）</li>
                      <li class="listitem"><span class="strong"><strong>data</strong></span>：数据（字体、图像、……）软件包（all，foreign）（别名：<span class="strong"><strong>da</strong></span>）</li>
                      <li class="listitem"><span class="strong"><strong>dev</strong></span>：库开发软件包（any，same）（别名：<span class="strong"><strong>de</strong></span>）</li>
                      <li class="listitem"><span class="strong"><strong>doc</strong></span>：文档软件包（all，foreign）（别名：<span class="strong"><strong>do</strong></span>）</li>
                      <li class="listitem"><span class="strong"><strong>lib</strong></span>：库软件包（any，same）（别名：<span class="strong"><strong>l</strong></span>）</li>
                      <li class="listitem"><span class="strong"><strong>perl</strong></span>：Perl 脚本软件包（all，foreign）（别名：<span class="strong"><strong>pl</strong></span>）</li>
                      <li class="listitem"><span class="strong"><strong>python</strong></span>：Python 脚本软件包（all，foreign）（别名：<span class="strong"><strong>py</strong></span>）</li>
                      <li class="listitem"><span class="strong"><strong>python3</strong></span>：Python3 脚本软件包（all，foreign）（别名：<span class="strong"><strong>py3</strong></span>）</li>
                      <li class="listitem"><span class="strong"><strong>ruby</strong></span>：Ruby 脚本软件包（all，foreign）（别名：<span class="strong"><strong>rb</strong></span>）</li>
                      <li class="listitem"><span class="strong"><strong>script</strong></span>：Shell 脚本软件包（all，foreign）（别名：<span class="strong"><strong>sh</strong></span>）</li>
                    </ul>
                  </div>
                  <p class="simpara">括号内成对的值，例如（any，foreign），是软件包的<span class="strong"><strong>架构</strong></span>和<span class="strong"><strong>多架构（Multi-Arch）</strong></span>特性的值，它们将设置在 <span class="strong"><strong>debian/control</strong></span> 文件中。</p>
                  <p class="simpara">大多数情况下，<span class="strong"><strong>debmake</strong></span> 命令可以有效地从<span class="emphasis"><em>二进制软件包</em></span>的名称猜测出正确的<span class="emphasis"><em>类型</em></span>。如果<span class="emphasis"><em>类型</em></span>的值并不明显，程序将回退到将<span class="emphasis"><em>类型</em></span>设置为<span class="strong"><strong>bin</strong></span>。例如，<span class="strong"><strong>libfoo</strong></span> 设置<span class="emphasis"><em>类型</em></span>为 <span class="strong"><strong>lib</strong></span>，而 <span class="strong"><strong>font-bar</strong></span> 会令程序设置<span class="emphasis"><em>类型</em></span>为 <span class="strong"><strong>data</strong></span>，……</p>
                  <p class="simpara">如果源码树的内容和<span class="emphasis"><em>类型</em></span>的设置不一致，<span class="strong"><strong>debmake</strong></span> 命令会发出警告。</p>
                </dd>
              </dl>
            </div>
          </div>
          <div class="section">
            <div class="titlepage">
              <div>
                <div>
                  <h4 class="title"><a id="package-split-example"/>5.5.1.2. 拆包的场景和例子</h4>
                </div>
              </div>
            </div>
            <p>对于下面这样的上游源代码示例，我们在这里给出使用 <span class="strong"><strong>debmake</strong></span> 处理时一些典型的 multiarch 软件包拆分的场景和做法：</p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">一个软件库源码 <span class="emphasis"><em>libfoo-1.0</em></span><span class="strong"><strong>.tar.gz</strong></span></li>
                <li class="listitem">一个软件工具源码 <span class="emphasis"><em>bar-1.0</em></span><span class="strong"><strong>.tar.gz</strong></span>，软件由编译型语言编写</li>
                <li class="listitem">一个软件工具源码 <span class="emphasis"><em>baz-1.0</em></span><span class="strong"><strong>.tar.gz</strong></span>，软件由解释型语言编写</li>
              </ul>
            </div>
            <div class="informaltable">
              <table class="informaltable" border="1">
                <colgroup>
                  <col class="col_1"/>
                  <col class="col_2"/>
                  <col class="col_3"/>
                  <col class="col_4"/>
                  <col class="col_5"/>
                </colgroup>
                <thead>
                  <tr>
                    <th style="text-align: left" valign="top">
                      <span class="emphasis">
                        <em>二进制软件包</em>
                      </span>
                    </th>
                    <th style="text-align: left" valign="top">
                      <span class="emphasis">
                        <em>类型</em>
                      </span>
                    </th>
                    <th style="text-align: left" valign="top">
                      <span class="strong">
                        <strong>Architecture:</strong>
                      </span>
                    </th>
                    <th style="text-align: left" valign="top">
                      <span class="strong">
                        <strong>Multi-Arch:</strong>
                      </span>
                    </th>
                    <th style="text-align: left" valign="top">软件包内容</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td style="text-align: left" valign="top">
                      <p>
                        <span class="strong">
                          <strong>lib</strong>
                        </span>
                        <span class="emphasis">
                          <em>foo1</em>
                        </span>
                      </p>
                    </td>
                    <td style="text-align: left" valign="top">
                      <p>
                        <span class="strong">
                          <strong>lib</strong>
                        </span>
                        <sup>*</sup>
                      </p>
                    </td>
                    <td style="text-align: left" valign="top">
                      <p>any</p>
                    </td>
                    <td style="text-align: left" valign="top">
                      <p>same</p>
                    </td>
                    <td style="text-align: left" valign="top">
                      <p>共享库，可共同安装</p>
                    </td>
                  </tr>
                  <tr>
                    <td style="text-align: left" valign="top">
                      <p>
                        <span class="strong">
                          <strong>lib</strong>
                        </span>
                        <span class="emphasis">
                          <em>foo</em>
                        </span>
                        <span class="strong">
                          <strong>-dev</strong>
                        </span>
                      </p>
                    </td>
                    <td style="text-align: left" valign="top">
                      <p>
                        <span class="strong">
                          <strong>dev</strong>
                        </span>
                        <sup>*</sup>
                      </p>
                    </td>
                    <td style="text-align: left" valign="top">
                      <p>any</p>
                    </td>
                    <td style="text-align: left" valign="top">
                      <p>same</p>
                    </td>
                    <td style="text-align: left" valign="top">
                      <p>共享库头文件及相关开发文件，可共同安装</p>
                    </td>
                  </tr>
                  <tr>
                    <td style="text-align: left" valign="top">
                      <p>
                        <span class="strong">
                          <strong>lib</strong>
                        </span>
                        <span class="emphasis">
                          <em>foo</em>
                        </span>
                        <span class="strong">
                          <strong>-tools</strong>
                        </span>
                      </p>
                    </td>
                    <td style="text-align: left" valign="top">
                      <p>
                        <span class="strong">
                          <strong>bin</strong>
                        </span>
                        <sup>*</sup>
                      </p>
                    </td>
                    <td style="text-align: left" valign="top">
                      <p>any</p>
                    </td>
                    <td style="text-align: left" valign="top">
                      <p>foreign</p>
                    </td>
                    <td style="text-align: left" valign="top">
                      <p>运行时支持程序，不可共同安装</p>
                    </td>
                  </tr>
                  <tr>
                    <td style="text-align: left" valign="top">
                      <p>
                        <span class="strong">
                          <strong>lib</strong>
                        </span>
                        <span class="emphasis">
                          <em>foo</em>
                        </span>
                        <span class="strong">
                          <strong>-doc</strong>
                        </span>
                      </p>
                    </td>
                    <td style="text-align: left" valign="top">
                      <p>
                        <span class="strong">
                          <strong>doc</strong>
                        </span>
                        <sup>*</sup>
                      </p>
                    </td>
                    <td style="text-align: left" valign="top">
                      <p>all</p>
                    </td>
                    <td style="text-align: left" valign="top">
                      <p>foreign</p>
                    </td>
                    <td style="text-align: left" valign="top">
                      <p>共享库文档</p>
                    </td>
                  </tr>
                  <tr>
                    <td style="text-align: left" valign="top">
                      <p>
                        <span class="emphasis">
                          <em>bar</em>
                        </span>
                      </p>
                    </td>
                    <td style="text-align: left" valign="top">
                      <p>
                        <span class="strong">
                          <strong>bin</strong>
                        </span>
                        <sup>*</sup>
                      </p>
                    </td>
                    <td style="text-align: left" valign="top">
                      <p>any</p>
                    </td>
                    <td style="text-align: left" valign="top">
                      <p>foreign</p>
                    </td>
                    <td style="text-align: left" valign="top">
                      <p>编译好的程序文件，不可共同安装</p>
                    </td>
                  </tr>
                  <tr>
                    <td style="text-align: left" valign="top">
                      <p>
                        <span class="emphasis">
                          <em>bar</em>
                        </span>
                        <span class="strong">
                          <strong>-doc</strong>
                        </span>
                      </p>
                    </td>
                    <td style="text-align: left" valign="top">
                      <p>
                        <span class="strong">
                          <strong>doc</strong>
                        </span>
                        <sup>*</sup>
                      </p>
                    </td>
                    <td style="text-align: left" valign="top">
                      <p>all</p>
                    </td>
                    <td style="text-align: left" valign="top">
                      <p>foreign</p>
                    </td>
                    <td style="text-align: left" valign="top">
                      <p>程序的配套文档文件</p>
                    </td>
                  </tr>
                  <tr>
                    <td style="text-align: left" valign="top">
                      <p>
                        <span class="emphasis">
                          <em>baz</em>
                        </span>
                      </p>
                    </td>
                    <td style="text-align: left" valign="top">
                      <p>
                        <span class="strong">
                          <strong>script</strong>
                        </span>
                      </p>
                    </td>
                    <td style="text-align: left" valign="top">
                      <p>all</p>
                    </td>
                    <td style="text-align: left" valign="top">
                      <p>foreign</p>
                    </td>
                    <td style="text-align: left" valign="top">
                      <p>解释型程序文件</p>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="section">
            <div class="titlepage">
              <div>
                <div>
                  <h4 class="title"><a id="libnames"/>5.5.1.3. 库软件包名称</h4>
                </div>
              </div>
            </div>
            <p>Let’s consider that the upstream source tarball of the <span class="strong"><strong>lib</strong></span><span class="emphasis"><em>foo</em></span> library is updated from <span class="strong"><strong>lib</strong></span><span class="emphasis"><em>foo-7.0</em></span><span class="strong"><strong>.tar.gz</strong></span> to <span class="strong"><strong>lib</strong></span><span class="emphasis"><em>foo-8.0</em></span><span class="strong"><strong>.tar.gz</strong></span> with a new SONAME major version which affects other packages.</p>
            <p>库的二进制软件包将必须从 <span class="strong"><strong>lib</strong></span><span class="emphasis"><em>foo7</em></span> 重命名为 <span class="strong"><strong>lib</strong></span><span class="emphasis"><em>foo8</em></span> 以保持使用 <span class="strong"><strong>unstable</strong></span> 套件的系统上所有依赖该库的软件包在上传了基于 <span class="strong"><strong>lib</strong></span><span class="emphasis"><em>foo-8.0</em></span><span class="strong"><strong>.tar.gz</strong></span> 的新库后仍然能够正常运行。</p>
            <div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
              <table border="0" summary="Warning">
                <tr>
                  <td rowspan="2" align="center" valign="top">
                    <img alt="[警告]" src="images/warning.png"/>
                  </td>
                  <th align="left">警告</th>
                </tr>
                <tr>
                  <td align="left" valign="top">
                    <p>如果这个二进制库软件包没有得到更名，许多使用 <span class="strong"><strong>unstable</strong></span> 套件的系统上的各个依赖该库的软件包会在新的库包上传后立刻破损，即便立刻请求进行 binNMU 上传也无法避免这个问题。由于种种原因，binNMU 不可能在上传后立刻开始进行，故无法缓解问题。</p>
                  </td>
                </tr>
              </table>
            </div>
            <p><span class="strong"><strong>-dev</strong></span> 软件包必须遵循以下命名规则：</p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">
                  <p class="simpara">使用<span class="strong"><strong>不带版本号的 -dev</strong></span> 软件包名称：<span class="strong"><strong>lib</strong></span><span class="emphasis"><em>foo</em></span><span class="strong"><strong>-dev</strong></span></p>
                  <div class="itemizedlist">
                    <ul class="itemizedlist">
                      <li class="listitem">该情况通常适用于依赖关系处于叶节点的库软件包。</li>
                      <li class="listitem">
                        <p class="simpara">仓库内只允许存在一个版本的库源码包。</p>
                        <div class="itemizedlist">
                          <ul class="itemizedlist">
                            <li class="listitem">其相关联的库软件包在库变迁进行时需要从 <span class="strong"><strong>lib</strong></span><span class="emphasis"><em>foo7</em></span> 重命名为 <span class="strong"><strong>lib</strong></span><span class="emphasis"><em>foo8</em></span> 以避免 <span class="strong"><strong>unstable</strong></span> 仓库内依赖关系的破坏。</li>
                          </ul>
                        </div>
                      </li>
                      <li class="listitem">该方法适用于简单 binNMU 可以快速解决所有受影响软件包对该库依赖的情况下。（<a class="ulink" href="https://en.wikipedia.org/wiki/Application_binary_interface">ABI</a> 有变化，过时的 <a class="ulink" href="https://en.wikipedia.org/wiki/Application_programming_interface">API</a> 被移除而常用、活跃的 API 未变化。）</li>
                      <li class="listitem">该方法有时也能适用于可协调进行手动的代码更新，影响范围限定在有限的一些软件包中的情况下。（<a class="ulink" href="https://en.wikipedia.org/wiki/Application_programming_interface">API</a> 有变化）</li>
                    </ul>
                  </div>
                </li>
                <li class="listitem">
                  <p class="simpara">使用<span class="strong"><strong>带版本的 -dev</strong></span> 软件包名称：<span class="strong"><strong>lib</strong></span><span class="emphasis"><em>foo7</em></span><span class="strong"><strong>-dev</strong></span> 和 <span class="strong"><strong>lib</strong></span><span class="emphasis"><em>foo8</em></span><span class="strong"><strong>-dev</strong></span></p>
                  <div class="itemizedlist">
                    <ul class="itemizedlist">
                      <li class="listitem">该情况通常适用于各类重要库软件包。</li>
                      <li class="listitem">
                        <p class="simpara">两个版本的库源码包可同时出现在发行版仓库中。</p>
                        <div class="itemizedlist">
                          <ul class="itemizedlist">
                            <li class="listitem">令所有依赖该库的软件包依赖 <span class="strong"><strong>lib</strong></span><span class="emphasis"><em>foo</em></span><span class="strong"><strong>-dev</strong></span>。</li>
                            <li class="listitem">令 <span class="strong"><strong>lib</strong></span><span class="emphasis"><em>foo7</em></span><span class="strong"><strong>-dev</strong></span> 和 <span class="strong"><strong>lib</strong></span><span class="emphasis"><em>foo8</em></span><span class="strong"><strong>-dev</strong></span> 两者都提供 <span class="strong"><strong>lib</strong></span><span class="emphasis"><em>foo</em></span><span class="strong"><strong>-dev</strong></span>。</li>
                            <li class="listitem">源码包需要从 <span class="strong"><strong>lib</strong></span><span class="emphasis"><em>foo-?.0</em></span><span class="strong"><strong>.tar.gz</strong></span> 相应地重命名为 <span class="strong"><strong>lib</strong></span><span class="emphasis"><em>foo7-7.0</em></span><span class="strong"><strong>.tar.gz</strong></span> 和 <span class="strong"><strong>lib</strong></span><span class="emphasis"><em>foo8-8.0</em></span><span class="strong"><strong>.tar.gz</strong></span>。</li>
                            <li class="listitem">需要仔细选择 <span class="strong"><strong>lib</strong></span><span class="emphasis"><em>foo7</em></span> 和 <span class="strong"><strong>lib</strong></span><span class="emphasis"><em>foo8</em></span> 软件包文件安装时的路径，如头文件等等，以保证它们可以同时安装。</li>
                          </ul>
                        </div>
                      </li>
                      <li class="listitem">可能的话，不要使用这个重量级的、需要大量人为干预的方法。</li>
                      <li class="listitem">该方法适用于存在多个依赖该库的软件包，且升级时常常涉及手动代码更新的场景。（<a class="ulink" href="https://en.wikipedia.org/wiki/Application_programming_interface">API</a> 有变化）否则，受影响的软件包会无法从源码重新构建并导致对发行而言致命的 bug 出现。</li>
                    </ul>
                  </div>
                </li>
              </ul>
            </div>
            <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">
              <table border="0" summary="Tip">
                <tr>
                  <td rowspan="2" align="center" valign="top">
                    <img alt="[提示]" src="images/tip.png"/>
                  </td>
                  <th align="left">提示</th>
                </tr>
                <tr>
                  <td align="left" valign="top">
                    <p>如果包内数据文件编码方案有所变化（如，从 latin1 变为 utf-8），该场景应比照 API 变化做类似的考虑与处理。</p>
                  </td>
                </tr>
              </table>
            </div>
            <p>参见 <a class="xref" href="ch05.zh-cn.html#lib" title="5.18. 库软件包">第 5.18 节 “库软件包”</a>。</p>
          </div>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h3 class="title"><a id="substvar"/>5.5.2. Substvar</h3>
              </div>
            </div>
          </div>
          <p><span class="strong"><strong>debian/control</strong></span> 也定义了软件包的依赖关系，其中<a class="ulink" href="https://www.debian.org/doc/debian-policy/ch-source.html#s-substvars">变量替换机制</a>（substvar）的功能可以用来将软件包维护者从跟踪（大多数简单的）软件包依赖的重复劳动中解放出来。请参见 <span class="strong"><strong>deb-substvars</strong></span>(5)。</p>
          <p><span class="strong"><strong>debmake</strong></span> 命令支持下列变量替换指令：</p>
          <div class="itemizedlist">
            <ul class="itemizedlist">
              <li class="listitem"><span class="strong"><strong>${misc:Depends}</strong></span>，可用于所有二进制软件包</li>
              <li class="listitem"><span class="strong"><strong>${misc:Pre-Depends}</strong></span>，可用于所有 multiarch 软件包</li>
              <li class="listitem"><span class="strong"><strong>${shlibs:Depends}</strong></span>，可用于所有含有二进制可执行文件或库的软件包</li>
              <li class="listitem"><span class="strong"><strong>${python:Depends}</strong></span>，可用于所有 Python 软件包</li>
              <li class="listitem"><span class="strong"><strong>${python3:Depends}</strong></span>，可用于所有 Python3 软件包</li>
              <li class="listitem"><span class="strong"><strong>${perl:Depends}</strong></span>，用于所有 Perl 软件包</li>
              <li class="listitem"><span class="strong"><strong>${ruby:Depends}</strong></span>，用于所有 Ruby 软件包</li>
            </ul>
          </div>
          <p>For the shared library, required libraries found simply by "<span class="strong"><strong>objdump -p</strong></span> <span class="emphasis"><em>/path/to/program</em></span> <span class="strong"><strong>| grep NEEDED</strong></span>" are covered by the <span class="strong"><strong>shlib</strong></span> substvar.</p>
          <p>对于 Python 和其它解释器来说，所需的模块通常由对包含类似“<span class="strong"><strong>import</strong></span>”、“<span class="strong"><strong>use</strong></span>”、“<span class="strong"><strong>require</strong></span>”等等关键字的行进行解析，并会体现在各自对应的变量替换占位符所在位置上。</p>
          <p>对其它没有部署属于自己范畴内的变量替换机制的情况，<span class="strong"><strong>misc</strong></span> 变量替换占位符通常用来覆盖对应的依赖替换需求。</p>
          <p>对 POSIX shell 程序来说，并没有简单的办法来验证其依赖关系，substvar 的变量替换也无法自动得出它们的依赖。</p>
          <p>对使用动态加载机制，包括 <a class="ulink" href="https://wiki.gnome.org/Projects/GObjectIntrospection">GObject introspection</a> 机制的库和模块来说，现在没有简单的方法可以检查依赖关系，变量替换机制也无法自动推导出所需的依赖。</p>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h3 class="title"><a id="binnmu"/>5.5.3. binNMU 安全</h3>
              </div>
            </div>
          </div>
          <p>一个 <a class="ulink" href="https://wiki.debian.org/binNMU">binNMU（二进制非维护者上传）</a> 是为库迁移或其它目的所作的非维护者软件包上传。在一次 binNMU 上传中，只有“<span class="strong"><strong>Architecture: any</strong></span>”的软件包会被重构建，其版本号会在末尾附加一个编号（例如，原来版本为 2.3.4-3，新上传的包版本会变成 2.3.4-3+b1）。所有“<span class="strong"><strong>Architecture: all</strong></span>”的包将不会重新构建。</p>
          <p>来自同一个源码包的各个二进制包如果在 <span class="strong"><strong>debian/control</strong></span> 文件中有互相的依赖关系，这些二进制包通常情况下应当对 binNMU 是安全的（即，进行 binNMU 不会破坏依赖关系）。然而，在“<span class="strong"><strong>Architecture: any</strong></span>”和“<span class="strong"><strong>Architecture: all</strong></span>”的软件包同时由同一源码包产出，且互相之间有依赖关系时，需要小心对待所依赖的版本，必要时应做出调整。</p>
          <div class="itemizedlist">
            <ul class="itemizedlist">
              <li class="listitem">
                <p class="simpara">“<span class="strong"><strong>Architecture: any</strong></span>”的软件包依赖于“<span class="strong"><strong>Architecture: any</strong></span>”<span class="emphasis"><em>foo</em></span> 软件包</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist">
                    <li class="listitem"><span class="strong"><strong>Depends:</strong></span> <span class="emphasis"><em>foo</em></span> <span class="strong"><strong>(= ${binary:Version})</strong></span></li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p class="simpara">“<span class="strong"><strong>Architecture: any</strong></span>”的软件包依赖于“<span class="strong"><strong>Architecture: all</strong></span>”<span class="emphasis"><em>bar</em></span> 软件包</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist">
                    <li class="listitem"><span class="strong"><strong>Depends:</strong></span> <span class="emphasis"><em>bar</em></span> <span class="strong"><strong>(= ${source:Version}</strong></span></li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p class="simpara">“<span class="strong"><strong>Architecture: all</strong></span>”的软件包依赖于“<span class="strong"><strong>Architecture: any</strong></span>”<span class="emphasis"><em>baz</em></span> 软件包</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist">
                    <li class="listitem"><span class="strong"><strong>Depends:</strong></span> <span class="emphasis"><em>baz</em></span> <span class="strong"><strong>(&gt;= ${source:Version})</strong></span>, <span class="emphasis"><em>baz</em></span> <span class="strong"><strong>(&lt;&lt; ${source:Upstream-Version}.0~)</strong></span></li>
                  </ul>
                </div>
              </li>
            </ul>
          </div>
        </div>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="changelog"/>5.6. debian/changelog</h2>
            </div>
          </div>
        </div>
        <p><span class="strong"><strong>debian/changelog</strong></span> 文件记录了 Debian 软件包的历史并在其第一行定义了上游软件包的版本和 Debian 修订版本。所有改变的内容应当以明确、正式而简明的语言风格进行记录。</p>
        <div class="itemizedlist">
          <ul class="itemizedlist">
            <li class="listitem">
              <p class="simpara">即便您在自己独立进行软件包上传，您也必须记录所有较重要、用户可见的变更，例如：</p>
              <div class="itemizedlist">
                <ul class="itemizedlist">
                  <li class="listitem">安全相关的漏洞修复。</li>
                  <li class="listitem">用户界面变动。</li>
                </ul>
              </div>
            </li>
            <li class="listitem">
              <p class="simpara">如果您需要他人协助您进行上传，您应当更详尽地记录变更内容，包括所有打包相关的变动，从而方便他人对您的软件包进行审查。</p>
              <div class="itemizedlist">
                <ul class="itemizedlist">
                  <li class="listitem">协助上传的人员不应该也通常不会猜测您没有写出来的想法，所以请认真书写变更信息。</li>
                  <li class="listitem">通常来说，协助您上传的人的时间比您的时间更宝贵。</li>
                </ul>
              </div>
            </li>
          </ul>
        </div>
        <p>The <span class="strong"><strong>debmake</strong></span> command creates the initial template file with the upstream package version and the Debian revision.  The distribution is set to <span class="strong"><strong>UNRELEASED</strong></span> to prevent accidental upload to the Debian archive.</p>
        <p>通常使用 <span class="strong"><strong>debchange</strong></span> 命令（它具有一个别名，即 <span class="strong"><strong>dch</strong></span>）对其进行编辑。</p>
        <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">
          <table border="0" summary="Tip">
            <tr>
              <td rowspan="2" align="center" valign="top">
                <img alt="[提示]" src="images/tip.png"/>
              </td>
              <th align="left">提示</th>
            </tr>
            <tr>
              <td align="left" valign="top">
                <p>您也可以手动使用任何文本编辑器修改 <span class="strong"><strong>debian/changelog</strong></span> 文件，只要您能够遵循 <span class="strong"><strong>debchange</strong></span> 命令所使用的特定文本排版格式即可。</p>
              </td>
            </tr>
          </table>
        </div>
        <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">
          <table border="0" summary="Tip">
            <tr>
              <td rowspan="2" align="center" valign="top">
                <img alt="[提示]" src="images/tip.png"/>
              </td>
              <th align="left">提示</th>
            </tr>
            <tr>
              <td align="left" valign="top">
                <p><span class="strong"><strong>debian/changelog</strong></span> 文件使用的日期字符串可以使用“<span class="strong"><strong>LC_ALL=C date -R</strong></span>”命令手动生成。</p>
              </td>
            </tr>
          </table>
        </div>
        <p>This is installed in the <span class="strong"><strong>/usr/share/doc/</strong></span><span class="emphasis"><em>binarypackage</em></span> directory as <span class="strong"><strong>changelog.Debian.gz</strong></span> by the <span class="strong"><strong>dh_installchangelogs</strong></span> command.</p>
        <p>上游的变更日志则会安装至 <span class="strong"><strong>/usr/share/doc/</strong></span><span class="emphasis"><em>binarypackage</em></span> 目录中，文件名为 <span class="strong"><strong>changelog.gz</strong></span>。</p>
        <p>The upstream changelog is automatically found by the <span class="strong"><strong>dh_installchangelogs</strong></span> using the case insensitive match of its file name to <span class="strong"><strong>changelog</strong></span>, <span class="strong"><strong>changes</strong></span>, <span class="strong"><strong>changelog.txt</strong></span>, <span class="strong"><strong>changes.txt</strong></span>, <span class="strong"><strong>history</strong></span>, <span class="strong"><strong>history.txt</strong></span>, or <span class="strong"><strong>changelog.md</strong></span> and searched in the <span class="strong"><strong>./</strong></span> <span class="strong"><strong>doc/</strong></span> or <span class="strong"><strong>docs/</strong></span> directories.</p>
        <p>当您完成了主要打包工作并验证了其质量之后，请考虑运行“<span class="strong"><strong>dch -r</strong></span>”命令并将最终完成的 <span class="strong"><strong>debian/changelog</strong></span> 文件中发行版（distribution）部分进行设置，通常该字段应当使用 <span class="strong"><strong>unstable</strong></span>。<a href="#ftn.idm2484" class="footnote" id="idm2484"><sup class="footnote">[13]</sup></a> 如果您的打包是一次向后移植（backports）、是安全更新或是对长期支持版的上传等等其它情况，请使用相应合适的发行版名称。</p>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="copyright"/>5.7. debian/copyright</h2>
            </div>
          </div>
        </div>
        <p>Debian 以十分严肃的态度对待版权和许可证信息。“Debian 政策手册”强制规定软件包的 <span class="strong"><strong>debian/copyright</strong></span> 文件中需要提供相关信息的摘要。</p>
        <p>您应当按照 <a class="ulink" href="https://www.debian.org/doc/packaging-manuals/copyright-format/1.0/">机器可解析的 debian/copyright 文件</a>（DEP-5）对其进行排版。</p>
        <div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;">
          <table border="0" summary="Caution">
            <tr>
              <td rowspan="2" align="center" valign="top">
                <img alt="[小心]" src="images/caution.png"/>
              </td>
              <th align="left">小心</th>
            </tr>
            <tr>
              <td align="left" valign="top">
                <p>这里的 <span class="strong"><strong>debian/copyright</strong></span> 文件中描述的许可证信息匹配信息应当合适地进行排序，以确保越宽泛的文件匹配越靠前。请参见 <a class="xref" href="ch06.zh-cn.html#koption" title="6.4. debmake -k">第 6.4 节 “debmake -k”</a>。</p>
              </td>
            </tr>
          </table>
        </div>
        <p><span class="strong"><strong>debmake</strong></span> 命令会以扫描整个源码树的方式创建初步的、兼容 DEP-5 的模板文件。它会内部调用许可证检查工具来对许可证文本进行分类。<a href="#ftn.idm2500" class="footnote" id="idm2500"><sup class="footnote">[14]</sup></a></p>
        <p>除非明确指定（有些严格过头的） <span class="strong"><strong>-P</strong></span> 选项，<span class="strong"><strong>debmake</strong></span> 命令会为了实用性而跳过对自动生成的文件的检查与报告，默认它们采用宽松的许可证。</p>
        <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
          <table border="0" summary="Note">
            <tr>
              <td rowspan="2" align="center" valign="top">
                <img alt="[注意]" src="images/note.png"/>
              </td>
              <th align="left">注意</th>
            </tr>
            <tr>
              <td align="left" valign="top">
                <p>如果您发现了这个许可证检查工具存在一些问题，请向 <span class="strong"><strong>debmake</strong></span> 软件包提交缺陷报告并提供包含出现问题的许可证和版权信息在内的相关文本内容。</p>
              </td>
            </tr>
          </table>
        </div>
        <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
          <table border="0" summary="Note">
            <tr>
              <td rowspan="2" align="center" valign="top">
                <img alt="[注意]" src="images/note.png"/>
              </td>
              <th align="left">注意</th>
            </tr>
            <tr>
              <td align="left" valign="top">
                <p><span class="strong"><strong>debmake</strong></span> 命令专注于在创建 <span class="strong"><strong>debian/copyright</strong></span> 模板时聚合相同的授权和许可证信息并收录其详细内容。为了在有限的时间内尽可能完成工作，工具将只会提取文件中第一块看起来像授权文本或许可证声明的部分。因此，生成的许可证信息可能并不完美。请同时考虑使用其它工具，如 <span class="strong"><strong>licensecheck</strong></span> 辅助进行检查。</p>
              </td>
            </tr>
          </table>
        </div>
        <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">
          <table border="0" summary="Tip">
            <tr>
              <td rowspan="2" align="center" valign="top">
                <img alt="[提示]" src="images/tip.png"/>
              </td>
              <th align="left">提示</th>
            </tr>
            <tr>
              <td align="left" valign="top">
                <p>我们强烈推荐您使用 <span class="strong"><strong>licensecheck</strong></span>(1) 命令再次检查源码许可证的状态，并在有必要的情况下进行人工代码审查。</p>
              </td>
            </tr>
          </table>
        </div>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="patches"/>5.8. debian/patches/*</h2>
            </div>
          </div>
        </div>
        <p>在<span class="strong"><strong>构建</strong></span>过程开始之前，<span class="strong"><strong>debian/patches/</strong></span> 目录内的 <span class="strong"><strong>-p1</strong></span> 等级的补丁将会按照在 <span class="strong"><strong>debian/patches/series</strong></span> 文件中指定的顺序依次应用于上游代码树中。</p>
        <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
          <table border="0" summary="Note">
            <tr>
              <td rowspan="2" align="center" valign="top">
                <img alt="[注意]" src="images/note.png"/>
              </td>
              <th align="left">注意</th>
            </tr>
            <tr>
              <td align="left" valign="top">
                <p>本土 Debian 软件包（参见 <a class="xref" href="ch05.zh-cn.html#native" title="5.3. 本土 Debian 软件包">第 5.3 节 “本土 Debian 软件包”</a>）将不使用这些文件。</p>
              </td>
            </tr>
          </table>
        </div>
        <p>要准备这一系列 <span class="strong"><strong>-p1</strong></span> 等级的补丁，有几种不同的方式可供您选择。</p>
        <div class="itemizedlist">
          <ul class="itemizedlist">
            <li class="listitem">
              <p class="simpara"><span class="strong"><strong>diff</strong></span> 命令</p>
              <div class="itemizedlist">
                <ul class="itemizedlist">
                  <li class="listitem">参见 <a class="xref" href="ch04.zh-cn.html#diff-u" title="4.8.1. 使用 diff -u 处理补丁">第 4.8.1 节 “使用 diff -u 处理补丁”</a></li>
                  <li class="listitem">
                    <p class="simpara">原始但万能的方法</p>
                    <div class="itemizedlist">
                      <ul class="itemizedlist">
                        <li class="listitem">补丁的来源多种多样，它可以来自其它发行版、邮件列表中的帖文或是来自上游 <span class="strong"><strong>git</strong></span> 仓库的拣选补丁，由“<span class="strong"><strong>git format-patches</strong></span>”生成</li>
                      </ul>
                    </div>
                  </li>
                  <li class="listitem">不涉及 <span class="strong"><strong>.pc/</strong></span> 目录的问题</li>
                  <li class="listitem">不修改上游源代码树</li>
                  <li class="listitem">手工更新 <span class="strong"><strong>debian/patches/series</strong></span> 文件</li>
                </ul>
              </div>
            </li>
            <li class="listitem">
              <p class="simpara"><span class="strong"><strong>dquilt</strong></span> 命令</p>
              <div class="itemizedlist">
                <ul class="itemizedlist">
                  <li class="listitem">参见 <a class="xref" href="ch03.zh-cn.html#quilt-setup" title="3.4. quilt">第 3.4 节 “quilt”</a></li>
                  <li class="listitem">基本的便利方案</li>
                  <li class="listitem">会以合适方式生成 <span class="strong"><strong>.pc/</strong></span> 目录及其中的数据</li>
                  <li class="listitem">会修改上游源代码树</li>
                </ul>
              </div>
            </li>
            <li class="listitem">
              <p class="simpara">“<span class="strong"><strong>dpkg-source --commit</strong></span>”命令</p>
              <div class="itemizedlist">
                <ul class="itemizedlist">
                  <li class="listitem">参见 <a class="xref" href="ch04.zh-cn.html#dpkg-source-commit" title="4.8.3. 使用 dpkg-source --commit 处理补丁">第 4.8.3 节 “使用 dpkg-source --commit 处理补丁”</a></li>
                  <li class="listitem">更新、更优雅一些的方案</li>
                  <li class="listitem">会以合适方式生成 <span class="strong"><strong>.pc/</strong></span> 目录及其中的数据</li>
                  <li class="listitem">会修改上游源代码树</li>
                </ul>
              </div>
            </li>
            <li class="listitem">
              <p class="simpara">由 <span class="strong"><strong>dpkg-buildpackage</strong></span> 自动生成补丁</p>
              <div class="itemizedlist">
                <ul class="itemizedlist">
                  <li class="listitem">参见 <a class="xref" href="ch05.zh-cn.html#alt-vcs" title="5.14. 在版本控制系统中进行记录（备选方案）">第 5.14 节 “在版本控制系统中进行记录（备选方案）”</a></li>
                  <li class="listitem">在 <span class="strong"><strong>debian/source/local-options</strong></span> 文件中添加 <span class="strong"><strong>single-debian-patch</strong></span> 这一行</li>
                  <li class="listitem">设置 <span class="strong"><strong>debian/source/local-patch-header</strong></span> 文件</li>
                  <li class="listitem">不涉及 <span class="strong"><strong>.pc/</strong></span> 目录的问题</li>
                  <li class="listitem">在 Debian 分支中（常见为 <span class="strong"><strong>master</strong></span> 分支）存储经过修改的上游源代码树</li>
                </ul>
              </div>
            </li>
            <li class="listitem">
              <p class="simpara"><span class="strong"><strong>gbp-pq</strong></span> 命令</p>
              <div class="itemizedlist">
                <ul class="itemizedlist">
                  <li class="listitem">配合 <span class="strong"><strong>git-buildpackage</strong></span> 工具的基本 <span class="strong"><strong>git</strong></span> 工作流</li>
                  <li class="listitem">不涉及 <span class="strong"><strong>.pc/</strong></span> 目录的问题</li>
                  <li class="listitem">在可丢弃分支上保存经过修改的上游源码树（<span class="strong"><strong>patch-queue/master</strong></span>）</li>
                  <li class="listitem">在 Debian 分支中（常见为 <span class="strong"><strong>master</strong></span> 分支）存储未经修改的源码树</li>
                </ul>
              </div>
            </li>
            <li class="listitem">
              <p class="simpara"><span class="strong"><strong>gbp-dpm</strong></span> 命令</p>
              <div class="itemizedlist">
                <ul class="itemizedlist">
                  <li class="listitem">配合 <span class="strong"><strong>git-dpm</strong></span> 软件包的更细致的 <span class="strong"><strong>git</strong></span> 工作流</li>
                  <li class="listitem">不涉及 <span class="strong"><strong>.pc/</strong></span> 目录的问题</li>
                  <li class="listitem">在补丁分支中（通常命名为 <span class="strong"><strong>patched/</strong></span><span class="emphasis"><em>随便啥名字</em></span>）存储经过修改的上游源码树</li>
                  <li class="listitem">在 Debian 分支中（通常命名为 <span class="strong"><strong>master/</strong></span><span class="emphasis"><em>随便啥名字</em></span>）存储未经修改的上游源码树</li>
                </ul>
              </div>
            </li>
          </ul>
        </div>
        <p>无论这些补丁的来源如何，都建议使用兼容于 <a class="ulink" href="http://dep.debian.net/deps/dep3/">DEP-3</a> 的头部信息对其进行标记。</p>
        <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">
          <table border="0" summary="Tip">
            <tr>
              <td rowspan="2" align="center" valign="top">
                <img alt="[提示]" src="images/tip.png"/>
              </td>
              <th align="left">提示</th>
            </tr>
            <tr>
              <td align="left" valign="top">
                <p><span class="strong"><strong>dgit</strong></span> 软件包提供了另外一套直接使用 git 集成操作 Debian 软件包仓库的工具。</p>
              </td>
            </tr>
          </table>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h3 class="title"><a id="dpkg-source-x"/>5.8.1. dpkg-source -x</h3>
              </div>
            </div>
          </div>
          <p>“<span class="strong"><strong>dpkg-source -x</strong></span>” 命令可以对 Debian 源码包进行解压缩。</p>
          <p>该命令通常会将 <span class="strong"><strong>debian/patches/</strong></span> 目录内的补丁应用在源码树中，并将补丁状态记录在 <span class="strong"><strong>.pc/</strong></span> 目录中。</p>
          <p>如果您想保持源码树不做修改（例如，为了在 <a class="xref" href="ch05.zh-cn.html#vcs" title="5.13. 在版本控制系统中进行记录（标准）">第 5.13 节 “在版本控制系统中进行记录（标准）”</a> 中继续使用），请在命令行中使用 <span class="strong"><strong>--skip-patches</strong></span> 选项。</p>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h3 class="title"><a id="quilt-dpkg"/>5.8.2. dquilt 和 dpkg-source</h3>
              </div>
            </div>
          </div>
          <p>The <span class="strong"><strong>quilt</strong></span> command (or its wrapped <span class="strong"><strong>dquilt</strong></span> command) was needed to manage the <span class="strong"><strong>-p1</strong></span> patches in the <span class="strong"><strong>debian/patches/</strong></span> directory before the <span class="strong"><strong>--commit</strong></span> feature was added to the <span class="strong"><strong>dpkg-source</strong></span> command in 1.16.1.</p>
          <p>在使用 <span class="strong"><strong>dpkg-source</strong></span> 命令时，补丁应当能够干净地进行应用。因此在补丁行数出现偏移或者其它情况出现时，您不能直接将旧补丁原封不动地复制到新版上游发布对应打包版本的目录中。</p>
          <p>与此相对的是 <span class="strong"><strong>dquilt</strong></span> 命令（参见 <a class="xref" href="ch03.zh-cn.html#quilt-setup" title="3.4. quilt">第 3.4 节 “quilt”</a>）对补丁的处理更加宽容。您可以调用 <span class="strong"><strong>dquilt</strong></span> 命令对补丁进行正常化。</p>
          <pre class="screen"> $ while dquilt push; do dquilt refresh ; done
 $ dquilt pop -a</pre>
          <p>使用 <span class="strong"><strong>dpkg-source</strong></span> 命令比起使用 <span class="strong"><strong>dquilt</strong></span> 命令来说存在一大优势：<span class="strong"><strong>dquilt</strong></span> 命令无法自动处理二进制文件出现变更的情况，而 <span class="strong"><strong>dpkg-source</strong></span> 命令能够探测出现内容变动的二进制文件，并将其列入 <span class="strong"><strong>debian/source/include-binaries</strong></span> 文件以便在 Debian 打包用压缩包中将文件囊括其中。</p>
        </div>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="signing-key"/>5.9. debian/upstream/signing-key.asc</h2>
            </div>
          </div>
        </div>
        <p>某些软件包由 GPG 密钥进行了签名。</p>
        <p>例如，<a class="ulink" href="https://www.gnu.org/software/hello/">GNU hello</a> 可使用 HTTP 协议从 <a class="ulink" href="https://ftp.gnu.org/gnu/hello/">https://ftp.gnu.org/gnu/hello/</a> 下载。它含有以下文件：</p>
        <div class="itemizedlist">
          <ul class="itemizedlist">
            <li class="listitem"><span class="strong"><strong>hello-</strong></span><span class="emphasis"><em>version</em></span><span class="strong"><strong>.tar.gz</strong></span>（上游源代码）</li>
            <li class="listitem"><span class="strong"><strong>hello-</strong></span><span class="emphasis"><em>version</em></span><span class="strong"><strong>.tar.gz.sig</strong></span>（分离的签名）nature)</li>
          </ul>
        </div>
        <p>我们现在来选择最新的版本套装。</p>
        <pre class="screen">$ wget https://ftp.gnu.org/gnu/hello/hello-2.9.tar.gz
 ...
$ wget https://ftp.gnu.org/gnu/hello/hello-2.9.tar.gz.sig
 ...
$ gpg --verify hello-2.9.tar.gz.sig
gpg: Signature made Thu 10 Oct 2013 08:49:23 AM JST using DSA key ID 80EE4A00
gpg: Can't check signature: public key not found</pre>
        <p>如果您从邮件列表获知上游维护者所使用的 GPG 公钥信息，请将它作为 <span class="strong"><strong>debian/upstream/signing-key.asc</strong></span> 文件进行存储。否则，请使用 hkp 公钥服务器并经由您的<a class="ulink" href="https://en.wikipedia.org/wiki/Web_of_trust">信任网</a>进行验证。</p>
        <pre class="screen">$ gpg --keyserver hkp://keys.gnupg.net --recv-key 80EE4A00
gpg: requesting key 80EE4A00 from hkp server keys.gnupg.net
gpg: key 80EE4A00: public key "Reuben Thomas &lt;rrt@sc3d.org&gt;" imported
gpg: no ultimately trusted keys found
gpg: Total number processed: 1
gpg:               imported: 1
$ gpg --verify hello-2.9.tar.gz.sig
gpg: Signature made Thu 10 Oct 2013 08:49:23 AM JST using DSA key ID 80EE4A00
gpg: Good signature from "Reuben Thomas &lt;rrt@sc3d.org&gt;"
  ...
Primary key fingerprint: 9297 8852 A62F A5E2 85B2  A174 6808 9F73 80EE 4A00</pre>
        <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">
          <table border="0" summary="Tip">
            <tr>
              <td rowspan="2" align="center" valign="top">
                <img alt="[提示]" src="images/tip.png"/>
              </td>
              <th align="left">提示</th>
            </tr>
            <tr>
              <td align="left" valign="top">
                <p>如果您的网络环境阻挡了对 HKP <span class="strong"><strong>11371</strong></span> 端口的访问，请考虑使用“<span class="strong"><strong>hkp://keyserver.ubuntu.com:80</strong></span>”。</p>
              </td>
            </tr>
          </table>
        </div>
        <p>在确认密钥身份 <span class="strong"><strong>80EE4A00</strong></span> 值得信任之后，应当下载其公钥并将其保存在 <span class="strong"><strong>debian/upstream/signing-key.asc</strong></span> 文件中。</p>
        <pre class="screen">$ gpg --armor --export 80EE4A00 &gt;debian/upstream/signing-key.asc</pre>
        <p>之后，应相应地在 <span class="strong"><strong>debian/watch</strong></span> 文件中做如下的修改。</p>
        <pre class="screen">version=4
pgpsigurlmangle=s/$/.sig/  https://ftp.gnu.org/gnu/hello/ hello-(\d[\d.]*)\.tar\.(?:gz|bz2|xz)</pre>
        <p>现在 <span class="strong"><strong>uscan</strong></span> 命令会在扫描时自动使用 GPG 签名验证上游源码包的真实性。</p>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="dfsg"/>5.10. debian/watch 和 DFSG</h2>
            </div>
          </div>
        </div>
        <p>Debian 严肃地对待软件自由，遵循 <a class="ulink" href="https://www.debian.org/social_contract.html#guidelines">Debian 自由软件指导方针（DFSG）</a>。</p>
        <p>在使用 <span class="strong"><strong>uscan</strong></span> 命令来更新 Debian 打包所用代码时，上游源码包（tarball）中不符合<a class="ulink" href="https://www.debian.org/social_contract.html#guidelines">Debian 自由软件指导方针（DFSG）</a>的部分可以利用该工具简单地进行移除。</p>
        <div class="itemizedlist">
          <ul class="itemizedlist">
            <li class="listitem">在 <span class="strong"><strong>debian/copyright</strong></span> 文件中的 <span class="strong"><strong>Files-Excluded</strong></span> 一节中列出需要移除的文件。</li>
            <li class="listitem">在 <span class="strong"><strong>debian/watch</strong></span> 文件中列出下载上游源码包（tarball）所使用的 URL。</li>
            <li class="listitem">
              <p class="simpara">运行 <span class="strong"><strong>uscan</strong></span> 命令以下载新的上游源码包（tarball）。</p>
              <div class="itemizedlist">
                <ul class="itemizedlist">
                  <li class="listitem">作为替代方案，您也可以使用“<span class="strong"><strong>gbp import-orig --uscan --pristine-tar</strong></span>”命令。</li>
                </ul>
              </div>
            </li>
            <li class="listitem">最后得到 tarball 的版本编号会附加一个额外的后缀 <span class="strong"><strong>+dfsg</strong></span>。</li>
          </ul>
        </div>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="debianconf"/>5.11. 其它 debian/* 文件</h2>
            </div>
          </div>
        </div>
        <p>另外也可以添加一些可选的配置文件并放入 <span class="strong"><strong>debian/</strong></span> 目录。它们大多用于控制由 <span class="strong"><strong>debhelper</strong></span> 软件包提供的 <span class="strong"><strong>dh_</strong></span>* 命令的行为，但也有一些文件会影响 <span class="strong"><strong>dpkg-source</strong></span>、<span class="strong"><strong>lintian</strong></span> 和 <span class="strong"><strong>gbp</strong></span> 这些命令。</p>
        <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">
          <table border="0" summary="Tip">
            <tr>
              <td rowspan="2" align="center" valign="top">
                <img alt="[提示]" src="images/tip.png"/>
              </td>
              <th align="left">提示</th>
            </tr>
            <tr>
              <td align="left" valign="top">
                <p>请检查 <span class="strong"><strong>debhelper</strong></span>(7) 的内容以了解当前可用的 <span class="strong"><strong>dh_</strong></span>* 命令列表。</p>
              </td>
            </tr>
          </table>
        </div>
        <p>这些 <span class="strong"><strong>debian/</strong></span><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>.</strong></span>* 的文件提供了设置文件安装路径的强大功能。即使上游源代码没有构建系统，这个软件依然可以利用这里提到的这些文件来进行打包。请参考 <a class="xref" href="ch08.zh-cn.html#nomakefile" title="8.2. 无 Makefile（shell，命令行界面）">第 8.2 节 “无 Makefile（shell，命令行界面）”</a> 的示例。</p>
        <p>下面列表中出现的“-x[1234]”上标指示了 <span class="strong"><strong>debmake</strong></span> <span class="strong"><strong>-x</strong></span> 选项生成对应模板文件所需要的最小值。请参考 <span class="strong"><strong>debmake</strong></span>(1) 以了解详情。</p>
        <p>下面按照字母表顺序列出一些值得注意的可选配置文件。</p>
        <div class="variablelist">
          <dl class="variablelist">
            <dt>
              <span class="term"><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>.bug-control</strong></span> <sup><span class="strong"><strong>-x3</strong></span></sup></span>
            </dt>
            <dd>将安装至 <span class="emphasis"><em>binarypackage</em></span> 软件包的 <span class="strong"><strong>usr/share/bug/</strong></span><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>/control</strong></span> 位置。另请参考<a class="xref" href="ch05.zh-cn.html#bug" title="5.24. 错误报告">第 5.24 节 “错误报告”</a>。</dd>
            <dt>
              <span class="term"><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>.bug-presubj</strong></span> <sup><span class="strong"><strong>-x3</strong></span></sup></span>
            </dt>
            <dd>将安装至 <span class="emphasis"><em>binarypackage</em></span> 软件包的 <span class="strong"><strong>usr/share/bug/</strong></span><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>/presubj</strong></span> 位置。另请参考<a class="xref" href="ch05.zh-cn.html#bug" title="5.24. 错误报告">第 5.24 节 “错误报告”</a>。</dd>
            <dt>
              <span class="term"><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>.bug-script</strong></span> <sup><span class="strong"><strong>-x3</strong></span></sup></span>
            </dt>
            <dd>将安装至 <span class="emphasis"><em>binarypackage</em></span> 软件包的 <span class="strong"><strong>usr/share/bug/</strong></span><span class="emphasis"><em>binarypackage</em></span> or <span class="strong"><strong>usr/share/bug/</strong></span><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>/script</strong></span> 位置。另请参考<a class="xref" href="ch05.zh-cn.html#bug" title="5.24. 错误报告">第 5.24 节 “错误报告”</a>。</dd>
            <dt>
              <span class="term">
                <span class="emphasis">
                  <em>binarypackage</em>
                </span>
                <span class="strong">
                  <strong>.bash-completion</strong>
                </span>
              </span>
            </dt>
            <dd>
              <p class="simpara">列出需要安装的 <code class="literal">bash</code> 补全脚本。</p>
              <p class="simpara">需要在构建环境和用户环境内均安装 <code class="literal">bash-completion</code> 软件包。</p>
              <p class="simpara">另请参考<span class="strong"><strong>dh_bash-completion</strong></span>(1)。</p>
            </dd>
            <dt>
              <span class="term"><span class="strong"><strong>clean</strong></span> <sup><span class="strong"><strong>-x2</strong></span></sup></span>
            </dt>
            <dd>
              <p class="simpara">列出（构建前）未被 <span class="strong"><strong>dh_auto_clean</strong></span> 命令清理，且需要手工清理的文件。</p>
              <p class="simpara">另请参考 <span class="strong"><strong>dh_auto_clean</strong></span>(1) 和 <span class="strong"><strong>dh_clean</strong></span>(1)。</p>
            </dd>
            <dt>
              <span class="term"><span class="strong"><strong>compat</strong></span> <sup><span class="strong"><strong>-x1</strong></span></sup></span>
            </dt>
            <dd>
              <p class="simpara">设置 <span class="strong"><strong>debhelper</strong></span> 兼容等级（当前为“<span class="strong"><strong>9</strong></span>”）。</p>
              <p class="simpara">另请参考 <span class="strong"><strong>debhelper</strong></span>(8) 中“COMPATIBILITY LEVELS”一节。</p>
            </dd>
            <dt>
              <span class="term">
                <span class="emphasis">
                  <em>binarypackage</em>
                </span>
                <span class="strong">
                  <strong>.conffile</strong>
                </span>
              </span>
            </dt>
            <dd>
              <p class="simpara">如果兼容等级大于 3（“compat &gt;= 3”），您没有创建该文件的必要，因为所有 <span class="strong"><strong>etc/</strong></span> 目录下的文件都是配置文件（conffiles）。</p>
              <p class="simpara">如果您正要打包的程序要求每个用户都对 <span class="strong"><strong>/etc</strong></span> 目录下的配置文件进行修改，可以采取两种常见办法使其不作为 conffile 配置文件出现，避免 <span class="strong"><strong>dpkg</strong></span> 命令处理软件包时给出不必要的处理选项。</p>
              <div class="itemizedlist">
                <ul class="itemizedlist">
                  <li class="listitem">在 <span class="strong"><strong>/etc</strong></span> 目录下创建一个符号链接，指向 <span class="strong"><strong>/var</strong></span> 目录下的某些文件；实际存在的文件则使用维护者脚本（maintainer script）予以创建。</li>
                  <li class="listitem">使用维护者脚本（maintainer script）在 <span class="strong"><strong>/etc</strong></span> 目录下创建并维护配置所需的文件。</li>
                </ul>
              </div>
              <p class="simpara">另请参考 <span class="strong"><strong>dh_installdeb</strong></span>(1)。</p>
            </dd>
            <dt>
              <span class="term">
                <span class="emphasis">
                  <em>binarypackage</em>
                </span>
                <span class="strong">
                  <strong>.config</strong>
                </span>
              </span>
            </dt>
            <dd>这是 <span class="strong"><strong>debconf</strong></span> <span class="strong"><strong>config</strong></span> 脚本，用来在配置软件包时向用户询问任何必需的问题。另请参见<a class="xref" href="ch05.zh-cn.html#debconf" title="5.19. debconf">第 5.19 节 “debconf”</a>。</dd>
            <dt>
              <span class="term"><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>.cron.hourly</strong></span> <sup><span class="strong"><strong>-x3</strong></span></sup></span>
            </dt>
            <dd>
              <p class="simpara">安装至 <span class="emphasis"><em>binarypackage</em></span> 包内的 <span class="strong"><strong>etc/cron/hourly/</strong></span><span class="emphasis"><em>binarypackage</em></span> 文件。</p>
              <p class="simpara">另请参见 <span class="strong"><strong>dh_installcron</strong></span>(1) 和 <span class="strong"><strong>cron</strong></span>(8)。</p>
            </dd>
            <dt>
              <span class="term"><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>.cron.daily</strong></span> <sup><span class="strong"><strong>-x3</strong></span></sup></span>
            </dt>
            <dd>
              <p class="simpara">安装至 <span class="emphasis"><em>binarypackage</em></span> 包内的 <span class="strong"><strong>etc/cron/daily/</strong></span><span class="emphasis"><em>binarypackage</em></span> 文件。</p>
              <p class="simpara">另请参见 <span class="strong"><strong>dh_installcron</strong></span>(1) 和 <span class="strong"><strong>cron</strong></span>(8)。</p>
            </dd>
            <dt>
              <span class="term"><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>.cron.weekly</strong></span> <sup><span class="strong"><strong>-x3</strong></span></sup></span>
            </dt>
            <dd>
              <p class="simpara">安装至 <span class="emphasis"><em>binarypackage</em></span> 包内的 <span class="strong"><strong>etc/cron/weekly/</strong></span><span class="emphasis"><em>binarypackage</em></span> 文件。</p>
              <p class="simpara">另请参见 <span class="strong"><strong>dh_installcron</strong></span>(1) 和 <span class="strong"><strong>cron</strong></span>(8)。</p>
            </dd>
            <dt>
              <span class="term"><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>.cron.monthly</strong></span> <sup><span class="strong"><strong>-x3</strong></span></sup></span>
            </dt>
            <dd>
              <p class="simpara">安装至 <span class="emphasis"><em>binarypackage</em></span> 包内的 <span class="strong"><strong>etc/cron/monthly/</strong></span><span class="emphasis"><em>binarypackage</em></span> 文件。</p>
              <p class="simpara">另请参见 <span class="strong"><strong>dh_installcron</strong></span>(1) 和 <span class="strong"><strong>cron</strong></span>(8)。</p>
            </dd>
            <dt>
              <span class="term"><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>.cron.d</strong></span> <sup><span class="strong"><strong>-x3</strong></span></sup></span>
            </dt>
            <dd>
              <p class="simpara">安装至 <span class="emphasis"><em>binarypackage</em></span> 包内的 <span class="strong"><strong>etc/cron.d/</strong></span><span class="emphasis"><em>binarypackage</em></span> 文件。</p>
              <p class="simpara">参见 <span class="strong"><strong>dh_installcron</strong></span>(1)、<span class="strong"><strong>cron</strong></span>(8) 和 <span class="strong"><strong>crontab</strong></span>(5)。</p>
            </dd>
            <dt>
              <span class="term"><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>.default</strong></span> <sup><span class="strong"><strong>-x3</strong></span></sup></span>
            </dt>
            <dd>
              <p class="simpara">若该文件存在，它将被安装至 <span class="emphasis"><em>binarypackage</em></span> 包中的 <span class="strong"><strong>etc/default/</strong></span><span class="emphasis"><em>binarypackage</em></span> 位置。</p>
              <p class="simpara">参见 <span class="strong"><strong>dh_installinit</strong></span>(1)。</p>
            </dd>
            <dt>
              <span class="term"><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>.dirs</strong></span> <sup><span class="strong"><strong>-x3</strong></span></sup></span>
            </dt>
            <dd>
              <p class="simpara">列出 <span class="emphasis"><em>binarypackage</em></span> 包中要创建的目录。</p>
              <p class="simpara">参见 <span class="strong"><strong>dh_installdirs</strong></span>(1)。</p>
              <p class="simpara">通常情况下您并不需要这么做，因为所有的 <span class="strong"><strong>dh_install</strong></span>* 命令都会自动创建所需的目录。请仅在遇到问题时考虑使用这一工具。</p>
            </dd>
            <dt>
              <span class="term"><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>.doc-base</strong></span> <sup><span class="strong"><strong>-x2</strong></span></sup></span>
            </dt>
            <dd>
              <p class="simpara">作为 <span class="emphasis"><em>binarypackage</em></span> 包中的 <span class="strong"><strong>doc-base</strong></span> 控制文件进行安装。</p>
              <p class="simpara">参见 <span class="strong"><strong>dh_installdocs</strong></span>(1) 和 <span class="strong"><strong>doc-base</strong></span> 软件包提供的 <a class="ulink" href="file:///usr/share/doc/doc-base/doc-base.html/index.html">Debian doc-base 手册</a>。</p>
            </dd>
            <dt>
              <span class="term"><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>.docs</strong></span> <sup><span class="strong"><strong>-x2</strong></span></sup></span>
            </dt>
            <dd>
              <p class="simpara">列出要安装在 <span class="emphasis"><em>binarypackage</em></span> 包中的文档文件。</p>
              <p class="simpara">参见 <span class="strong"><strong>dh_installdocs</strong></span>(1)。</p>
            </dd>
            <dt>
              <span class="term"><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>.emacsen-compat</strong></span> <sup><span class="strong"><strong>-x3</strong></span></sup></span>
            </dt>
            <dd>
              <p class="simpara">安装至 <span class="emphasis"><em>binarypackage</em></span> 包中的 <span class="strong"><strong>usr/lib/emacsen-common/packages/compat/</strong></span><span class="emphasis"><em>binarypackage</em></span> 文件。</p>
              <p class="simpara">参见 <span class="strong"><strong>dh_installemacsen</strong></span>(1)。</p>
            </dd>
            <dt>
              <span class="term"><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>.emacsen-install</strong></span> <sup><span class="strong"><strong>-x3</strong></span></sup></span>
            </dt>
            <dd>
              <p class="simpara">安装至 <span class="emphasis"><em>binarypackage</em></span> 包中的 <span class="strong"><strong>usr/lib/emacsen-common/packages/install/</strong></span><span class="emphasis"><em>binarypackage</em></span> 文件。</p>
              <p class="simpara">参见 <span class="strong"><strong>dh_installemacsen</strong></span>(1)。</p>
            </dd>
            <dt>
              <span class="term"><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>.emacsen-remove</strong></span> <sup><span class="strong"><strong>-x3</strong></span></sup></span>
            </dt>
            <dd>
              <p class="simpara">安装至 <span class="emphasis"><em>binarypackage</em></span> 包中的 <span class="strong"><strong>usr/lib/emacsen-common/packages/remove/</strong></span><span class="emphasis"><em>binarypackage</em></span> 文件。</p>
              <p class="simpara">参见 <span class="strong"><strong>dh_installemacsen</strong></span>(1)。</p>
            </dd>
            <dt>
              <span class="term"><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>.emacsen-startup</strong></span> <sup><span class="strong"><strong>-x3</strong></span></sup></span>
            </dt>
            <dd>
              <p class="simpara">安装至 <span class="emphasis"><em>binarypackage</em></span> 包中的 <span class="strong"><strong>usr/lib/emacsen-common/packages/startup/</strong></span><span class="emphasis"><em>binarypackage</em></span> 文件。</p>
              <p class="simpara">参见 <span class="strong"><strong>dh_installemacsen</strong></span>(1)。</p>
            </dd>
            <dt>
              <span class="term"><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>.examples</strong></span> <sup><span class="strong"><strong>-x2</strong></span></sup></span>
            </dt>
            <dd>
              <p class="simpara">列出要安装至 <span class="emphasis"><em>binarypackage</em></span> 包中 <span class="strong"><strong>usr/share/doc/</strong></span><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>/examples/</strong></span> 位置下的示例文件或目录。</p>
              <p class="simpara">参见 <span class="strong"><strong>dh_installexamples</strong></span>(1)。</p>
            </dd>
            <dt>
              <span class="term">
                <span class="strong">
                  <strong>gbp.conf</strong>
                </span>
              </span>
            </dt>
            <dd>
              <p class="simpara">如果该文件存在，它将作为 <span class="strong"><strong>gbp</strong></span> 命令的配置文件发挥作用。</p>
              <p class="simpara">参见 <span class="strong"><strong>gbp.conf</strong></span>(5)、<span class="strong"><strong>gbp</strong></span>(1) 和 <span class="strong"><strong>git-buildpackage</strong></span>(1)。</p>
            </dd>
            <dt>
              <span class="term"><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>.info</strong></span> <sup><span class="strong"><strong>-x2</strong></span></sup></span>
            </dt>
            <dd>
              <p class="simpara">列出要安装至 <span class="emphasis"><em>binarypackage</em></span> 包中的 info 文件。</p>
              <p class="simpara">参见 <span class="strong"><strong>dh_installinfo</strong></span>(1)。</p>
            </dd>
            <dt>
              <span class="term"><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>.init</strong></span> <sup><span class="strong"><strong>-x3</strong></span></sup></span>
            </dt>
            <dd>
              <p class="simpara">安装至 <span class="emphasis"><em>binarypackage</em></span> 包中的 <span class="strong"><strong>etc/init.d/</strong></span><span class="emphasis"><em>binarypackage</em></span> 文件。</p>
              <p class="simpara">参见 <span class="strong"><strong>dh_installinit</strong></span>(1)。</p>
            </dd>
            <dt>
              <span class="term"><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>.install</strong></span> <sup><span class="strong"><strong>-x2</strong></span></sup></span>
            </dt>
            <dd>
              <p class="simpara">列出未被 <span class="strong"><strong>dh_auto_install</strong></span> 命令安装的其它应当安装的文件。</p>
              <p class="simpara">参见 <span class="strong"><strong>dh_install</strong></span>(1) 和 <span class="strong"><strong>dh_auto_install</strong></span>(1)。</p>
            </dd>
            <dt>
              <span class="term"><span class="strong"><strong>license-examples/</strong></span>* <sup><span class="strong"><strong>-x4</strong></span></sup></span>
            </dt>
            <dd>
              <p class="simpara">这是 <span class="strong"><strong>debmake</strong></span> 命令生成的版权声明文件示例，请用它们作为 <span class="strong"><strong>debian/copyright</strong></span> 文件的参考。</p>
              <p class="simpara">请在最终工作成果中删除这些文件。</p>
            </dd>
            <dt>
              <span class="term"><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>.links</strong></span> <sup><span class="strong"><strong>-x2</strong></span></sup></span>
            </dt>
            <dd>
              <p class="simpara">列出要生成符号链接的源文件和目标文件对。每一对链接均应在单独的一行中列出，源文件和目标文件之间使用空白字符分隔。</p>
              <p class="simpara">参见 <span class="strong"><strong>dh_link</strong></span>(1)。</p>
            </dd>
            <dt>
              <span class="term"><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>.lintian-overrides</strong></span> <sup><span class="strong"><strong>-x3</strong></span></sup></span>
            </dt>
            <dd>
              <p class="simpara">安装至软件包构建目录的 <span class="strong"><strong>usr/share/lintian/overrides/</strong></span><span class="emphasis"><em>binarypackage</em></span> 位置。该文件用于消除 <span class="strong"><strong>lintian</strong></span> 错误生成的诊断信息。</p>
              <p class="simpara">参见 <span class="strong"><strong>dh_lintian</strong></span>(1)、<span class="strong"><strong>lintian</strong></span>(1) 和 <a class="ulink" href="https://lintian.debian.org/manual/index.html">Lintian 用户手册</a>。</p>
            </dd>
            <dt>
              <span class="term"><span class="strong"><strong>manpage.</strong></span>* <sup><span class="strong"><strong>-x3</strong></span></sup></span>
            </dt>
            <dd>
              <p class="simpara">这些文件是 <span class="strong"><strong>debmake</strong></span> 命令生成的 man 手册页模板文件。请将其重命名为合适的文件名并更新其内容。</p>
              <p class="simpara">Debian 的政策要求软件包为其包含的每个程序、工具和函数同时提供一份相关的手册页。手册页使用 <span class="strong"><strong>nroff</strong></span>(1) 语法写成。</p>
              <p class="simpara">如果您不熟悉如何编写用户手册页，请以 <span class="strong"><strong>manpage.asciidoc</strong></span> 或 <span class="strong"><strong>manpage.1</strong></span> 为起点。</p>
            </dd>
            <dt>
              <span class="term"><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>.manpages</strong></span> <sup><span class="strong"><strong>-x2</strong></span></sup></span>
            </dt>
            <dd>
              <p class="simpara">列出要安装的 man 手册页。</p>
              <p class="simpara">参见 <span class="strong"><strong>dh_installman</strong></span>(1)。</p>
            </dd>
            <dt>
              <span class="term"><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>.menu</strong></span> （已过时，不再安装）</span>
            </dt>
            <dd>
              <p class="simpara"><a class="ulink" href="https://bugs.debian.org/741573">tech-ctte #741573</a> 决定“Debian 应该在合适的情况下使用 <span class="strong"><strong>.desktop</strong></span> 文件”。</p>
              <p class="simpara">安装至 <span class="emphasis"><em>binarypackage</em></span> 包中的 <span class="strong"><strong>usr/share/menu/</strong></span><span class="emphasis"><em>binarypackage</em></span> Debian 菜单文件。</p>
              <p class="simpara">参见 <span class="strong"><strong>menufile</strong></span>(5) 以了解其格式。另请参见 <span class="strong"><strong>dh_installmenu</strong></span>(1)。</p>
            </dd>
            <dt>
              <span class="term">
                <span class="strong">
                  <strong>NEWS</strong>
                </span>
              </span>
            </dt>
            <dd>
              <p class="simpara">安装至 <span class="strong"><strong>usr/share/doc/</strong></span><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>/NEWS.Debian</strong></span> 文件。</p>
              <p class="simpara">参见 <span class="strong"><strong>dh_installchangelogs</strong></span>(1)。</p>
            </dd>
            <dt>
              <span class="term"><span class="strong"><strong>patches/</strong></span>*</span>
            </dt>
            <dd>
              <p class="simpara">这是 <span class="strong"><strong>-p1</strong></span> 补丁文件的集合，它们将在使用源代码构建之前应用在上游源码上。</p>
              <p class="simpara">参见 <span class="strong"><strong>dpkg-source</strong></span>(1)、<a class="xref" href="ch03.zh-cn.html#quilt-setup" title="3.4. quilt">第 3.4 节 “quilt”</a> 和 <a class="xref" href="ch04.zh-cn.html#alt-patch" title="4.8. 第三步（备选）：修改上游源代码">第 4.8 节 “第三步（备选）：修改上游源代码”</a>。</p>
              <p class="simpara"><span class="strong"><strong>debmake</strong></span> 默认不会生成补丁文件。</p>
            </dd>
            <dt>
              <span class="term"><span class="strong"><strong>patches/series</strong></span> <sup><span class="strong"><strong>-x1</strong></span></sup></span>
            </dt>
            <dd><span class="strong"><strong>patches/</strong></span>* 补丁文件的应用顺序。</dd>
            <dt>
              <span class="term"><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>.preinst</strong></span> <sup><span class="strong"><strong>-x2</strong></span></sup>, </span>
              <span class="term"><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>.postinst</strong></span> <sup><span class="strong"><strong>-x2</strong></span></sup>, </span>
              <span class="term"><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>.prerm</strong></span> <sup><span class="strong"><strong>-x2</strong></span></sup>, </span>
              <span class="term"><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>.postrm</strong></span> <sup><span class="strong"><strong>-x2</strong></span></sup></span>
            </dt>
            <dd>
              <p class="simpara">这些维护者脚本将安装至软件包的 <span class="strong"><strong>DEBIAN</strong></span> 目录下。</p>
              <p class="simpara">在这些脚本中，<span class="strong"><strong>#DEBHELPER#</strong></span> 记号将由其它 <span class="strong"><strong>debhelper</strong></span> 命令进行处理，将其替换为相应的 shell 脚本片段。</p>
              <p class="simpara">参考《Debian 政策手册》的 <span class="strong"><strong>dh_installdeb</strong></span>(1) 和 <a class="ulink" href="https://www.debian.org/doc/debian-policy/#document-ch-maintainerscripts">第六章 - 软件包维护脚本和安装过程</a> 一节。</p>
              <p class="simpara">参考《Debian 政策手册》的 <span class="strong"><strong>debconf-devel</strong></span>(7) 和 <a class="ulink" href="https://www.debian.org/doc/debian-policy/#prompting-in-maintainer-scripts">3.9.1 维护者脚本中的用户交互提示</a> 一节。</p>
            </dd>
            <dt>
              <span class="term"><span class="strong"><strong>README.Debian</strong></span> <sup><span class="strong"><strong>-x1</strong></span></sup></span>
            </dt>
            <dd>
              <p class="simpara">安装至 <span class="strong"><strong>debian/control</strong></span> 文件列出的第一个二进制软件包中的 <span class="strong"><strong>usr/share/doc/</strong></span><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>/README.Debian</strong></span> 位置。</p>
              <p class="simpara">参见 <span class="strong"><strong>dh_installdocs</strong></span>(1)。</p>
              <p class="simpara">该文件提供了针对该 Debian 软件包的信息。</p>
            </dd>
            <dt>
              <span class="term"><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>.service</strong></span> <sup><span class="strong"><strong>-x3</strong></span></sup></span>
            </dt>
            <dd>
              <p class="simpara">如果该文件存在，它将被安装到 <span class="emphasis"><em>binarypackage</em></span> 包下面的 <span class="strong"><strong>lib/systemd/system/</strong></span><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>.service</strong></span> 位置。</p>
              <p class="simpara">参见 <span class="strong"><strong>dh_systemd_enable</strong></span>(1)、<span class="strong"><strong>dh_systemd_start</strong></span>(1) 和 <span class="strong"><strong>dh_installinit</strong></span>(1)。</p>
            </dd>
            <dt>
              <span class="term"><span class="strong"><strong>source/format</strong></span> <sup><span class="strong"><strong>-x1</strong></span></sup></span>
            </dt>
            <dd>
              <p class="simpara">Debian 软件包格式。</p>
              <div class="itemizedlist">
                <ul class="itemizedlist">
                  <li class="listitem">使用“<span class="strong"><strong>3.0 (quilt)</strong></span>”以制作这个非本土软件包（推荐）</li>
                  <li class="listitem">使用“<span class="strong"><strong>3.0 (native)</strong></span>”以制作这个本土软件包</li>
                </ul>
              </div>
              <p class="simpara">参见 <span class="strong"><strong>dpkg-source</strong></span>(1) 的“源码包格式”一节。</p>
            </dd>
            <dt>
              <span class="term"><span class="strong"><strong>source/lintian-overrides</strong></span> 或 <span class="strong"><strong>source.lintian-overrides</strong></span> <sup><span class="strong"><strong>-x3</strong></span></sup></span>
            </dt>
            <dd>
              <p class="simpara">这些文件不会最终被安装，但 <span class="strong"><strong>lintian</strong></span> 会对它们进行扫描以提供源码包的 override 信息。</p>
              <p class="simpara">另请参考 <span class="strong"><strong>dh_lintian</strong></span>(1) 和 <span class="strong"><strong>lintian</strong></span>(1)。</p>
            </dd>
            <dt>
              <span class="term"><span class="strong"><strong>source/local-options</strong></span> <sup><span class="strong"><strong>-x1</strong></span></sup></span>
            </dt>
            <dd>
              <p class="simpara"><span class="strong"><strong>dpkg-source</strong></span> 命令使用此内容作为它的选项，比较重要的选项有：</p>
              <div class="itemizedlist">
                <ul class="itemizedlist">
                  <li class="listitem">
                    <span class="strong">
                      <strong>unapply-patches</strong>
                    </span>
                  </li>
                  <li class="listitem">
                    <span class="strong">
                      <strong>abort-on-upstream-changes</strong>
                    </span>
                  </li>
                  <li class="listitem">
                    <span class="strong">
                      <strong>auto-commit</strong>
                    </span>
                  </li>
                  <li class="listitem">
                    <span class="strong">
                      <strong>single-debian-patch</strong>
                    </span>
                  </li>
                </ul>
              </div>
              <p class="simpara">该文件不会包含在生成的源码包中，仅对维护者在版本控制系统中维护软件包有意义。</p>
              <p class="simpara">参见 <span class="strong"><strong>dpkg-source</strong></span>(1) 中的“文件格式”一节。</p>
            </dd>
            <dt>
              <span class="term">
                <span class="strong">
                  <strong>source/local-patch-header</strong>
                </span>
              </span>
            </dt>
            <dd>
              <p class="simpara">自由格式的文本，将被包含在自动生成补丁的顶部。</p>
              <p class="simpara">该文件不会包含在生成的源码包中，仅对维护者在版本控制系统中维护软件包有意义。</p>
              <p class="simpara">+ 参见 <span class="strong"><strong>dpkg-source</strong></span>(1) 的“文件格式”一节。</p>
            </dd>
            <dt>
              <span class="term"><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>.symbols</strong></span> <sup><span class="strong"><strong>-x2</strong></span></sup></span>
            </dt>
            <dd>
              <p class="simpara">这些符号文件如果存在，将交由 <span class="strong"><strong>dpkg-gensymbols</strong></span> 命令进行处理和安装。</p>
              <p class="simpara">参见 <span class="strong"><strong>dh_makeshlibs</strong></span>(1) 和 <a class="xref" href="ch05.zh-cn.html#symbols" title="5.18.1. 库符号">第 5.18.1 节 “库符号”</a>。</p>
            </dd>
            <dt>
              <span class="term">
                <span class="emphasis">
                  <em>binarypackage</em>
                </span>
                <span class="strong">
                  <strong>.templates</strong>
                </span>
              </span>
            </dt>
            <dd>这是 <span class="strong"><strong>debconf</strong></span> <span class="strong"><strong>模板</strong></span>文件，用于在安装过程中向用户询问必需的问题以正确配置软件包。请参阅 <a class="xref" href="ch05.zh-cn.html#debconf" title="5.19. debconf">第 5.19 节 “debconf”</a>。</dd>
            <dt>
              <span class="term">
                <span class="strong">
                  <strong>tests/control</strong>
                </span>
              </span>
            </dt>
            <dd>这是一个 RFC822 格式的测试元数据文件，定义在 <a class="ulink" href="http://dep.debian.net/deps/dep8/">DEP-8</a>。参见 <span class="strong"><strong>autopkgtest</strong></span>(1) 和<a class="xref" href="ch05.zh-cn.html#ci" title="5.22. 持续集成">第 5.22 节 “持续集成”</a>。</dd>
            <dt>
              <span class="term">
                <span class="strong">
                  <strong>TODO</strong>
                </span>
              </span>
            </dt>
            <dd>
              <p class="simpara">安装至 <span class="strong"><strong>debian/control</strong></span> 文件列出的第一个二进制包中的 <span class="strong"><strong>usr/share/doc/</strong></span><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>/TODO.Debian</strong></span> 文件。</p>
              <p class="simpara">参见 <span class="strong"><strong>dh_installdocs</strong></span>(1)。</p>
            </dd>
            <dt>
              <span class="term"><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>.tmpfile</strong></span> <sup><span class="strong"><strong>-x3</strong></span></sup></span>
            </dt>
            <dd>
              <p class="simpara">如果该文件存在，它将被安装至 <span class="emphasis"><em>binarypackage</em></span> 包中的 <span class="strong"><strong>usr/lib/tmpfiles.d/</strong></span><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>.conf</strong></span> 文件。</p>
              <p class="simpara">参见 <span class="strong"><strong>dh_systemd_enable</strong></span>(1)、<span class="strong"><strong>dh_systemd_start</strong></span>(1) 和 <span class="strong"><strong>dh_installinit</strong></span>(1)。</p>
            </dd>
            <dt>
              <span class="term"><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>.upstart</strong></span> <sup><span class="strong"><strong>-x3</strong></span></sup></span>
            </dt>
            <dd>
              <p class="simpara">如果该文件存在，它将被安装至软件包构建目录的 etc/init/package.conf 位置。（已弃用）</p>
              <p class="simpara">参见 <span class="strong"><strong>dh_installinit</strong></span>(1) 和 <a class="xref" href="ch08.zh-cn.html#emptypkg" title="8.1. 挑选最好的模板">第 8.1 节 “挑选最好的模板”</a>。</p>
            </dd>
            <dt>
              <span class="term"><span class="strong"><strong>watch</strong></span> <sup><span class="strong"><strong>-x1</strong></span></sup></span>
            </dt>
            <dd>
              <p class="simpara">用于下载最新上游版本的 <span class="strong"><strong>uscan</strong></span> 命令的控制文件。</p>
              <p class="simpara">该控制文件也可配置以使用其 GPG 签名自动验证上游 tarball 的真实性（参见 <a class="xref" href="ch05.zh-cn.html#signing-key" title="5.9. debian/upstream/signing-key.asc">第 5.9 节 “debian/upstream/signing-key.asc”</a>）。</p>
              <p class="simpara">参见 <a class="xref" href="ch05.zh-cn.html#dfsg" title="5.10. debian/watch 和 DFSG">第 5.10 节 “debian/watch 和 DFSG”</a> 和 <span class="strong"><strong>uscan</strong></span>(1)。</p>
            </dd>
          </dl>
        </div>
        <p>这里给出针对上面列表中信息的一些额外提醒。</p>
        <div class="itemizedlist">
          <ul class="itemizedlist">
            <li class="listitem">对只生成一个二进制包的情况，列表文件名中的 <span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>.</strong></span> 这一部分可以不出现。</li>
            <li class="listitem">对有多个二进制包的源码包，一个缺少文件名里 <span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>.</strong></span> 部分的配置文件，会被应用于 <span class="strong"><strong>debian/control</strong></span> 里列出的第一个二进制包。</li>
            <li class="listitem">在生成多个二进制包的情况下，各个二进制包可以分别指定配置文件；只需在其对应配置文件的文件名之前加上它们各自对应的包名即可，如 <span class="emphasis"><em>package-1</em></span><span class="strong"><strong>.install</strong></span>、<span class="emphasis"><em>package-2</em></span><span class="strong"><strong>.install</strong></span> 等等。</li>
            <li class="listitem"><span class="strong"><strong>debmake</strong></span> 可能没有自动生成某些模板配置文件。如遇到这种情况，您可以使用文本编辑器手动创建缺失的文件。</li>
            <li class="listitem"><span class="strong"><strong>debmake</strong></span> 命令生成的带额外 <span class="strong"><strong>.ex</strong></span> 后缀名的配置文件必须在移除这个多余后缀名后才能发挥作用。</li>
            <li class="listitem">您应当删除 <span class="strong"><strong>.ex</strong></span> 命令生成但对您无用的配置模板文件。</li>
            <li class="listitem">请按需复制配置模板文件以匹配其对应的二进制包名称以及您的需求。</li>
          </ul>
        </div>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="custom"/>5.12. Debian 打包的定制化</h2>
            </div>
          </div>
        </div>
        <p>我们来重新归纳一下 Debian 打包定制化的相关内容。</p>
        <p>所有对 Debian 软件包进行定制化的数据都存在于 <span class="strong"><strong>debian/</strong></span> 目录中。我们在<a class="xref" href="ch04.zh-cn.html#step-maintainer" title="4.6. 第三步：编辑模板文件">第 4.6 节 “第三步：编辑模板文件”</a>这里给出了一个简单的例子。通常情况下，定制化会涉及以下各个项目：</p>
        <div class="itemizedlist">
          <ul class="itemizedlist">
            <li class="listitem">Debian 软件包构建系统可以经由 <span class="strong"><strong>debian/rules</strong></span> 文件进行定制（参见<a class="xref" href="ch05.zh-cn.html#customrules" title="5.4.3. 自定义 debian/rules">第 5.4.3 节 “自定义 debian/rules”</a>）。</li>
            <li class="listitem">可以使用额外的配置文件（如 <span class="strong"><strong>debian/</strong></span> directory 目录下的 <span class="emphasis"><em>package</em></span><span class="strong"><strong>.install</strong></span> 和 <span class="emphasis"><em>package</em></span><span class="strong"><strong>.docs</strong></span> 文件）以配合来自 <span class="strong"><strong>debhelper</strong></span> 软件包的 <span class="strong"><strong>dh_</strong></span>* 命令自定义 Debian 软件包文件的安装路径等信息（请参见 <a class="xref" href="ch05.zh-cn.html#debianconf" title="5.11. 其它 debian/* 文件">第 5.11 节 “其它 debian/* 文件”</a>）。</li>
          </ul>
        </div>
        <p>如果以上提到的手段仍然不足以制作满足要求的 Debian 软件包的话，对上游源代码的修改应当使用 <span class="strong"><strong>-p1</strong></span> 补丁文件存放在打包源码树 <span class="strong"><strong>debian/patches/</strong></span> 目录下。这些补丁将按照 <span class="strong"><strong>debian/patches/series</strong></span> 文件所规定的顺序在构建软件包之前应用（参见 <a class="xref" href="ch05.zh-cn.html#patches" title="5.8. debian/patches/*">第 5.8 节 “debian/patches/*”</a>）。<a class="xref" href="ch04.zh-cn.html#alt-patch" title="4.8. 第三步（备选）：修改上游源代码">第 4.8 节 “第三步（备选）：修改上游源代码”</a> 这里给出了一些简单的例子。</p>
        <p>您应当以引入最少修改的方式解决打包中出现的根本问题。所生成的软件包应当考虑到未来的更新需求并有一定的健壮性。</p>
        <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
          <table border="0" summary="Note">
            <tr>
              <td rowspan="2" align="center" valign="top">
                <img alt="[注意]" src="images/note.png"/>
              </td>
              <th align="left">注意</th>
            </tr>
            <tr>
              <td align="left" valign="top">
                <p>如果补丁对上游有所帮助的话，也请将解决根本问题的补丁反馈给上游作者和维护者。</p>
              </td>
            </tr>
          </table>
        </div>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="vcs"/>5.13. 在版本控制系统中进行记录（标准）</h2>
            </div>
          </div>
        </div>
        <p>通常情况下，Debian 打包活动使用 <a class="ulink" href="https://en.wikipedia.org/wiki/Git">Git</a> 作为<a class="ulink" href="https://en.wikipedia.org/wiki/Version_control">版本控制系统（VCS）</a>进行记录；通常会用到下列的分支。</p>
        <div class="itemizedlist">
          <ul class="itemizedlist">
            <li class="listitem">
              <p class="simpara"><span class="strong"><strong>master</strong></span> 分支</p>
              <div class="itemizedlist">
                <ul class="itemizedlist">
                  <li class="listitem">记录用于 Debian 打包的源代码树。</li>
                  <li class="listitem">源码树的上游部分将照原样记录，不做修改。</li>
                  <li class="listitem">Debian 打包中需要对上游源代码所作的修改记录在 <span class="strong"><strong>debian/patches/</strong></span> 目录中，以 <span class="strong"><strong>-p1</strong></span> 等级的补丁形式存在。</li>
                </ul>
              </div>
            </li>
            <li class="listitem">
              <p class="simpara"><span class="strong"><strong>upstream</strong></span> 分支</p>
              <div class="itemizedlist">
                <ul class="itemizedlist">
                  <li class="listitem">记录从上游发布的 tarball（源码压缩文件）解压缩所得到的源代码树。</li>
                </ul>
              </div>
            </li>
          </ul>
        </div>
        <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">
          <table border="0" summary="Tip">
            <tr>
              <td rowspan="2" align="center" valign="top">
                <img alt="[提示]" src="images/tip.png"/>
              </td>
              <th align="left">提示</th>
            </tr>
            <tr>
              <td align="left" valign="top">
                <p>添加一个 <span class="strong"><strong>.gitignore</strong></span> 文件并将 <span class="strong"><strong>.pc</strong></span> 文件列入其中也是一个好主意。</p>
              </td>
            </tr>
          </table>
        </div>
        <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">
          <table border="0" summary="Tip">
            <tr>
              <td rowspan="2" align="center" valign="top">
                <img alt="[提示]" src="images/tip.png"/>
              </td>
              <th align="left">提示</th>
            </tr>
            <tr>
              <td align="left" valign="top">
                <p>可以在 <span class="strong"><strong>debian/source/local-options</strong></span> 文件中添加 <span class="strong"><strong>unapply-patches</strong></span> 和 <span class="strong"><strong>abort-on-upstream-changes</strong></span> 这两行以保持上游源码处于未修改状态。</p>
              </td>
            </tr>
          </table>
        </div>
        <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">
          <table border="0" summary="Tip">
            <tr>
              <td rowspan="2" align="center" valign="top">
                <img alt="[提示]" src="images/tip.png"/>
              </td>
              <th align="left">提示</th>
            </tr>
            <tr>
              <td align="left" valign="top">
                <p>您也可以使用除 <span class="strong"><strong>upstream</strong></span> 分支以外其它名称的分支跟踪上游版本控制数据以方便拣选补丁。</p>
              </td>
            </tr>
          </table>
        </div>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="alt-vcs"/>5.14. 在版本控制系统中进行记录（备选方案）</h2>
            </div>
          </div>
        </div>
        <p>您也可以选择不创建 <span class="strong"><strong>-p1</strong></span> 等级的补丁。这时，您可以使用下列分支来记录 Debian 打包活动。</p>
        <div class="itemizedlist">
          <ul class="itemizedlist">
            <li class="listitem">
              <p class="simpara"><span class="strong"><strong>master</strong></span> 分支</p>
              <div class="itemizedlist">
                <ul class="itemizedlist">
                  <li class="listitem">记录用于 Debian 打包的源代码树。</li>
                  <li class="listitem">源码树的上游部分在应用了为 Debian 打包所作的修改之后进行记录。</li>
                </ul>
              </div>
            </li>
            <li class="listitem">
              <p class="simpara"><span class="strong"><strong>upstream</strong></span> 分支</p>
              <div class="itemizedlist">
                <ul class="itemizedlist">
                  <li class="listitem">记录从上游发布的 tarball（源码压缩文件）解压缩所得到的源代码树。</li>
                </ul>
              </div>
            </li>
          </ul>
        </div>
        <p>如下在 <span class="strong"><strong>debian/</strong></span> 目录下额外添加一些文件即可达到目的。</p>
        <pre class="screen"> $ tar -xvzf &lt;package-version&gt;.tar.gz
 $ ln -sf &lt;package_version&gt;.orig.tar.gz
 $ cd &lt;package-version&gt;/
 ... hack...hack...
 $ echo "single-debian-patch" &gt;&gt; debian/source/local-options
 $ cat &gt;debian/source/local-patch-header &lt;&lt;END
 This patch contains all the Debian-specific changes mixed
 together. To review them separately, please inspect the VCS
 history at https://git.debian.org/?=collab-maint/foo.git.</pre>
        <p>如此可让 Debian 打包过程（<span class="strong"><strong>dpkg-buildpackage</strong></span>、<span class="strong"><strong>debuild</strong></span> 等）所调用的 <span class="strong"><strong>dpkg-source</strong></span> 命令自动生成一个 <span class="strong"><strong>-p1</strong></span> 等级的补丁文件 <span class="strong"><strong>debian/patches/debian-changes</strong></span>。</p>
        <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">
          <table border="0" summary="Tip">
            <tr>
              <td rowspan="2" align="center" valign="top">
                <img alt="[提示]" src="images/tip.png"/>
              </td>
              <th align="left">提示</th>
            </tr>
            <tr>
              <td align="left" valign="top">
                <p>这种做法可以应用在任何版本控制工具中。这么做会把所有修改合并到同一个补丁文件中而丢失其开发历史，因此请务必保持版本控制系统的数据公开可见。</p>
              </td>
            </tr>
          </table>
        </div>
        <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">
          <table border="0" summary="Tip">
            <tr>
              <td rowspan="2" align="center" valign="top">
                <img alt="[提示]" src="images/tip.png"/>
              </td>
              <th align="left">提示</th>
            </tr>
            <tr>
              <td align="left" valign="top">
                <p><span class="strong"><strong>debian/source/local-options</strong></span> 和 <span class="strong"><strong>debian/source/local-patch-header</strong></span> 文件只用于在版本控制系统中记录信息。它们不应包含在 Debian 源码包中。</p>
              </td>
            </tr>
          </table>
        </div>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="build-noextra"/>5.15. 构建软件包时排除不必要的内容</h2>
            </div>
          </div>
        </div>
        <p>在某些情况下，直接使用自动生成的 Debian 源码包会引入不必要的一些内容。</p>
        <div class="itemizedlist">
          <ul class="itemizedlist">
            <li class="listitem">上游源码树可能由某个版本控制系统进行管理。直接从这个源码树进行构建时，所生成的 Debian 源码包会包含来自版本控制系统的多余文件。</li>
            <li class="listitem">上游源码树可能包含了一些自动生成的文件。当从这个源码树重新构建软件包时，所生成的 Debian 源码包会包含这些自动生成的不必要的文件。</li>
          </ul>
        </div>
        <p>通常情况下，<a class="xref" href="ch03.zh-cn.html#devscripts-setup" title="3.5. devscripts">第 3.5 节 “devscripts”</a> 中设置的用于 <span class="strong"><strong>dpkg-source</strong></span> 命令的 <span class="strong"><strong>-i</strong></span> 和 <span class="strong"><strong>-I</strong></span> 选项可以避免这些问题。这里 <span class="strong"><strong>-i</strong></span> 针对非本土软件包而 <span class="strong"><strong>-I</strong></span> 则针对本土软件包。请参见 <span class="strong"><strong>dpkg-source</strong></span>(1) 和“<span class="strong"><strong>dpkg-source --help</strong></span>”的输出。</p>
        <p>以下几种方法均可避免引入不必要的内容。</p>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h3 class="title"><a id="rules-clean"/>5.15.1. 使用 debian/rules clean 进行修复</h3>
              </div>
            </div>
          </div>
          <p>含有多余文件的问题可以使用“<span class="strong"><strong>debian/rules clean</strong></span>”这个 Makefile 目标的调用来解决，只需在该目标内删除文件即可。它也能处理自动生成的文件。</p>
          <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
            <table border="0" summary="Note">
              <tr>
                <td rowspan="2" align="center" valign="top">
                  <img alt="[注意]" src="images/note.png"/>
                </td>
                <th align="left">注意</th>
              </tr>
              <tr>
                <td align="left" valign="top">
                  <p>运行 <span class="strong"><strong>dpkg-buildpackage</strong></span> 命令时，它会在“<span class="strong"><strong>dpkg-source --build</strong></span>”命令之前被调用“<span class="strong"><strong>debian/rules clean</strong></span>”目标，而“<span class="strong"><strong>dpkg-source --build</strong></span>”命令会忽略被删除的文件。</p>
                </td>
              </tr>
            </table>
          </div>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h3 class="title"><a id="git-clean"/>5.15.2. 使用版本控制系统修复</h3>
              </div>
            </div>
          </div>
          <p>含有多余文件的问题还可以使用版本控制系统修复；具体来说，可以在首次构建之前将源码树提交到版本控制系统中。</p>
          <p>您可以在第二次构建软件包之前恢复最初的源码树。例如：</p>
          <pre class="screen"> $ git reset --hard
 $ git clean -dfx
 $ debuild</pre>
          <p>这里工作的原理是 <span class="strong"><strong>dpkg-source</strong></span> 命令会忽略源码树中典型的版本控制系统相关的文件，相关的设置可以在 <a class="xref" href="ch03.zh-cn.html#devscripts-setup" title="3.5. devscripts">第 3.5 节 “devscripts”</a> 的 <span class="strong"><strong>DEBUILD_DPKG_BUILDPACKAGE_OPTS</strong></span> 设置中找到。</p>
          <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">
            <table border="0" summary="Tip">
              <tr>
                <td rowspan="2" align="center" valign="top">
                  <img alt="[提示]" src="images/tip.png"/>
                </td>
                <th align="left">提示</th>
              </tr>
              <tr>
                <td align="left" valign="top">
                  <p>如果源码树未受版本控制系统管理，您可以在第一次构建之前运行“<span class="strong"><strong>git init; git add -A .; git commit</strong></span>”来初始化。</p>
                </td>
              </tr>
            </table>
          </div>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h3 class="title"><a id="extend-diff-ignore"/>5.15.3. 使用 extend-diff-ignore 修复</h3>
              </div>
            </div>
          </div>
          <p>这种做法仅适合非本土软件包。</p>
          <p>含有多余文件的问题可以使用在 <span class="strong"><strong>debian/source/options</strong></span> 文件中添加忽略信息的方式解决，令编译系统忽略多余的文件；具体配置语法为添加 <span class="strong"><strong>extend-diff-ignore=…</strong></span>”一行内容。</p>
          <p>如需排除 <span class="strong"><strong>config.sub</strong></span>、<span class="strong"><strong>config.guess</strong></span> 和 <span class="strong"><strong>Makefile</strong></span> 文件：</p>
          <pre class="screen"># Don't store changes on autogenerated files
extend-diff-ignore = "(^|/)(config\.sub|config\.guess|Makefile)$"</pre>
          <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
            <table border="0" summary="Note">
              <tr>
                <td rowspan="2" align="center" valign="top">
                  <img alt="[注意]" src="images/note.png"/>
                </td>
                <th align="left">注意</th>
              </tr>
              <tr>
                <td align="left" valign="top">
                  <p>即使您无法删除文件，这种做法总可以正常工作。您无需在每次构建之前手动删除文件并手动进行恢复。</p>
                </td>
              </tr>
            </table>
          </div>
          <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">
            <table border="0" summary="Tip">
              <tr>
                <td rowspan="2" align="center" valign="top">
                  <img alt="[提示]" src="images/tip.png"/>
                </td>
                <th align="left">提示</th>
              </tr>
              <tr>
                <td align="left" valign="top">
                  <p>如果您转而使用 <span class="strong"><strong>debian/source/local-options</strong></span> 文件，您可以在生成的源码包中隐藏该项设置。这种做法在本地非标准版本控制系统和您的打包工作有冲突时可能有用。</p>
                </td>
              </tr>
            </table>
          </div>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h3 class="title"><a id="tar-ignore"/>5.15.4. 使用 tar-ignore 修复</h3>
              </div>
            </div>
          </div>
          <p>这个方法只适用于本土软件包。</p>
          <p>您可以使用这种做法在生成的源码包中排除某些文件；只需在 <span class="strong"><strong>debian/source/options</strong></span> 文件或者 <span class="strong"><strong>debian/source/local-options</strong></span> 文件中添加含有通配符的 “<span class="strong"><strong>tar-ignore=…</strong></span>”一行内容即可。</p>
          <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
            <table border="0" summary="Note">
              <tr>
                <td rowspan="2" align="center" valign="top">
                  <img alt="[注意]" src="images/note.png"/>
                </td>
                <th align="left">注意</th>
              </tr>
              <tr>
                <td align="left" valign="top">
                  <p>例如，如果您的本土软件包的源码包使用了一些具有 <span class="strong"><strong>.o</strong></span> 扩展名的文件作为测试数据的话，<a class="xref" href="ch03.zh-cn.html#devscripts-setup" title="3.5. devscripts">第 3.5 节 “devscripts”</a> 的默认设置就过于激进了，这些文件会被当作多余的文件默认自动排除。如需解决这个问题，您可以在 <a class="xref" href="ch03.zh-cn.html#devscripts-setup" title="3.5. devscripts">第 3.5 节 “devscripts”</a> 中的 <span class="strong"><strong>DEBUILD_DPKG_BUILDPACKAGE_OPTS</strong></span> 参数中移除 <span class="strong"><strong>-I</strong></span> 选项，同时在每个软件包的 <span class="strong"><strong>debian/source/local-options</strong></span> 文件中添加 “<span class="strong"><strong>tar-ignore=…</strong></span>”的配置行。</p>
                </td>
              </tr>
            </table>
          </div>
        </div>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="build"/>5.16. 上游构建系统</h2>
            </div>
          </div>
        </div>
        <p>上游的构建系统设计为经过数个步骤以从源码发行文件得到并在系统中安装所生成的二进制文件。</p>
        <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">
          <table border="0" summary="Tip">
            <tr>
              <td rowspan="2" align="center" valign="top">
                <img alt="[提示]" src="images/tip.png"/>
              </td>
              <th align="left">提示</th>
            </tr>
            <tr>
              <td align="left" valign="top">
                <p>在尝试制作 Debian 软件包之前，您应当熟悉了解上游源代码所使用的构建系统并尝试构建软件。</p>
              </td>
            </tr>
          </table>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h3 class="title"><a id="autotools"/>5.16.1. Autotools</h3>
              </div>
            </div>
          </div>
          <p>使用 Autotools（<span class="strong"><strong>autoconf</strong></span> + <span class="strong"><strong>automake</strong></span>）包括四个步骤。</p>
          <div class="orderedlist">
            <ol class="orderedlist">
              <li class="listitem">设置构建系统（“<span class="strong"><strong>vim configure.ac Makefile.am</strong></span>”和“<span class="strong"><strong>autoreconf -ivf</strong></span>”）</li>
              <li class="listitem">配置构建系统（“<span class="strong"><strong>./configure</strong></span>”）</li>
              <li class="listitem">构建源码树（“<span class="strong"><strong>make</strong></span>”）</li>
              <li class="listitem">安装二进制文件（“<span class="strong"><strong>make install</strong></span>”）</li>
            </ol>
          </div>
          <p>第一步通常由上游维护者完成并使用“<span class="strong"><strong>make dist</strong></span>”命令生成上游源码压缩包（tarball）。（所生成的源码压缩包不仅含有原始的版本控制系统中的文件，也含有其它生成的文件。）</p>
          <p>软件包维护者至少要处理第二步到第四步的工作。可以在 <span class="strong"><strong>debian/rules</strong></span> 文件中使用“<span class="strong"><strong>dh $@ --with autotools-dev</strong></span>”的命令以自动处理这些步骤。</p>
          <p>软件包维护者也可以想要处理第一步到第四步所有的工作。这时，可以在 <span class="strong"><strong>debian/rules</strong></span> 文件中使用“<span class="strong"><strong>dh $@ --with autoreconf</strong></span>”命令。这样会将所有自动生成的文件更新到最新的版本，通常可以提供对新架构的更好支持。</p>
          <p>对于使用 <span class="strong"><strong>compat</strong></span> level（兼容等级）<span class="strong"><strong>10</strong></span> 或更高等级的源码包，使用最简单的“<span class="strong"><strong>dh $@</strong></span>”而不带“<span class="strong"><strong>--with autoreconf</strong></span>”选项已可自动处理上述第一步到第四步全部内容。</p>
          <p>如果您想进一步学习 Autotools，请参考：</p>
          <div class="itemizedlist">
            <ul class="itemizedlist">
              <li class="listitem">
<a class="ulink" href="https://www.gnu.org/software/automake/manual/index.html">GNU Automake 文档</a>
</li>
              <li class="listitem">
<a class="ulink" href="https://www.gnu.org/software/autoconf/manual/index.html">GNU Autoconf 文档</a>
</li>
              <li class="listitem">
<a class="ulink" href="https://www.lrde.epita.fr/~adl/autotools.html">Autotools 教程</a>
</li>
              <li class="listitem">
<a class="ulink" href="https://www.dwheeler.com/autotools/introduction-autotools.pdf">对 autotools 的介绍（autoconf、automake 和 libtool）</a>
</li>
              <li class="listitem">
<a class="ulink" href="https://autotools.io/index.html">Autotools 流言终结者</a>
</li>
            </ul>
          </div>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h3 class="title"><a id="cmake"/>5.16.2. CMake</h3>
              </div>
            </div>
          </div>
          <p>使用 CMake 通常也包含四个步骤。</p>
          <div class="orderedlist">
            <ol class="orderedlist">
              <li class="listitem">设置构建系统（“<span class="strong"><strong>vim CMakeLists.txt config.h.in</strong></span>”）</li>
              <li class="listitem">配置构建系统（“<span class="strong"><strong>cmake</strong></span>”）</li>
              <li class="listitem">构建源码树（“<span class="strong"><strong>make</strong></span>”）</li>
              <li class="listitem">安装二进制文件（“<span class="strong"><strong>make install</strong></span>”）</li>
            </ol>
          </div>
          <p>上游源码包（tarball）不包含自动生成的文件，通常是在第一步之后直接由 <span class="strong"><strong>tar</strong></span> 命令打包生成。</p>
          <p>软件包维护者需要处理第二步到第四步的工作。</p>
          <p>如果您想进一步学习 CMake，请参考：</p>
          <div class="itemizedlist">
            <ul class="itemizedlist">
              <li class="listitem">
<a class="ulink" href="https://cmake.org/">CMake</a>
</li>
              <li class="listitem">
<a class="ulink" href="https://cmake.org/cmake-tutorial/">CMake 教程</a>
</li>
            </ul>
          </div>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h3 class="title"><a id="distutils"/>5.16.3. Python distutils</h3>
              </div>
            </div>
          </div>
          <p>使用 Python distutils 通常包含三个步骤。</p>
          <div class="orderedlist">
            <ol class="orderedlist">
              <li class="listitem">设置并配置构建系统（“<span class="strong"><strong>vim setup.py</strong></span>”）</li>
              <li class="listitem">构建源码树（“<span class="strong"><strong>python setup.py build</strong></span>”）</li>
              <li class="listitem">安装二进制文件（“<span class="strong"><strong>python setup.py install</strong></span>”）</li>
            </ol>
          </div>
          <p>上游维护者通常会处理好第一步并使用“<span class="strong"><strong>python setup.py sdist</strong></span>”命令构建好上游源码包并进行发行。</p>
          <p>软件包维护者需要处理第二步工作。在 <span class="strong"><strong>jessie</strong></span> 发布后，打包时只需要在 <span class="strong"><strong>debian/rules</strong></span> 文件中使用最简单的“<span class="strong"><strong>dh $@</strong></span>”命令。</p>
          <p>其它构建系统，如 CMake，其使用方法和 Python 这里的情况都很类似。</p>
          <p>要更多了解 Python3 和 <span class="strong"><strong>distutils</strong></span> 请参见：</p>
          <div class="itemizedlist">
            <ul class="itemizedlist">
              <li class="listitem">
<a class="ulink" href="https://docs.python.org/3/">Python3</a>
</li>
              <li class="listitem">
<a class="ulink" href="https://docs.python.org/3.4/library/distutils.html#module-distutils">distutils</a>
</li>
            </ul>
          </div>
        </div>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="dbg"/>5.17. 调试信息</h2>
            </div>
          </div>
        </div>
        <p>Debian 软件吧在构建时都会带上调试信息；但打包生成二进制软件包时，这些打包信息会按照《Debian 政策手册》中<a class="ulink" href="https://www.debian.org/doc/debian-policy/#document-ch-files">第十章 - 文件</a>的要求进行剥离。</p>
        <p>参见</p>
        <div class="itemizedlist">
          <ul class="itemizedlist">
            <li class="listitem">《Debian 开发者参考》中的 <a class="ulink" href="https://www.debian.org/doc/manuals/developers-reference/best-pkging-practices.html#bpp-dbg">6.7.9. 调试软件包的最佳实践</a>。</li>
            <li class="listitem">“Debugging with gdb”中的 <a class="ulink" href="https://sourceware.org/gdb/current/onlinedocs/gdb/Separate-Debug-Files.html#Separate-Debug-Files">18.2 单独文件中的调试信息</a></li>
            <li class="listitem"><span class="strong"><strong>dh_strip</strong></span>(1)</li>
            <li class="listitem"><span class="strong"><strong>strip</strong></span>(1)</li>
            <li class="listitem"><span class="strong"><strong>readelf</strong></span>(1)</li>
            <li class="listitem"><span class="strong"><strong>objcopy</strong></span>(1)</li>
            <li class="listitem">Debian 维基 <a class="ulink" href="https://wiki.debian.org/DebugPackage">调试软件包</a></li>
            <li class="listitem">Debian 维基 <a class="ulink" href="https://wiki.debian.org/AutomaticDebugPackages">自动调试软件包</a></li>
            <li class="listitem">Debian debian-devel 列表发布的邮件：<a class="ulink" href="https://lists.debian.org/debian-devel/2015/08/msg00443.html">自动调试软件包状态</a> (2015-08-15)</li>
          </ul>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h3 class="title"><a id="dbgsym"/>5.17.1. 新的 -dbgsym 软件包（Stretch 9.0 或更新）</h3>
              </div>
            </div>
          </div>
          <p>调试信息由 <span class="strong"><strong>dh_strip</strong></span> 命令的默认行为自动打包并进行剥离。所分离得到的调试软件包名具有 <span class="strong"><strong>-dbgsym</strong></span> 的后缀。</p>
          <p>If there were no <span class="strong"><strong>-dbg</strong></span> packages defined in the <span class="strong"><strong>debian/control</strong></span> file, no special care is needed for updating the package after the Stretch 9.0 release.</p>
          <div class="itemizedlist">
            <ul class="itemizedlist">
              <li class="listitem"><span class="strong"><strong>debian/rules</strong></span> 文件不应显式包括 <span class="strong"><strong>dh_strip</strong></span> 。</li>
              <li class="listitem">把 <span class="strong"><strong>debian/compat</strong></span> 设置到 <span class="strong"><strong>11</strong></span> 或更新版本。</li>
              <li class="listitem">把 <span class="strong"><strong>Build-Depends</strong></span> 设置为 <span class="strong"><strong>debhelper (&gt;=11~)</strong></span> 或更新的版本。</li>
            </ul>
          </div>
          <p>如果在 <span class="strong"><strong>debian/control</strong></span> 文件中曾经定义过 <span class="strong"><strong>-dbg</strong></span> 软件包，在 Stretch 9.0 发布之后对旧软件包更新需要进行额外的处理。</p>
          <div class="itemizedlist">
            <ul class="itemizedlist">
              <li class="listitem">在 <span class="strong"><strong>debian/control</strong></span> 文件中删除 <span class="strong"><strong>-dbg</strong></span> 软件包定义的部分。</li>
              <li class="listitem">将 <span class="strong"><strong>debian/rules</strong></span> 文件中“<span class="strong"><strong>dh_strip --dbg-package=</strong></span><span class="emphasis"><em>package”</em></span>这部分替换为“<span class="strong"><strong>dh_strip --dbgsym-migration=</strong></span><span class="emphasis"><em>package”</em></span>以避免自动产生的调试软件包与（现在过时的）<span class="strong"><strong>-dbg</strong></span> 文件产生冲突。参见 <span class="strong"><strong>dh_strip</strong></span>(1)。</li>
              <li class="listitem">把 <span class="strong"><strong>debian/compat</strong></span> 设置到 <span class="strong"><strong>11</strong></span> 或更新版本。</li>
              <li class="listitem">把 <span class="strong"><strong>Build-Depends</strong></span> 设置为 <span class="strong"><strong>debhelper (&gt;=11~)</strong></span> 或更新的版本。</li>
            </ul>
          </div>
        </div>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="lib"/>5.18. 库软件包</h2>
            </div>
          </div>
        </div>
        <p>打包软件库需要您投入更多的工作。下面有一些打包软件库的提醒和建议：</p>
        <div class="itemizedlist">
          <ul class="itemizedlist">
            <li class="listitem">库二进制软件包必须根据 <a class="xref" href="ch05.zh-cn.html#libnames" title="5.5.1.3. 库软件包名称">第 5.5.1.3 节 “库软件包名称”</a> 进行命名。</li>
            <li class="listitem">Debian 按照 <span class="strong"><strong>/usr/lib/&lt;triplet&gt;/lib</strong></span><span class="emphasis"><em>foo-0.1</em></span><span class="strong"><strong>.so.</strong></span><span class="emphasis"><em>1.0.0</em></span> 这样的路径提供共享链接库（参见 <a class="xref" href="ch05.zh-cn.html#multiarch" title="5.20. 多体系结构">第 5.20 节 “多体系结构”</a>）。</li>
            <li class="listitem">Debian 鼓励在共享库中使用带版本的符号（见 <a class="xref" href="ch05.zh-cn.html#symbols" title="5.18.1. 库符号">第 5.18.1 节 “库符号”</a>）。</li>
            <li class="listitem">Debian 不提供 <span class="strong"><strong>*.la</strong></span> libtool 库归档文件。</li>
            <li class="listitem">Debian 不推荐使用、提供 <span class="strong"><strong>*.a</strong></span> 静态库文件。</li>
          </ul>
        </div>
        <p>在打包共享库软件之前，请查阅：</p>
        <div class="itemizedlist">
          <ul class="itemizedlist">
            <li class="listitem">《Debian 政策手册》的<a class="ulink" href="https://www.debian.org/doc/debian-policy/#document-ch-sharedlibs">第八章 - 共享库</a></li>
            <li class="listitem">《Debian 政策手册》的<a class="ulink" href="https://www.debian.org/doc/debian-policy/#libraries">10.2 软件库</a></li>
            <li class="listitem">《Debian 开发者参考》中的 <a class="ulink" href="https://www.debian.org/doc/manuals/developers-reference/best-pkging-practices.html#bpp-libraries">6.7.2. 软件库</a></li>
          </ul>
        </div>
        <p>如需研究其历史背景，请参见：</p>
        <div class="itemizedlist">
          <ul class="itemizedlist">
            <li class="listitem">
              <p class="simpara">
<a class="ulink" href="https://debconf4.debconf.org/talks/dependency-hell/img1.html">逃离依赖地狱</a> <a href="#ftn.idm3833" class="footnote" id="idm3833"><sup class="footnote">[15]</sup></a>
</p>
              <div class="itemizedlist">
                <ul class="itemizedlist">
                  <li class="listitem">该文档鼓励在共享库中使用带版本的符号。</li>
                </ul>
              </div>
            </li>
            <li class="listitem">
              <p class="simpara">
<a class="ulink" href="https://www.netfort.gr.jp/~dancer/column/libpkg-guide/libpkg-guide.html">Debian 库打包指南</a> <a href="#ftn.idm3842" class="footnote" id="idm3842"><sup class="footnote">[16]</sup></a>
</p>
              <div class="itemizedlist">
                <ul class="itemizedlist">
                  <li class="listitem">也请阅读<a class="ulink" href="https://lists.debian.org/debian-devel/2004/06/msg00069.html">这里的公告</a>后面跟随的讨论串。</li>
                </ul>
              </div>
            </li>
          </ul>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h3 class="title"><a id="symbols"/>5.18.1. 库符号</h3>
              </div>
            </div>
          </div>
          <p>Debian <span class="strong"><strong>lenny</strong></span>（5.0，2009年5月）中引入的 <span class="strong"><strong>dpkg</strong></span> 符号支持可以帮助我们管理同一共享链接库软件包的向后 ABI 兼容性（backward ABI compatibility）。二进制软件包中的 <span class="strong"><strong>DEBIAN/symbols</strong></span> 文件提供了每个符号及其对应的最小版本号。</p>
          <p>一个极其简化的软件库打包流程大概如下所示。</p>
          <div class="itemizedlist">
            <ul class="itemizedlist">
              <li class="listitem">
                <p class="simpara">从前一个二进制软件包中使用“<span class="strong"><strong>dpkg-deb -e</strong></span>”命令解压缩得到旧有的 <span class="strong"><strong>DEBIAN/symbols</strong></span> 文件。</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist">
                    <li class="listitem">或者，<span class="strong"><strong>mc</strong></span> 命令也可以用来解压得到 <span class="strong"><strong>DEBIAN/symbols</strong></span> 文件。</li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p class="simpara">将其复制为 <span class="strong"><strong>debian/</strong></span><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>.symbols</strong></span> 文件。</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist">
                    <li class="listitem">如果这是第一次打包的话，可以只创建一个空文件。</li>
                  </ul>
                </div>
              </li>
              <li class="listitem">
                <p class="simpara">构建二进制软件包。</p>
                <div class="itemizedlist">
                  <ul class="itemizedlist">
                    <li class="listitem">
                      <p class="simpara">如果 <span class="strong"><strong>dpkg-gensymbols</strong></span> 命令警告添加了新的符号的话：</p>
                      <div class="itemizedlist">
                        <ul class="itemizedlist">
                          <li class="listitem">使用“<span class="strong"><strong>dpkg-deb -e</strong></span>”命令解压得到更新的 <span class="strong"><strong>DEBIAN/symbols</strong></span> 文件。</li>
                          <li class="listitem">将其中的 Debian 修订版本号，例如 <span class="strong"><strong>-1</strong></span>，从文件中去除。</li>
                          <li class="listitem">将其复制为 <span class="strong"><strong>debian/</strong></span><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>.symbols</strong></span> 文件。</li>
                          <li class="listitem">重新构建二进制软件包。</li>
                        </ul>
                      </div>
                    </li>
                    <li class="listitem">
                      <p class="simpara">如果 <span class="strong"><strong>dpkg-gensymbols</strong></span> 命令不报和新链接符号有关的警告：</p>
                      <div class="itemizedlist">
                        <ul class="itemizedlist">
                          <li class="listitem">您已完成了共享库的打包工作。</li>
                        </ul>
                      </div>
                    </li>
                  </ul>
                </div>
              </li>
            </ul>
          </div>
          <p>如需了解详细信息，您应当阅读下列第一手参考资料。</p>
          <div class="itemizedlist">
            <ul class="itemizedlist">
              <li class="listitem">《Debian 政策手册》的<a class="ulink" href="https://www.debian.org/doc/debian-policy/#the-symbols-system">8.6.3 符号（symbols）系统</a></li>
              <li class="listitem"><span class="strong"><strong>dh_makeshlibs</strong></span>(1)</li>
              <li class="listitem"><span class="strong"><strong>dpkg-gensymbols</strong></span>(1)</li>
              <li class="listitem"><span class="strong"><strong>dpkg-shlibdeps</strong></span>(1)</li>
              <li class="listitem"><span class="strong"><strong>deb-symbols</strong></span>(5)</li>
            </ul>
          </div>
          <p>您也应当查看：</p>
          <div class="itemizedlist">
            <ul class="itemizedlist">
              <li class="listitem">Debian 维基 <a class="ulink" href="https://wiki.debian.org/UsingSymbolsFiles">使用符号文件</a></li>
              <li class="listitem">Debian 维基 <a class="ulink" href="https://wiki.debian.org/Projects/ImprovedDpkgShlibdeps">项目/改进的DpkgShlibdeps</a></li>
              <li class="listitem">Debian kde 团队 <a class="ulink" href="https://pkg-kde.alioth.debian.org/symbolfiles.html">处理 symbols 文件</a></li>
              <li class="listitem">
<a class="xref" href="ch08.zh-cn.html#autotools-multi" title="8.11. Autotools（多个二进制软件包）">第 8.11 节 “Autotools（多个二进制软件包）”</a>
</li>
              <li class="listitem">
<a class="xref" href="ch08.zh-cn.html#cmake-multi" title="8.12. CMake（多个二进制软件包）">第 8.12 节 “CMake（多个二进制软件包）”</a>
</li>
            </ul>
          </div>
          <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">
            <table border="0" summary="Tip">
              <tr>
                <td rowspan="2" align="center" valign="top">
                  <img alt="[提示]" src="images/tip.png"/>
                </td>
                <th align="left">提示</th>
              </tr>
              <tr>
                <td align="left" valign="top">
                  <p>对于 C++ 软件库或者其它一些难以跟踪符号变化的场景，请遵循《Debian 政策手册》的 <span class="strong"><strong>-1</strong></span> 一节的内容。请确保这样操作时事先删除 <span class="strong"><strong>debmake</strong></span> 命令生成的空的 <span class="strong"><strong>debian/</strong></span><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>.symbols</strong></span> 文件。在这种情况下，应当转而使用 <span class="strong"><strong>DEBIAN/shlibs</strong></span> 文件。</p>
                </td>
              </tr>
            </table>
          </div>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h3 class="title"><a id="lib-trans"/>5.18.2. 库变迁</h3>
              </div>
            </div>
          </div>
          <p>当您打包新版本的库软件包而且此次更新影响到其它的软件包时，您必须向 <span class="strong"><strong>release.debian.org</strong></span> 伪软件包提交一个变迁 bug 报告并附带一个<a class="ulink" href="https://ben.debian.net/#_query_language">ben 文件</a>；您可以使用 <span class="strong"><strong>reportbug</strong></span> 工具进行提交。提交后，请等待<a class="ulink" href="https://wiki.debian.org/Teams/ReleaseTeam">发行团队</a>的审核批准方可进行下一步。</p>
          <p>发行团队提供了<a class="ulink" href="https://release.debian.org/transitions/">变迁跟踪系统</a>。参见 <a class="ulink" href="https://wiki.debian.org/Teams/ReleaseTeam/Transitions">变迁（Transition）</a>。</p>
          <div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;">
            <table border="0" summary="Caution">
              <tr>
                <td rowspan="2" align="center" valign="top">
                  <img alt="[小心]" src="images/caution.png"/>
                </td>
                <th align="left">小心</th>
              </tr>
              <tr>
                <td align="left" valign="top">
                  <p>请确保您按照 <a class="xref" href="ch05.zh-cn.html#libnames" title="5.5.1.3. 库软件包名称">第 5.5.1.3 节 “库软件包名称”</a> 的描述正确地对二进制软件包进行了重命名。</p>
                </td>
              </tr>
            </table>
          </div>
        </div>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="debconf"/>5.19. debconf</h2>
            </div>
          </div>
        </div>
        <p><span class="strong"><strong>debconf</strong></span> 软件包可以帮助我们在下列两种情况下配置软件包：</p>
        <div class="itemizedlist">
          <ul class="itemizedlist">
            <li class="listitem">在 <span class="strong"><strong>debian-installer</strong></span>（Debian 安装器）预安装时进行非交互式配置。</li>
            <li class="listitem">
              <p class="simpara">使用菜单界面进行交互式配置（<span class="strong"><strong>对话框（dialog）</strong></span>、<span class="strong"><strong>gnome</strong></span>、<span class="strong"><strong>kde</strong></span> 等等）</p>
              <div class="itemizedlist">
                <ul class="itemizedlist">
                  <li class="listitem">软件包安装时：由 <span class="strong"><strong>dpkg</strong></span> 命令调用</li>
                  <li class="listitem">对已安装软件包：由 <span class="strong"><strong>dpkg-reconfigure</strong></span> 命令调用</li>
                </ul>
              </div>
            </li>
          </ul>
        </div>
        <p>软件包安装时的所有用户交互都必须由这里的 <span class="strong"><strong>debconf</strong></span> 系统进行处理，下列配置文件对这个过程进行控制。</p>
        <div class="itemizedlist">
          <ul class="itemizedlist">
            <li class="listitem">
              <p class="simpara">
                <span class="strong">
                  <strong>debian/</strong>
                </span>
                <span class="emphasis">
                  <em>binarypackage</em>
                </span>
                <span class="strong">
                  <strong>.config</strong>
                </span>
              </p>
              <div class="itemizedlist">
                <ul class="itemizedlist">
                  <li class="listitem">这是 <span class="strong"><strong>debconf</strong></span> <span class="strong"><strong>config</strong></span> 脚本，用于向用户询问对于配置软件包必需的问题。</li>
                </ul>
              </div>
            </li>
            <li class="listitem">
              <p class="simpara">
                <span class="strong">
                  <strong>debian/</strong>
                </span>
                <span class="emphasis">
                  <em>binarypackage</em>
                </span>
                <span class="strong">
                  <strong>.template</strong>
                </span>
              </p>
              <div class="itemizedlist">
                <ul class="itemizedlist">
                  <li class="listitem">这是 <span class="strong"><strong>debconf</strong></span> <span class="strong"><strong>templates</strong></span>（模板）文件，用于向用户询问对于配置软件包必需的问题。</li>
                </ul>
              </div>
            </li>
            <li class="listitem">
              <p class="simpara">软件包配置脚本</p>
              <div class="itemizedlist">
                <ul class="itemizedlist">
                  <li class="listitem">
                    <span class="strong">
                      <strong>debian/</strong>
                    </span>
                    <span class="emphasis">
                      <em>binarypackage</em>
                    </span>
                    <span class="strong">
                      <strong>.preinst</strong>
                    </span>
                  </li>
                  <li class="listitem">
                    <span class="strong">
                      <strong>debian/</strong>
                    </span>
                    <span class="emphasis">
                      <em>binarypackage</em>
                    </span>
                    <span class="strong">
                      <strong>.prerm</strong>
                    </span>
                  </li>
                  <li class="listitem">
                    <span class="strong">
                      <strong>debian/</strong>
                    </span>
                    <span class="emphasis">
                      <em>binarypackage</em>
                    </span>
                    <span class="strong">
                      <strong>.postinst</strong>
                    </span>
                  </li>
                  <li class="listitem">
                    <span class="strong">
                      <strong>debian/</strong>
                    </span>
                    <span class="emphasis">
                      <em>binarypackage</em>
                    </span>
                    <span class="strong">
                      <strong>.postrm</strong>
                    </span>
                  </li>
                </ul>
              </div>
            </li>
          </ul>
        </div>
        <p>参见 <span class="strong"><strong>dh_installdebconf</strong></span>(1)、<span class="strong"><strong>debconf</strong></span>(7)、<span class="strong"><strong>debconf-devel</strong></span>(7) 和《Debian 政策手册》中的 <a class="ulink" href="https://www.debian.org/doc/debian-policy/#prompting-in-maintainer-scripts">3.9.1 维护者脚本中的用户交互提示</a>。</p>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="multiarch"/>5.20. 多体系结构</h2>
            </div>
          </div>
        </div>
        <p>Debian <span class="strong"><strong>wheezy</strong></span>（7.0，2013年5月）在 <span class="strong"><strong>dpkg</strong></span> 和 <span class="strong"><strong>apt</strong></span> 中引入了对跨架构二进制软件包安装的多架构支持（特别是 <span class="strong"><strong>i386</strong></span> 架构和 <span class="strong"><strong>amd64</strong></span> 架构，但也支持其它的组合），这部分内容值得我们额外关注。</p>
        <p>您应当详细阅读下列参考内容。</p>
        <div class="itemizedlist">
          <ul class="itemizedlist">
            <li class="listitem">
              <p class="simpara">Ubuntu 维基（上游）</p>
              <div class="itemizedlist">
                <ul class="itemizedlist">
                  <li class="listitem">
<a class="ulink" href="https://wiki.ubuntu.com/MultiarchSpec">多架构规范（MultiarchSpec）</a>
</li>
                </ul>
              </div>
            </li>
            <li class="listitem">
              <p class="simpara">Debian 维基（Debian 的现状）</p>
              <div class="itemizedlist">
                <ul class="itemizedlist">
                  <li class="listitem">
<a class="ulink" href="https://wiki.debian.org/Multiarch">Debian 多架构支持</a>
</li>
                  <li class="listitem">
<a class="ulink" href="https://wiki.debian.org/Multiarch/Implementation">多架构支持/实现（Multiarch/Implementation）</a>
</li>
                </ul>
              </div>
            </li>
          </ul>
        </div>
        <p>多架构支持使用三元组（<span class="strong"><strong>&lt;triplet&gt;</strong></span>）的值，例如 <span class="strong"><strong>i386-linux-gnu</strong></span>  和 <span class="strong"><strong>x86_64-linux-gnu</strong></span>；它们出现在共享链接库的安装路径中，例如 <span class="strong"><strong>/usr/lib/&lt;triplet&gt;/</strong></span>，等等。</p>
        <div class="itemizedlist">
          <ul class="itemizedlist">
            <li class="listitem">三元组 <span class="strong"><strong>&lt;triplet&gt;</strong></span> 的值由 <span class="strong"><strong>debhelper</strong></span> 脚本隐式提前设置好，软件包维护者无需担心。</li>
            <li class="listitem">
              <p class="simpara">不过，在 <span class="strong"><strong>debian/rules</strong></span> 文件中用于 <span class="strong"><strong>override_dh_</strong></span>* 目标的三元组 <span class="strong"><strong>&lt;triplet&gt;</strong></span> 值需要由维护者手动进行显式设置。三元组 <span class="strong"><strong>&lt;triplet&gt;</strong></span> 的值可由 <span class="strong"><strong>$(DEB_HOST_MULTIARCH)</strong></span> 变量在 <span class="strong"><strong>debian/rules</strong></span> 文件中获取到，具体方法如下：</p>
              <pre class="screen">DEB_HOST_MULTIARCH = $(shell dpkg-architecture -qDEB_HOST_MULTIARCH)
...
override_dh_install:
        mkdir -p package1/lib/$(DEB_HOST_MULTIARCH)
        cp -dR tmp/lib/. package1/lib/$(DEB_HOST_MULTIARCH)</pre>
            </li>
          </ul>
        </div>
        <p>参见：</p>
        <div class="itemizedlist">
          <ul class="itemizedlist">
            <li class="listitem">
<a class="xref" href="ch05.zh-cn.html#variablesrules" title="5.4.4. debian/rules 中的变量">第 5.4.4 节 “debian/rules 中的变量”</a>
</li>
            <li class="listitem"><span class="strong"><strong>dpkg-architecture</strong></span>(1)</li>
            <li class="listitem">
<a class="xref" href="ch05.zh-cn.html#boption" title="5.5.1.1. debmake -b">第 5.5.1.1 节 “debmake -b”</a>
</li>
            <li class="listitem">
<a class="xref" href="ch05.zh-cn.html#package-split-example" title="5.5.1.2. 拆包的场景和例子">第 5.5.1.2 节 “拆包的场景和例子”</a>
</li>
          </ul>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h3 class="title"><a id="_the_multiarch_library_path"/>5.20.1. 多架构库路径</h3>
              </div>
            </div>
          </div>
          <p>Debian 政策要求遵守<a class="ulink" href="https://www.debian.org/doc/packaging-manuals/fhs/fhs-2.3.html">文件系统层级标准</a>。其中 <a class="ulink" href="https://www.debian.org/doc/packaging-manuals/fhs/fhs-2.3.html#USRLIBLIBRARIESFORPROGRAMMINGANDPA">/usr/lib：程序和软件包的库</a> 声明“<span class="strong"><strong>/usr/lib</strong></span> 包含目标文件、库和其它不应由用户或 shell 脚本直接调用的内部二进制文件。”</p>
          <p>Debian 在<a class="ulink" href="https://www.debian.org/doc/packaging-manuals/fhs/fhs-2.3.html">文件系统层级标准</a>的基础上添加一项例外，即使用 <span class="strong"><strong>/usr/lib/&lt;triplet&gt;/</strong></span> 而非 <span class="strong"><strong>/usr/lib&lt;qual&gt;/</strong></span>（例如，<span class="strong"><strong>/lib32/</strong></span> 和 <span class="strong"><strong>/lib64/</strong></span>）以对多架构库提供支持。</p>
          <div class="table">
            <a id="idm4101"/>
            <p class="title">
              <strong>表 5.1. 多架构库路径选项</strong>
            </p>
            <div class="table-contents">
              <table class="table" summary="多架构库路径选项" border="1">
                <colgroup>
                  <col class="col_1"/>
                  <col class="col_2"/>
                  <col class="col_3"/>
                </colgroup>
                <thead>
                  <tr>
                    <th style="text-align: left" valign="top">经典路径</th>
                    <th style="text-align: left" valign="top">i386 多体系结构路径</th>
                    <th style="text-align: left" valign="top">amd64 多体系结构路径</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td style="text-align: left" valign="top">
                      <p>
                        <span class="strong">
                          <strong>/lib/</strong>
                        </span>
                      </p>
                    </td>
                    <td style="text-align: left" valign="top">
                      <p>
                        <span class="strong">
                          <strong>/lib/i386-linux-gnu/</strong>
                        </span>
                      </p>
                    </td>
                    <td style="text-align: left" valign="top">
                      <p>
                        <span class="strong">
                          <strong>/lib/x86_64-linux-gnu/</strong>
                        </span>
                      </p>
                    </td>
                  </tr>
                  <tr>
                    <td style="text-align: left" valign="top">
                      <p>
                        <span class="strong">
                          <strong>/usr/lib/</strong>
                        </span>
                      </p>
                    </td>
                    <td style="text-align: left" valign="top">
                      <p>
                        <span class="strong">
                          <strong>/usr/lib/i386-linux-gnu/</strong>
                        </span>
                      </p>
                    </td>
                    <td style="text-align: left" valign="top">
                      <p>
                        <span class="strong">
                          <strong>/usr/lib/x86_64-linux-gnu/</strong>
                        </span>
                      </p>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <br class="table-break"/>
          <p>对基于 Autotools 且由 <span class="strong"><strong>debhelper</strong></span> （compat&gt;=9）管理的软件包来说，这些路径设置已由 <span class="strong"><strong>dh_auto_configure</strong></span> 命令自动处理。</p>
          <p>对于其它使用不支持的构建系统的软件包，您需要按照下面的方式手动调整安装路径。</p>
          <div class="itemizedlist">
            <ul class="itemizedlist">
              <li class="listitem">如果在 <span class="strong"><strong>debian/rules</strong></span> 文件中设置了 <span class="strong"><strong>override_dh_auto_configure</strong></span> 目标且其中手动调用了“<span class="strong"><strong>./configure</strong></span>”命令，请确保将其替换为“<span class="strong"><strong>dh_auto_configure --</strong></span>”，这样可以将安装路径从 <span class="strong"><strong>/usr/lib/</strong></span> 替换为 <span class="strong"><strong>/usr/lib/$(DEB_HOST_MULTIARCH)/</strong></span>。</li>
              <li class="listitem">请在 <span class="strong"><strong>debian/</strong></span><span class="emphasis"><em>foo</em></span><span class="strong"><strong>.install</strong></span> 文件中将所有出现的 <span class="strong"><strong>/usr/lib/</strong></span> 字符串替换为 <span class="strong"><strong>/usr/lib/*/</strong></span>。</li>
            </ul>
          </div>
          <p>所有启用多架构的软件包安装至相同路径的文件必须内容完全相同。您必须小心处理，避免数据字节序或者压缩算法等等问题带来的文件内容差异。</p>
          <div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
            <table border="0" summary="Note">
              <tr>
                <td rowspan="2" align="center" valign="top">
                  <img alt="[注意]" src="images/note.png"/>
                </td>
                <th align="left">注意</th>
              </tr>
              <tr>
                <td align="left" valign="top">
                  <p><span class="strong"><strong>./configure</strong></span> 的 <span class="strong"><strong>--libexecdir</strong></span>选项指定了由程序而非用户所使用的可执行文件的默认安装路径。其 Autotools 的默认值为 <span class="strong"><strong>/usr/libexec/</strong></span> 但在未启用多架构特性的 Debian 系统上其默认值是 <span class="strong"><strong>/usr/lib/</strong></span>。如果这些可执行程序属于被标记为“Multi-arch: foreign”的软件包，最好还是使用例如 <span class="strong"><strong>/usr/lib/</strong></span> 或者 <span class="strong"><strong>/usr/lib/</strong></span><span class="emphasis"><em>软件包名</em></span> 这样的路径而非使用 <span class="strong"><strong>dh_auto_configure</strong></span> 设置的 <span class="strong"><strong>/usr/lib/&lt;triplet&gt;/</strong></span> 路径。<a class="ulink" href="https://www.gnu.org/prep/standards/html_node/Directory-Variables.html">GNU 编程规范：7.2.5 用于安装目录的变量</a> 对 <span class="strong"><strong>libexecdir</strong></span> 的描述是“<span class="strong"><strong>libexecdir</strong></span> 的定义对所有软件包相同，所以您应当将您的数据安装在其下的一个子目录中。大多数软件包将数据安装至 <span class="strong"><strong>$(libexecdir)/package-name/</strong></span> 之中……”（在与 Debian 政策不冲突的前提下，遵守 GNU 的标准总是更好的。）</p>
                </td>
              </tr>
            </table>
          </div>
          <p>位于默认路径 <span class="strong"><strong>/usr/lib/</strong></span> 和 <span class="strong"><strong>/usr/lib/&lt;triplet&gt;/</strong></span> 的共享库可被自动加载。</p>
          <p>对位于其它路径的共享库，必须使用 <span class="strong"><strong>pkg-config</strong></span> 命令设置 GCC 选项 <span class="strong"><strong>-l</strong></span> 以正确进行加载。</p>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h3 class="title"><a id="_the_multiarch_header_file_path"/>5.20.2. 多架构头文件路径</h3>
              </div>
            </div>
          </div>
          <p>在支持多架构的 Debian 系统上，GCC 默认会同时包含、使用 <span class="strong"><strong>/usr/include/</strong></span> 和 <span class="strong"><strong>/usr/include/&lt;triplet&gt;/</strong></span> 下的头文件。</p>
          <p>如果头文件不在这些路径中，必须使用 <span class="strong"><strong>pkg-config</strong></span> 命令设置 GCC 的 <span class="strong"><strong>-I</strong></span> 参数以使得“<span class="strong"><strong>#include &lt;</strong></span><span class="emphasis"><em>foo.h</em></span><span class="strong"><strong>&gt;</strong></span>”正常工作。</p>
          <div class="table">
            <a id="idm4186"/>
            <p class="title">
              <strong>表 5.2. 多架构头文件路径选项</strong>
            </p>
            <div class="table-contents">
              <table class="table" summary="多架构头文件路径选项" border="1">
                <colgroup>
                  <col class="col_1"/>
                  <col class="col_2"/>
                  <col class="col_3"/>
                </colgroup>
                <thead>
                  <tr>
                    <th style="text-align: left" valign="top">经典路径</th>
                    <th style="text-align: left" valign="top">i386 多体系结构路径</th>
                    <th style="text-align: left" valign="top">amd64 多体系结构路径</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td style="text-align: left" valign="top">
                      <p>
                        <span class="strong">
                          <strong>/usr/include/</strong>
                        </span>
                      </p>
                    </td>
                    <td style="text-align: left" valign="top">
                      <p>
                        <span class="strong">
                          <strong>/usr/include/i386-linux-gnu/</strong>
                        </span>
                      </p>
                    </td>
                    <td style="text-align: left" valign="top">
                      <p>
                        <span class="strong">
                          <strong>/usr/include/x86_64-linux-gnu/</strong>
                        </span>
                      </p>
                    </td>
                  </tr>
                  <tr>
                    <td style="text-align: left" valign="top">
                      <p>
                        <span class="strong">
                          <strong>/usr/include/</strong>
                        </span>
                        <span class="emphasis">
                          <em>软件包名</em>
                        </span>
                        <span class="strong">
                          <strong>/</strong>
                        </span>
                      </p>
                    </td>
                    <td style="text-align: left" valign="top">
                      <p>
                        <span class="strong">
                          <strong>/usr/include/i386-linux-gnu/</strong>
                        </span>
                        <span class="emphasis">
                          <em>软件包名</em>
                        </span>
                        <span class="strong">
                          <strong>/</strong>
                        </span>
                      </p>
                    </td>
                    <td style="text-align: left" valign="top">
                      <p>
                        <span class="strong">
                          <strong>/usr/include/x86_64-linux-gnu/</strong>
                        </span>
                        <span class="emphasis">
                          <em>软件包名</em>
                        </span>
                        <span class="strong">
                          <strong>/</strong>
                        </span>
                      </p>
                    </td>
                  </tr>
                  <tr>
                    <td style="text-align: left" valign="top">
                      <p/>
                    </td>
                    <td style="text-align: left" valign="top">
                      <p>
                        <span class="strong">
                          <strong>/usr/lib/i386-linux-gnu/</strong>
                        </span>
                        <span class="emphasis">
                          <em>软件包名</em>
                        </span>
                        <span class="strong">
                          <strong>/</strong>
                        </span>
                      </p>
                    </td>
                    <td style="text-align: left" valign="top">
                      <p>
                        <span class="strong">
                          <strong>/usr/lib/x86_64-linux-gnu/</strong>
                        </span>
                        <span class="emphasis">
                          <em>软件包名</em>
                        </span>
                        <span class="strong">
                          <strong>/</strong>
                        </span>
                      </p>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <br class="table-break"/>
          <p>为库文件使用 <span class="strong"><strong>/usr/lib/&lt;triplet&gt;/</strong></span><span class="emphasis"><em>软件包名</em></span><span class="strong"><strong>/</strong></span> 路径可帮助上游维护者对使用 <span class="strong"><strong>/usr/lib/&lt;triplet&gt;</strong></span> 的多架构系统和使用 <span class="strong"><strong>/usr/lib&lt;qual&gt;/</strong></span> 的双架构系统使用相同的安装脚本。<a href="#ftn.idm4243" class="footnote" id="idm4243"><sup class="footnote">[17]</sup></a></p>
          <p>使用包含 <span class="emphasis"><em>packagename</em></span> 的文件路径也使得在同一系统上同时安装多个架构的开发库成为可能。</p>
        </div>
        <div class="section">
          <div class="titlepage">
            <div>
              <div>
                <h3 class="title"><a id="_the_multiarch_emphasis_role_strong_pc_emphasis_file_path"/>5.20.3. 多架构支持下的 <span class="strong"><strong>*.pc</strong></span> 文件路径</h3>
              </div>
            </div>
          </div>
          <p><span class="emphasis"><em>packagename</em></span> 用来获取系统上已安装库的信息。它在 <span class="strong"><strong>*.pc</strong></span> 文件中存储配置参数，用来设置 GCC 的 <span class="strong"><strong>-I</strong></span> 和 <span class="strong"><strong>-l</strong></span> 选项。</p>
          <div class="table">
            <a id="idm4257"/>
            <p class="title">
              <strong>表 5.3. <span class="strong">*.pc</span> 文件路径选项</strong>
            </p>
            <div class="table-contents">
              <table class="table" summary="*.pc 文件路径选项" border="1">
                <colgroup>
                  <col class="col_1"/>
                  <col class="col_2"/>
                  <col class="col_3"/>
                </colgroup>
                <thead>
                  <tr>
                    <th style="text-align: left" valign="top">经典路径</th>
                    <th style="text-align: left" valign="top">i386 多体系结构路径</th>
                    <th style="text-align: left" valign="top">amd64 多体系结构路径</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td style="text-align: left" valign="top">
                      <p>
                        <span class="strong">
                          <strong>/usr/lib/pkgconfig/</strong>
                        </span>
                      </p>
                    </td>
                    <td style="text-align: left" valign="top">
                      <p>
                        <span class="strong">
                          <strong>/usr/lib/pkgconfig/</strong>
                        </span>
                      </p>
                    </td>
                    <td style="text-align: left" valign="top">
                      <p>
                        <span class="strong">
                          <strong>/usr/lib/x86_64-linux-gnu/pkgconfig/</strong>
                        </span>
                      </p>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <br class="table-break"/>
        </div>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="harden"/>5.21. 编译加固</h2>
            </div>
          </div>
        </div>
        <p>自 Debian <span class="strong"><strong>jessie</strong></span>（8.0 开始）的编译器加固支持要求我们在打包时加以注意。</p>
        <p>您应当详细阅读下列参考内容。</p>
        <div class="itemizedlist">
          <ul class="itemizedlist">
            <li class="listitem">Debian 维基 <a class="ulink" href="https://wiki.debian.org/Hardening">Hardening（加固）</a></li>
            <li class="listitem">Debian 维基 <a class="ulink" href="https://wiki.debian.org/HardeningWalkthrough">Hardening Walkthrough（加固指南）</a></li>
          </ul>
        </div>
        <p><span class="strong"><strong>debmake</strong></span> 命令会向 <span class="strong"><strong>debian/rules</strong></span> 文件中按需添加 <span class="strong"><strong>DEB_BUILD_MAINT_OPTIONS</strong></span>、<span class="strong"><strong>DEB_CFLAGS_MAINT_APPEND</strong></span> 和 <span class="strong"><strong>DEB_LDFLAGS_MAINT_APPEND</strong></span> 的项目（参见 <a class="xref" href="ch04.zh-cn.html" title="第 4 章 简单例子">第 4 章 <em>简单例子</em></a> 和 <span class="strong"><strong>dpkg-buildflags</strong></span>(1)）。</p>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="ci"/>5.22. 持续集成</h2>
            </div>
          </div>
        </div>
        <p><a class="ulink" href="http://dep.debian.net/deps/dep8/">DEP-8</a> 定义了 <span class="strong"><strong>debian/tests/control</strong></span> 文件的格式，它是 RFC822 风格的测试元数据文件，用于 Debian 软件包的<a class="ulink" href="https://en.wikipedia.org/wiki/Continuous_integration">持续集成</a>（CI）。</p>
        <p>它在完成构建包含 <span class="strong"><strong>debian/tests/control</strong></span> 文件的源码包、得到二进制包之后发挥作用。在运行 <span class="strong"><strong>autopkgtest</strong></span> 命令时，所生成的二进制软件包会根据这个文件在虚拟环境中自动进行安装和测试。</p>
        <p>请参考 <span class="strong"><strong>/usr/share/doc/autopkgtest/</strong></span> 目录下的文档和《Debian 打包指导”中的 <a class="ulink" href="http://packaging.ubuntu.com/html/auto-pkg-test.html">3. autopkgtest: 软件包的自动测试</a>。</p>
        <p>您可以在 Debian 系统上探索使用不同的持续集成系统。</p>
        <div class="itemizedlist">
          <ul class="itemizedlist">
            <li class="listitem"><span class="strong"><strong>debci</strong></span> 软件包：建立在 <span class="strong"><strong>autopkgtest</strong></span> 之上的持续集成平台</li>
            <li class="listitem"><span class="strong"><strong>jenkins</strong></span> 软件包：通用持续集成平台</li>
          </ul>
        </div>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="bootstrap"/>5.23. 自举</h2>
            </div>
          </div>
        </div>
        <p>Debian 关心对新硬件架构的移植工作。新架构的移植工作对<a class="ulink" href="https://wiki.debian.org/DebianBootstrap">自举（bootstrapping）</a>操作有所要求，以完成对初始最小本地构建系统的交叉编译。为了在自举（bootstrapping）时避免构建依赖成环的问题，需要使用 <a class="ulink" href="https://wiki.debian.org/BuildProfileSpec">配置类型（profile）</a> 的构建功能特性来缩减所需构建依赖。</p>
        <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">
          <table border="0" summary="Tip">
            <tr>
              <td rowspan="2" align="center" valign="top">
                <img alt="[提示]" src="images/tip.png"/>
              </td>
              <th align="left">提示</th>
            </tr>
            <tr>
              <td align="left" valign="top">
                <p>如果一个核心软件包 <code class="literal">foo</code> 构建时依赖于 <code class="literal">bar</code> 软件包，但后者会引入一长串构建依赖链而且 <code class="literal">bar</code> 仅在 <code class="literal">foo</code> 的 <span class="strong"><strong>test</strong></span> 目标中使用（即仅用于构建后测试），那么您可以安全地在 <code class="literal">foo</code> 软件包的 <span class="strong"><strong>Build-depends</strong></span> 一栏中将 <code class="literal">bar</code> 标记为 <span class="strong"><strong>&lt;!nocheck&gt;</strong></span> 以规避构建依赖环。</p>
              </td>
            </tr>
          </table>
        </div>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="bug"/>5.24. 错误报告</h2>
            </div>
          </div>
        </div>
        <p><span class="strong"><strong>reportbug</strong></span> 命令用于提交 <span class="emphasis"><em>binarypackage</em></span> 软件包的错误报告；<span class="strong"><strong>usr/share/bug/</strong></span><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>/</strong></span> 可以对针对该软件所提交报告的内容进行自定义。</p>
        <p><span class="strong"><strong>dh_bugfiles</strong></span> 命令将安装以下位于 <span class="strong"><strong>debian/</strong></span> 目录中的的模板文件。</p>
        <div class="itemizedlist">
          <ul class="itemizedlist">
            <li class="listitem">
              <p class="simpara"><span class="strong"><strong>debian/</strong></span><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>.bug-control</strong></span> → <span class="strong"><strong>usr/share/bug/</strong></span><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>/control</strong></span></p>
              <div class="itemizedlist">
                <ul class="itemizedlist">
                  <li class="listitem">该文件包含诸如重定向错误报告至其它软件包的一些指导性内容。</li>
                </ul>
              </div>
            </li>
            <li class="listitem">
              <p class="simpara"><span class="strong"><strong>debian/</strong></span><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>.bug-presubj</strong></span> → <span class="strong"><strong>usr/share/bug/</strong></span><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>/presubj</strong></span></p>
              <div class="itemizedlist">
                <ul class="itemizedlist">
                  <li class="listitem">该文件的内容将由 <span class="strong"><strong>reportbug</strong></span> 命令向用户展示。</li>
                </ul>
              </div>
            </li>
            <li class="listitem">
              <p class="simpara"><span class="strong"><strong>debian/</strong></span><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>.bug-script</strong></span> → <span class="strong"><strong>usr/share/bug/</strong></span><span class="emphasis"><em>binarypackage</em></span> or <span class="strong"><strong>usr/share/bug/</strong></span><span class="emphasis"><em>binarypackage</em></span><span class="strong"><strong>/script</strong></span></p>
              <div class="itemizedlist">
                <ul class="itemizedlist">
                  <li class="listitem"><span class="strong"><strong>reportbug</strong></span> 命令运行此脚本以生成错误报告的模板文件。</li>
                </ul>
              </div>
            </li>
          </ul>
        </div>
        <p>参见 <span class="strong"><strong>dh_bugfiles</strong></span>(1) 和 <a class="ulink" href="file:///usr/share/doc/reportbug/README.developers.gz">为开发者提供的 reportbug 功能特性</a></p>
        <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">
          <table border="0" summary="Tip">
            <tr>
              <td rowspan="2" align="center" valign="top">
                <img alt="[提示]" src="images/tip.png"/>
              </td>
              <th align="left">提示</th>
            </tr>
            <tr>
              <td align="left" valign="top">
                <p>如果您总是需要提醒提交报告的用户某些注意事项或询问他们某些问题，使用这些文件可以将这个过程自动化。</p>
              </td>
            </tr>
          </table>
        </div>
      </div>
      <div class="footnotes">
        <br/>
        <hr/>
        <div id="ftn.idm1589" class="footnote">
          <p><a href="#idm1589" class="simpara"><sup class="simpara">[10] </sup></a>对九成以上的软件包来说，软件包名称都不会超过 24 个字符；上游版本号通常不超过 10 个字符，而 Debian 修订版本号也通常不超过 3 个字符。</p>
        </div>
        <div id="ftn.idm1762" class="footnote">
          <p><a href="#idm1762" class="simpara"><sup class="simpara">[11] </sup></a>这个简化形式在 <span class="strong"><strong>debhelper</strong></span> 软件包第七版或更新的版本中可用。本指南内容假设您在使用 <span class="strong"><strong>debhelper</strong></span> 第九版或更新的版本。</p>
        </div>
        <div id="ftn.idm1767" class="footnote">
          <p><a href="#idm1767" class="simpara"><sup class="simpara">[12] </sup></a><span class="strong"><strong>debmake</strong></span> 命令会产生稍微复杂一些的 <span class="strong"><strong>debian/rules</strong></span> 文件。虽然如此，其核心结构没有什么变化。</p>
        </div>
        <div id="ftn.idm2484" class="footnote">
          <p><a href="#idm2484" class="simpara"><sup class="simpara">[13] </sup></a>如果您在使用 <span class="strong"><strong>vim</strong></span> 编辑器，请确保使用“<span class="strong"><strong>:wq</strong></span>”命令对内容进行保存。</p>
        </div>
        <div id="ftn.idm2500" class="footnote">
          <p><a href="#idm2500" class="simpara"><sup class="simpara">[14] </sup></a>程序以前会在内部调用来自 <span class="strong"><strong>devscripts</strong></span> 软件包的 <span class="strong"><strong>licensecheck</strong></span> 命令来进行检查。现在的 <span class="strong"><strong>licensecheck</strong></span> 命令由独立的 <span class="strong"><strong>licensecheck</strong></span> 软件包所提供，相较从前的实现也有了较大的改进。</p>
        </div>
        <div id="ftn.idm3833" class="footnote">
          <p><a href="#idm3833" class="simpara"><sup class="simpara">[15] </sup></a>该文档是在 <span class="strong"><strong>symbols</strong></span> 文件被引入之前写成的。</p>
        </div>
        <div id="ftn.idm3842" class="footnote">
          <p><a href="#idm3842" class="simpara"><sup class="simpara">[16] </sup></a>在<a class="ulink" href="https://www.netfort.gr.jp/~dancer/column/libpkg-guide/libpkg-guide.html#devpkg">第六章 - 开发（-DEV）软件包</a>中，存在强烈的使用含有 SONAME 版本号的 <span class="strong"><strong>-dev</strong></span> 软件包名而非仅使用 <span class="strong"><strong>-dev</strong></span> 作为名称的偏好，但前 ftp-master 成员（Steve Langasek）对此有不同意见。请注意该文档在 <span class="strong"><strong>multiarch</strong></span> 系统和 <span class="strong"><strong>symbols</strong></span> 引入之前写成，可能有一定程度的过时。</p>
        </div>
        <div id="ftn.idm4243" class="footnote">
          <p><a href="#idm4243" class="simpara"><sup class="simpara">[17] </sup></a>这个路径和 FHS 兼容。<a class="ulink" href="https://www.debian.org/doc/packaging-manuals/fhs/fhs-2.3.html#USRLIBLIBRARIESFORPROGRAMMINGANDPA">文件系统层级标准：/usr/lib：程序和软件包的库</a> 称“应用程序可以使用 <span class="strong"><strong>/usr/lib</strong></span> 下的一个子目录。如果一个应用程序使用一个子目录，所有由此程序所使用的架构相关数据均须放置于该子目录下。”</p>
        </div>
      </div>
    </div>
    <div class="navfooter">
      <hr/>
      <table width="100%" summary="Navigation footer">
        <tr>
          <td align="left"><a accesskey="p" href="ch04.zh-cn.html"><img src="images/prev.png" alt="上一页"/></a> </td>
          <td align="center"> </td>
          <td align="right"> <a accesskey="n" href="ch06.zh-cn.html"><img src="images/next.png" alt="下一页"/></a></td>
        </tr>
        <tr>
          <td align="left" valign="top">第 4 章 简单例子 </td>
          <td align="center">
            <a accesskey="h" href="index.zh-cn.html">
              <img src="images/home.png" alt="起始页"/>
            </a>
          </td>
          <td align="right" valign="top"> 第 6 章 debmake 选项</td>
        </tr>
      </table>
    </div>
  </body>
</html>
