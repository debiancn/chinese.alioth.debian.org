<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>第 8 章 更多示例</title>
    <link rel="stylesheet" type="text/css" href="debian.css"/>
    <meta name="generator" content="DocBook XSL Stylesheets V1.79.1"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <link rel="home" href="index.zh-cn.html" title="Debian 维护者指南"/>
    <link rel="up" href="index.zh-cn.html" title="Debian 维护者指南"/>
    <link rel="prev" href="ch07.zh-cn.html" title="第 7 章 提示"/>
    <link rel="next" href="apa.zh-cn.html" title="附录 A. debmake(1) 手册页"/>
  </head>
  <body>
    <div class="navheader">
      <table width="100%" summary="Navigation header">
        <tr>
          <th colspan="3" align="center">第 8 章 更多示例</th>
        </tr>
        <tr>
          <td align="left"><a accesskey="p" href="ch07.zh-cn.html"><img src="images/prev.png" alt="上一页"/></a> </td>
          <th width="60%" align="center"> </th>
          <td align="right"> <a accesskey="n" href="apa.zh-cn.html"><img src="images/next.png" alt="下一页"/></a></td>
        </tr>
      </table>
      <hr/>
    </div>
    <div class="chapter">
      <div class="titlepage">
        <div>
          <div>
            <h1 class="title"><a id="more"/>第 8 章 更多示例</h1>
          </div>
        </div>
      </div>
      <div class="toc">
        <p>
          <strong>目录</strong>
        </p>
        <dl class="toc">
          <dt>
            <span class="section">
              <a href="ch08.zh-cn.html#emptypkg">8.1. 挑选最好的模板</a>
            </span>
          </dt>
          <dt>
            <span class="section">
              <a href="ch08.zh-cn.html#nomakefile">8.2. 无 Makefile（shell，命令行界面）</a>
            </span>
          </dt>
          <dt>
            <span class="section">
              <a href="ch08.zh-cn.html#makefile-sh">8.3. Makefile（shell，命令行界面）</a>
            </span>
          </dt>
          <dt>
            <span class="section">
              <a href="ch08.zh-cn.html#setup-py">8.4. setup.py（Python3，命令行界面）</a>
            </span>
          </dt>
          <dt>
            <span class="section">
              <a href="ch08.zh-cn.html#makefile-sh-gui">8.5. Makefile（shell，图形界面）</a>
            </span>
          </dt>
          <dt>
            <span class="section">
              <a href="ch08.zh-cn.html#setup-py-gui">8.6. setup.py（Python3，图形界面）</a>
            </span>
          </dt>
          <dt>
            <span class="section">
              <a href="ch08.zh-cn.html#makefile-single">8.7. Makefile（单个二进制软件包）</a>
            </span>
          </dt>
          <dt>
            <span class="section">
              <a href="ch08.zh-cn.html#configure-single">8.8. Makefile.in + configure（单个二进制软件包）</a>
            </span>
          </dt>
          <dt>
            <span class="section">
              <a href="ch08.zh-cn.html#autotools-single">8.9. Autotools（单个二进制文件）</a>
            </span>
          </dt>
          <dt>
            <span class="section">
              <a href="ch08.zh-cn.html#cmake-single">8.10. CMake（单个二进制软件包）</a>
            </span>
          </dt>
          <dt>
            <span class="section">
              <a href="ch08.zh-cn.html#autotools-multi">8.11. Autotools（多个二进制软件包）</a>
            </span>
          </dt>
          <dt>
            <span class="section">
              <a href="ch08.zh-cn.html#cmake-multi">8.12. CMake（多个二进制软件包）</a>
            </span>
          </dt>
          <dt>
            <span class="section">
              <a href="ch08.zh-cn.html#i18n-example">8.13. 国际化</a>
            </span>
          </dt>
          <dt>
            <span class="section">
              <a href="ch08.zh-cn.html#details">8.14. 细节</a>
            </span>
          </dt>
        </dl>
      </div>
      <p>有一句古老的拉丁谚语：“<span class="strong"><strong>fabricando fit faber</strong></span>”（“熟能生巧”）。</p>
      <p>强烈建议使用简单的包来练习和试验 Debian 打包的所有步骤。本章为您的练习提供了许多上游案例。</p>
      <p>这也可以作为许多编程主题的介绍性示例。</p>
      <div class="itemizedlist">
        <ul class="itemizedlist">
          <li class="listitem">在 POSIX shell，Python3 和 C 中编程。</li>
          <li class="listitem">使用图标图形创建桌面 GUI 程序启动器的方法。</li>
          <li class="listitem">将 <a class="ulink" href="https://en.wikipedia.org/wiki/Command-line_interface">命令行界面</a> 命令转换为 <a class="ulink" href="https://en.wikipedia.org/wiki/Graphical_user_interface">图形界面</a> 命令。</li>
          <li class="listitem">转化程序以使用 <span class="strong"><strong>gettext</strong></span> 来为 POSIX shell、Python3 和 C 源码的程序进行 <a class="ulink" href="http://en.wikipedia.org/wiki/Internationalization_and_localization">国际化和本地化</a>。</li>
          <li class="listitem">构建系统概述：Makefile、Python distutils、Autotools 以及 CMake。</li>
        </ul>
      </div>
      <p>请注意，Debian 对以下事项非常注意：</p>
      <div class="itemizedlist">
        <ul class="itemizedlist">
          <li class="listitem">自由软件</li>
          <li class="listitem">操作系统的稳定性与安全性</li>
          <li class="listitem">
            <p class="simpara">通过以下方式以实现通用操作系统：</p>
            <div class="itemizedlist">
              <ul class="itemizedlist">
                <li class="listitem">上游源码的自由选择，</li>
                <li class="listitem">CPU架构的自由选择，以及</li>
                <li class="listitem">用户界面语言的自由选择。</li>
              </ul>
            </div>
          </li>
        </ul>
      </div>
      <p>在 <a class="xref" href="ch04.zh-cn.html" title="第 4 章 简单例子">第 4 章 <em>简单例子</em></a> 中介绍的典型打包示例是本章节的先决条件。</p>
      <p>在以下数小节中，有些细节被刻意模糊。请尝试阅读相关文件，并且尝试自行厘清它们。</p>
      <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">
        <table border="0" summary="Tip">
          <tr>
            <td rowspan="2" align="center" valign="top">
              <img alt="[提示]" src="images/tip.png"/>
            </td>
            <th align="left">提示</th>
          </tr>
          <tr>
            <td align="left" valign="top">
              <p>打包示例的最佳来源就是目前的 Debian 归档本身。请使用 “<a class="ulink" href="https://codesearch.debian.net/">Debian 代码搜索</a>” 服务来查找相关示例。</p>
            </td>
          </tr>
        </table>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="emptypkg"/>8.1. 挑选最好的模板</h2>
            </div>
          </div>
        </div>
        <p>以下是一个从空目录由零开始构建简单的 Debian 软件包的示例。</p>
        <p>这是一个很棒的平台，可以使您获得所有的模板文件，而不会使您正在处理的上游源码树变得一团糟。</p>
        <p>让我们假设这个空目录为 <span class="strong"><strong>debhello-0.1</strong></span>。</p>
        <pre class="screen"> $ mkdir debhello-0.1
 $ tree
.
└── debhello-0.1

1 directory, 0 files</pre>
        <p>让我们通过指定 <span class="strong"><strong>-x4</strong></span> 选项来生成最大数量的模板文件。</p>
        <p>此外，让我们使用 “<span class="strong"><strong>-p</strong></span> <span class="emphasis"><em>debhello</em></span> <span class="strong"><strong>-t -u</strong></span> <span class="emphasis"><em>0.1</em></span> <span class="strong"><strong>-r</strong></span> <span class="emphasis"><em>1”</em></span> 选项来制作缺失的上游源码包。</p>
        <pre class="screen"> $ debmake -t -p debhello -u 0.1 -r 1 -x4
I: set parameters
 ...
I: debmake -x "4" ...
I: creating =&gt; debian/control
I: creating =&gt; debian/copyright
I: substituting =&gt; /usr/share/debmake/extra0/rules
 ...
I: creating =&gt; debian/license-examples/LGPL-3.0+
I: substituting =&gt; /usr/share/debmake/extra4/Artistic-1.0
I: creating =&gt; debian/license-examples/Artistic-1.0
I: substituting =&gt; /usr/share/debmake/extra4/GPL-3.0+
I: creating =&gt; debian/license-examples/GPL-3.0+
I: $ wrap-and-sort</pre>
        <p>我们来检查一下自动产生的模板文件。</p>
        <pre class="screen"> $ cd ..
 $ tree
.
├── debhello-0.1
│   └── debian
│       ├── README.Debian
│       ├── changelog
│       ├── clean
│       ├── compat
│       ├── control
│       ├── copyright
│       ├── debhello.bug-control.ex
│       ├── debhello.bug-presubj.ex
│       ├── debhello.bug-script.ex
│       ├── debhello.conffiles.ex
 ...
│       └── watch
├── debhello-0.1.tar.gz
└── debhello_0.1.orig.tar.gz -&gt; debhello-0.1.tar.gz

5 directories, 51 files</pre>
        <p>现在，您可以复制 <span class="emphasis"><em>debhello-0.1/</em></span><span class="strong"><strong>debian/</strong></span> 目录下所有生成的模板文件到您的软件包中。</p>
        <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">
          <table border="0" summary="Tip">
            <tr>
              <td rowspan="2" align="center" valign="top">
                <img alt="[提示]" src="images/tip.png"/>
              </td>
              <th align="left">提示</th>
            </tr>
            <tr>
              <td align="left" valign="top">
                <p>通过使用 <span class="strong"><strong>-T</strong></span> 选项（教程模式）调用 <span class="strong"><strong>debmake</strong></span> 命令，可以使生成的模板文件更加详细。</p>
              </td>
            </tr>
          </table>
        </div>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="nomakefile"/>8.2. 无 Makefile（shell，命令行界面）</h2>
            </div>
          </div>
        </div>
        <p>此处是一个从 POSIX shell 命令行界面程序创建简单的 Debian 软件包的示例，我们假设它没有使用任何构建系统。</p>
        <p>让我们假设上游的源码包为 <span class="strong"><strong>debhello-0.2.tar.gz</strong></span>。</p>
        <p>此类源码不具有自动化方法，所以必须手动安装文件。</p>
        <pre class="screen"> $ tar -xzmf debhello-0.2.tar.gz
 $ cd debhello-0.2
 $ sudo cp scripts/hello /bin/hello
 ...</pre>
        <p>让我们取得源码并制作 Debian 软件包。</p>
        <p><strong>下载 <span class="strong"><strong>debhello-0.2.tar.gz</strong></span>. </strong>
</p>
        <pre class="screen"> $ wget http://www.example.org/download/debhello-0.2.tar.gz
 ...
 $ tar -xzmf debhello-0.2.tar.gz
 $ tree
.
├── debhello-0.2
│   ├── LICENSE
│   ├── data
│   │   ├── hello.desktop
│   │   └── hello.png
│   ├── man
│   │   └── hello.1
│   └── scripts
│       └── hello
└── debhello-0.2.tar.gz

4 directories, 6 files</pre>
        <p>
</p>
        <p>这里的 POSIX shell 脚本 <span class="strong"><strong>hello</strong></span> 非常的简单。</p>
        <p><strong><span class="strong"><strong>hello</strong></span>（v=0.2）. </strong>
</p>
        <pre class="screen"> $ cat debhello-0.2/scripts/hello
#!/bin/sh -e
echo "Hello from the shell!"
echo ""
echo -n "Type Enter to exit this program: "
read X</pre>
        <p>
</p>
        <p>此处的 <span class="strong"><strong>hello.desktop</strong></span> 支持 <a class="ulink" href="https://www.freedesktop.org/wiki/Specifications/desktop-entry-spec/">桌面项（Desktop Entry）规范</a>。</p>
        <p><strong><span class="strong"><strong>hello.desktop</strong></span>（v=0.2）. </strong>
</p>
        <pre class="screen"> $ cat debhello-0.2/data/hello.desktop
[Desktop Entry]
Name=Hello
Name[fr]=Bonjour
Comment=Greetings
Comment[fr]=Salutations
Type=Application
Keywords=hello
Exec=hello
Terminal=true
Icon=hello.png
Categories=Utility;</pre>
        <p>
</p>
        <p>此处的 <span class="strong"><strong>hello.png</strong></span> 是图标的图像文件。</p>
        <p>让我们使用 <span class="strong"><strong>debmake</strong></span> 命令来打包。这里使用 <span class="strong"><strong>-b':sh'</strong></span> 选项来指明生成的二进制包是一个 shell 脚本。</p>
        <pre class="screen"> $ cd debhello-0.2
 $ debmake -b':sh'
I: set parameters
I: sanity check of parameters
I: pkg="debhello", ver="0.2", rev="1"
I: *** start packaging in "debhello-0.2". ***
I: provide debhello_0.2.orig.tar.gz for non-native Debian package
I: pwd = "/path/to"
I: $ ln -sf debhello-0.2.tar.gz debhello_0.2.orig.tar.gz
I: pwd = "/path/to/debhello-0.2"
I: parse binary package settings: :sh
I: binary package=debhello Type=script / Arch=all M-A=foreign
...</pre>
        <p>让我们来检查一下自动产生的模板文件。</p>
        <p><strong>执行基本的 <span class="strong"><strong>debmake</strong></span> 命令后的源码树。（v=0.2）. </strong>
</p>
        <pre class="screen"> $ cd ..
 $ tree
.
├── debhello-0.2
│   ├── LICENSE
│   ├── data
│   │   ├── hello.desktop
│   │   └── hello.png
│   ├── debian
│   │   ├── README.Debian
│   │   ├── changelog
│   │   ├── compat
│   │   ├── control
│   │   ├── copyright
│   │   ├── patches
│   │   │   └── series
│   │   ├── rules
│   │   ├── source
│   │   │   ├── format
│   │   │   └── local-options
│   │   └── watch
│   ├── man
│   │   └── hello.1
│   └── scripts
│       └── hello
├── debhello-0.2.tar.gz
└── debhello_0.2.orig.tar.gz -&gt; debhello-0.2.tar.gz

7 directories, 17 files</pre>
        <p>
</p>
        <p><strong><span class="strong"><strong>debian/rules</strong></span>（模板文件，v=0.2）：. </strong>
</p>
        <pre class="screen"> $ cat debhello-0.2/debian/rules
#!/usr/bin/make -f
# You must remove unused comment lines for the released package.
#export DH_VERBOSE = 1

%:
        dh $@</pre>
        <p>
</p>
        <p>这基本上是带有 <span class="strong"><strong>dh</strong></span> 命令的标准 <span class="strong"><strong>debian/rules</strong></span> 文件。因为这是个脚本软件包，所以这个 <span class="strong"><strong>debian/rules</strong></span> 模板文件没有与构建标记（build flag）相关的内容。</p>
        <p><strong><span class="strong"><strong>debian/control</strong></span>（模板文件，v=0.2）：. </strong>
</p>
        <pre class="screen"> $ cat debhello-0.2/debian/control
Source: debhello
Section: unknown
Priority: optional
Maintainer: "Firstname Lastname" &lt;email.address@example.org&gt;
Build-Depends: debhelper (&gt;=11~)
Standards-Version: 4.1.4
Homepage: &lt;insert the upstream URL, if relevant&gt;

Package: debhello
Architecture: all
Multi-Arch: foreign
Depends: ${misc:Depends}
Description: auto-generated package by debmake
 This Debian binary package was auto-generated by the
 debmake(1) command provided by the debmake package.</pre>
        <p>
</p>
        <p>因为这是个 shell 脚本包，所以 <span class="strong"><strong>debmake</strong></span> 命令设置了“<span class="strong"><strong>Architecture: all</strong></span>”和“<span class="strong"><strong>Multi-Arch: foreign</strong></span>”。此外，它还将所需的 <span class="strong"><strong>substvar</strong></span> 参数设置为“<span class="strong"><strong>Depends: ${misc:Depends}</strong></span>”。<a class="xref" href="ch05.zh-cn.html" title="第 5 章 基本内容">第 5 章 <em>基本内容</em></a> 对此进行了解释。</p>
        <p>因为这个上游源码缺少上游的 <span class="strong"><strong>Makefile</strong></span>，所以这个功能需要由维护者提供。这个上游源码仅包含脚本文件和数据文件，没有 C 的源码文件，因此 <span class="strong"><strong>构建（build）</strong></span> 的过程可以被跳过，但是需要实现 <span class="strong"><strong>安装（install）</strong></span> 的过程。对于这种情况，通过添加 <span class="strong"><strong>debian/install</strong></span> 和 <span class="strong"><strong>debian/manpages</strong></span> 文件可以很好地实现这一功能，且不会使 <span class="strong"><strong>debian/rules</strong></span> 文件变得复杂。</p>
        <p>作为维护者，我们要把这个 Debian 软件包做得更好。</p>
        <p><strong><span class="strong"><strong>debian/rules</strong></span>（维护者版本，v=0.2）：. </strong>
</p>
        <pre class="screen"> $ vim debhello-0.2/debian/rules
 ... hack, hack, hack, ...
 $ cat debhello-0.2/debian/rules
#!/usr/bin/make -f
export DH_VERBOSE = 1

%:
        dh $@</pre>
        <p>
</p>
        <p><strong><span class="strong"><strong>debian/control</strong></span>（维护者版本，v=0.2）：. </strong>
</p>
        <pre class="screen"> $ vim debhello-0.2/debian/control
 ... hack, hack, hack, ...
 $ cat debhello-0.2/debian/control
Source: debhello
Section: devel
Priority: optional
Maintainer: Osamu Aoki &lt;osamu@debian.org&gt;
Build-Depends: debhelper (&gt;=11~)
Standards-Version: 4.3.0
Homepage: https://salsa.debian.org/debian/debmake-doc

Package: debhello
Architecture: all
Multi-Arch: foreign
Depends: ${misc:Depends}
Description: example package in the debmake-doc package
 This is an example package to demonstrate Debian packaging using
 the debmake command.
 .
 The generated Debian package uses the dh command offered by the
 debhelper package and the dpkg source format `3.0 (quilt)'.</pre>
        <p>
</p>
        <div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
          <table border="0" summary="Warning">
            <tr>
              <td rowspan="2" align="center" valign="top">
                <img alt="[警告]" src="images/warning.png"/>
              </td>
              <th align="left">警告</th>
            </tr>
            <tr>
              <td align="left" valign="top">
                <p>如果您对 <span class="strong"><strong>debian/control</strong></span> 模板文件中的“<span class="strong"><strong>Section: unknown</strong></span>”部分不作修改的话，后续的 <span class="strong"><strong>lintian</strong></span> 错误可能导致构建失败。</p>
              </td>
            </tr>
          </table>
        </div>
        <p><strong><span class="strong"><strong>debian/install</strong></span>（维护者版本，v=0.2）：. </strong>
</p>
        <pre class="screen"> $ vim debhello-0.2/debian/install
 ... hack, hack, hack, ...
 $ cat debhello-0.2/debian/install
data/hello.desktop usr/share/applications
data/hello.png usr/share/pixmaps
scripts/hello usr/bin</pre>
        <p>
</p>
        <p><strong><span class="strong"><strong>debian/manpages</strong></span>（维护者版本，v=0.2）：. </strong>
</p>
        <pre class="screen"> $ vim debhello-0.2/debian/manpages
 ... hack, hack, hack, ...
 $ cat debhello-0.2/debian/manpages
man/hello.1</pre>
        <p>
</p>
        <p>在 <span class="strong"><strong>debian/</strong></span> 目录下还有一些其它的模板文件。它们也需要进行更新。</p>
        <p><strong><span class="strong"><strong>debian/</strong></span> 目录下的模板文件。（v=0.2）：. </strong>
</p>
        <pre class="screen"> $ tree debhello-0.2/debian
debhello-0.2/debian
├── README.Debian
├── changelog
├── compat
├── control
├── copyright
├── install
├── manpages
├── patches
│   └── series
├── rules
├── source
│   ├── format
│   └── local-options
└── watch

2 directories, 12 files</pre>
        <p>
</p>
        <p>您可以在此源代码树中使用 <span class="strong"><strong>debuild</strong></span> 命令（或其等效命令）创建非原生的 Debian 软件包。如下所示，该命令的输出非常详细，并且解释了它所做的事。</p>
        <pre class="screen"> $ cd debhello-0.2
 $ debuild
 dpkg-buildpackage -us -uc -ui -i
 ...
 fakeroot debian/rules clean
dh clean
 ...
 debian/rules build
dh build
   dh_update_autotools_config
   dh_autoreconf
   create-stamp debian/debhelper-build-stamp
 fakeroot debian/rules binary
dh binary
   dh_testroot
   dh_prep
        rm -f -- debian/debhello.substvars
        rm -fr -- debian/.debhelper/generated/debhello/ debian/debhello/ debi...
 ...
 fakeroot debian/rules binary
dh binary
 ...</pre>
        <p>现在我们来看看成果如何。</p>
        <p><strong>通过 <span class="strong"><strong>debuild</strong></span> 生成的第 <span class="strong"><strong>0.2</strong></span> 版的 <span class="strong"><strong>debhello</strong></span> 文件：. </strong>
</p>
        <pre class="screen"> $ cd ..
 $ tree -FL 1
.
├── debhello-0.2/
├── debhello-0.2.tar.gz
├── debhello_0.2-1.debian.tar.xz
├── debhello_0.2-1.dsc
├── debhello_0.2-1_all.deb
├── debhello_0.2-1_amd64.build
├── debhello_0.2-1_amd64.buildinfo
├── debhello_0.2-1_amd64.changes
└── debhello_0.2.orig.tar.gz -&gt; debhello-0.2.tar.gz

1 directory, 8 files</pre>
        <p>
</p>
        <p>您可以看见生成的全部文件。</p>
        <div class="itemizedlist">
          <ul class="itemizedlist">
            <li class="listitem"><span class="strong"><strong>debhello_0.2.orig.tar.gz</strong></span> 是指向上游源码包的符号链接。</li>
            <li class="listitem"><span class="strong"><strong>debhello_0.2-1.debian.tar.xz</strong></span> 包含了维护者生成的内容。</li>
            <li class="listitem"><span class="strong"><strong>debhello_0.2-1.dsc</strong></span> 是 Debian 源码包的元数据文件。</li>
            <li class="listitem">The <span class="strong"><strong>debhello_0.2-1_all.deb</strong></span> 是 Debian 二进制软件包。</li>
            <li class="listitem"><span class="strong"><strong>debhello_0.2-1_amd64.build</strong></span> 是 Debian 二进制软件包。</li>
            <li class="listitem"><span class="strong"><strong>debhello_0.2-1_amd64.buildinfo</strong></span> 文件是由 <span class="strong"><strong>dpkg-genbuildinfo</strong></span>(1) 自动生成的元文件。</li>
            <li class="listitem"><span class="strong"><strong>debhello_0.2-1_amd64.changes</strong></span> 是 Debian 二进制软件包的元数据文件。</li>
          </ul>
        </div>
        <p><span class="strong"><strong>debhello_0.2-1.debian.tar.xz</strong></span> 包含了 Debian 对上游源代码的修改，具体如下所示。</p>
        <p><strong>压缩过的归档文件 <span class="strong"><strong>debhello_0.2-1.debian.tar.xz</strong></span> 中的内容物：. </strong>
</p>
        <pre class="screen"> $ tar -tzf debhello-0.2.tar.gz
debhello-0.2/
debhello-0.2/scripts/
debhello-0.2/scripts/hello
debhello-0.2/data/
debhello-0.2/data/hello.desktop
debhello-0.2/data/hello.png
debhello-0.2/LICENSE
debhello-0.2/man/
debhello-0.2/man/hello.1
 $ tar --xz -tf debhello_0.2-1.debian.tar.xz
debian/
debian/README.Debian
debian/changelog
debian/compat
debian/control
debian/copyright
debian/install
debian/manpages
debian/patches/
debian/patches/series
debian/rules
debian/source/
debian/source/format
debian/watch</pre>
        <p>
</p>
        <p><span class="strong"><strong>debhello_0.2-1_amd64.deb</strong></span> 包含了将要安装至系统中的文件，如下所示。</p>
        <p><strong><span class="strong"><strong>debhello_0.2-1_all.deb</strong></span> 二进制软件包中的内容：. </strong>
</p>
        <pre class="screen"> $ dpkg -c debhello_0.2-1_all.deb
drwxr-xr-x root/root ...  ./
drwxr-xr-x root/root ...  ./usr/
drwxr-xr-x root/root ...  ./usr/bin/
-rwxr-xr-x root/root ...  ./usr/bin/hello
drwxr-xr-x root/root ...  ./usr/share/
drwxr-xr-x root/root ...  ./usr/share/applications/
-rw-r--r-- root/root ...  ./usr/share/applications/hello.desktop
drwxr-xr-x root/root ...  ./usr/share/doc/
drwxr-xr-x root/root ...  ./usr/share/doc/debhello/
-rw-r--r-- root/root ...  ./usr/share/doc/debhello/README.Debian
-rw-r--r-- root/root ...  ./usr/share/doc/debhello/changelog.Debian.gz
-rw-r--r-- root/root ...  ./usr/share/doc/debhello/copyright
drwxr-xr-x root/root ...  ./usr/share/man/
drwxr-xr-x root/root ...  ./usr/share/man/man1/
-rw-r--r-- root/root ...  ./usr/share/man/man1/hello.1.gz
drwxr-xr-x root/root ...  ./usr/share/pixmaps/
-rw-r--r-- root/root ...  ./usr/share/pixmaps/hello.png</pre>
        <p>
</p>
        <p>此处是生成的 <span class="strong"><strong>debhello_0.2-1_all.deb</strong></span> 的依赖项列表。</p>
        <p><strong><span class="strong"><strong>debhello_0.2-1_all.deb</strong></span> 的依赖项列表：. </strong>
</p>
        <pre class="screen"> $ dpkg -f debhello_0.2-1_all.deb pre-depends depends recommends conflicts br...</pre>
        <p>
</p>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="makefile-sh"/>8.3. Makefile（shell，命令行界面）</h2>
            </div>
          </div>
        </div>
        <p>下面是从 POSIX shell 命令行界面程序创建简单的 Debian 软件包的示例，我们假设它使用 <span class="strong"><strong>Makefile</strong></span> 作为构建系统。</p>
        <p>让我们假设上游的源码包为 <span class="strong"><strong>debhello-1.0.tar.gz</strong></span>。</p>
        <p>这一类源代码设计可以用这样的方式安装成为非系统文件：</p>
        <pre class="screen"> $ tar -xzmf debhello-1.0.tar.gz
 $ cd debhello-1.0
 $ make install</pre>
        <p>Debian 的打包需要对“<span class="strong"><strong>make install</strong></span>”流程进行改变，从而将文件安装至目标系统镜像所在位置，而非通常使用的 <span class="strong"><strong>/usr/local</strong></span> 下的位置。</p>
        <p>让我们取得源码并制作 Debian 软件包。</p>
        <p><strong>下载 <span class="strong"><strong>debhello-1.0.tar.gz</strong></span>. </strong>
</p>
        <pre class="screen"> $ wget http://www.example.org/download/debhello-1.0.tar.gz
 ...
 $ tar -xzmf debhello-1.0.tar.gz
 $ tree
.
├── debhello-1.0
│   ├── LICENSE
│   ├── Makefile
│   ├── data
│   │   ├── hello.desktop
│   │   └── hello.png
│   ├── man
│   │   └── hello.1
│   └── scripts
│       └── hello
└── debhello-1.0.tar.gz

4 directories, 7 files</pre>
        <p>
</p>
        <p>这里的 <span class="strong"><strong>Makefile</strong></span> 正确使用 <span class="strong"><strong>$(DESTDIR)</strong></span> 和 <span class="strong"><strong>$(prefix)</strong></span>。其他的所有文件都和 <a class="xref" href="ch08.zh-cn.html#nomakefile" title="8.2. 无 Makefile（shell，命令行界面）">第 8.2 节 “无 Makefile（shell，命令行界面）”</a> 中的一样，并且大多数的打包工作也都一样。</p>
        <p><strong><span class="strong"><strong>Makefile</strong></span>（v=1.0）. </strong>
</p>
        <pre class="screen"> $ cat debhello-1.0/Makefile
prefix = /usr/local

all:
        : # do nothing

install:
        install -D scripts/hello \
                $(DESTDIR)$(prefix)/bin/hello
        install -m 644 -D data/hello.desktop \
                $(DESTDIR)$(prefix)/share/applications/hello.desktop
        install -m 644 -D data/hello.png \
                $(DESTDIR)$(prefix)/share/pixmaps/hello.png
        install -m 644 -D man/hello.1 \
                $(DESTDIR)$(prefix)/share/man/man1/hello.1

clean:
        : # do nothing

distclean: clean

uninstall:
        -rm -f $(DESTDIR)$(prefix)/bin/hello
        -rm -f $(DESTDIR)$(prefix)/share/applications/hello.desktop
        -rm -f $(DESTDIR)$(prefix)/share/pixmaps/hello.png
        -rm -f $(DESTDIR)$(prefix)/share/man/man1/hello.1

.PHONY: all install clean distclean uninstall</pre>
        <p>
</p>
        <p>让我们使用 <span class="strong"><strong>debmake</strong></span> 命令来打包。这里使用 <span class="strong"><strong>-b':sh'</strong></span> 选项来指明生成的二进制包是一个 shell 脚本。</p>
        <pre class="screen"> $ cd debhello-1.0
 $ debmake -b':sh'
I: set parameters
I: sanity check of parameters
I: pkg="debhello", ver="1.0", rev="1"
I: *** start packaging in "debhello-1.0". ***
I: provide debhello_1.0.orig.tar.gz for non-native Debian package
I: pwd = "/path/to"
I: $ ln -sf debhello-1.0.tar.gz debhello_1.0.orig.tar.gz
I: pwd = "/path/to/debhello-1.0"
I: parse binary package settings: :sh
I: binary package=debhello Type=script / Arch=all M-A=foreign
...</pre>
        <p>让我们来检查一下自动产生的模板文件。</p>
        <p><strong><span class="strong"><strong>debian/rules</strong></span>（模板文件，v=1.0）：. </strong>
</p>
        <pre class="screen"> $ cat debhello-1.0/debian/rules
#!/usr/bin/make -f
# You must remove unused comment lines for the released package.
#export DH_VERBOSE = 1

%:
        dh $@

#override_dh_auto_install:
#       dh_auto_install -- prefix=/usr

#override_dh_install:
#       dh_install --list-missing -X.pyc -X.pyo</pre>
        <p>
</p>
        <p>作为维护者，我们要把这个 Debian 软件包做得更好。</p>
        <p><strong><span class="strong"><strong>debian/rules</strong></span>（维护者版本，v=1.0）：. </strong>
</p>
        <pre class="screen"> $ vim debhello-1.0/debian/rules
 ... hack, hack, hack, ...
 $ cat debhello-1.0/debian/rules
#!/usr/bin/make -f
export DH_VERBOSE = 1

%:
        dh $@

override_dh_auto_install:
        dh_auto_install -- prefix=/usr</pre>
        <p>
</p>
        <p>因为上游源码含有正确的上游 <span class="strong"><strong>Makefile</strong></span> 文件，所以没有必要再去创建 <span class="strong"><strong>debian/install</strong></span> 和 <span class="strong"><strong>debian/manpages</strong></span> 文件。</p>
        <p><span class="strong"><strong>debian/control</strong></span> 文件和 <a class="xref" href="ch08.zh-cn.html#nomakefile" title="8.2. 无 Makefile（shell，命令行界面）">第 8.2 节 “无 Makefile（shell，命令行界面）”</a> 中的完全一致。</p>
        <p>在 <span class="strong"><strong>debian/</strong></span> 目录下还有一些其它的模板文件。它们也需要进行更新。</p>
        <p><strong><span class="strong"><strong>debian/</strong></span> 目录下的模板文件。（v=1.0）：. </strong>
</p>
        <pre class="screen"> $ tree debhello-1.0/debian
debhello-1.0/debian
├── README.Debian
├── changelog
├── compat
├── control
├── copyright
├── patches
│   └── series
├── rules
├── source
│   ├── format
│   └── local-options
└── watch

2 directories, 10 files</pre>
        <p>
</p>
        <p>其余的打包操作基本上和 <a class="xref" href="ch08.zh-cn.html#nomakefile" title="8.2. 无 Makefile（shell，命令行界面）">第 8.2 节 “无 Makefile（shell，命令行界面）”</a> 中的相同。</p>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="setup-py"/>8.4. setup.py（Python3，命令行界面）</h2>
            </div>
          </div>
        </div>
        <p>此处是一个从 Python3 命令行界面程序创建简单的 Debian 软件包的示例，我们假设程序使用 <span class="strong"><strong>setup.py</strong></span> 作为它的构建系统。</p>
        <p>让我们假设上游的源码包为 <span class="strong"><strong>debhello-1.1.tar.gz</strong></span>。</p>
        <p>这一类源代码设计可以用这样的方式安装成为非系统文件：</p>
        <pre class="screen"> $ tar -xzmf debhello-1.1.tar.gz
 $ cd debhello-1.1
 $ python3 setup.py install</pre>
        <p>Debian 打包要求将最后一行更改为 “<span class="strong"><strong>python3 setup.py install --install-layout=deb</strong></span>” 以将文件安装到目标系统镜像所在位置。使用 <span class="strong"><strong>dh</strong></span> 命令进行 Debian 打包时会自动解决此问题。</p>
        <p>让我们取得源码并制作 Debian 软件包。</p>
        <p><strong>下载 <span class="strong"><strong>debhello-1.1.tar.gz</strong></span>. </strong>
</p>
        <pre class="screen"> $ wget http://www.example.org/download/debhello-1.1.tar.gz
 ...
 $ tar -xzmf debhello-1.1.tar.gz
 $ tree
.
├── debhello-1.1
│   ├── LICENSE
│   ├── MANIFEST.in
│   ├── PKG-INFO
│   ├── hello_py
│   │   └── __init__.py
│   ├── scripts
│   │   └── hello
│   └── setup.py
└── debhello-1.1.tar.gz

3 directories, 7 files</pre>
        <p>
</p>
        <p>此处的 <span class="strong"><strong>hello</strong></span> 脚本和它所关联的 <span class="strong"><strong>hello_py</strong></span> 模块如下所示。</p>
        <p><strong><span class="strong"><strong>hello</strong></span>（v=1.1）. </strong>
</p>
        <pre class="screen"> $ cat debhello-1.1/scripts/hello
#!/usr/bin/python3
import hello_py

if __name__ == '__main__':
    hello_py.main()</pre>
        <p>
</p>
        <p><strong><span class="strong"><strong>hello_py/__init__.py</strong></span>（v=1.1）. </strong>
</p>
        <pre class="screen"> $ cat debhello-1.1/hello_py/__init__.py
#!/usr/bin/python3
def main():
    print('Hello Python3!')
    input("Press Enter to continue...")
    return

if __name__ == '__main__':
    main()</pre>
        <p>
</p>
        <p>这些是使用带有 <span class="strong"><strong>setup.py</strong></span> 和 <span class="strong"><strong>MANIFEST.in</strong></span> 文件的 Python <a class="ulink" href="https://docs.python.org/3.4/library/distutils.html#module-distutils">distutils</a> 来打包的。</p>
        <p><strong><span class="strong"><strong>setup.py</strong></span>（v=1.1）. </strong>
</p>
        <pre class="screen"> $ cat debhello-1.1/setup.py
#!/usr/bin/python3
# vi:se ts=4 sts=4 et ai:
from distutils.core import setup

setup(name='debhello',
    version='4.0',
    description='Hello Python',
    long_description='Hello Python program.',
    author='Osamu Aoki',
    author_email='osamu@debian.org',
    url='http://people.debian.org/~osamu/',
    packages=['hello_py'],
    package_dir={'hello_py': 'hello_py'},
    scripts=['scripts/hello'],
    classifiers = ['Development Status :: 3 - Alpha',
        'Environment :: Console',
        'Intended Audience :: Developers',
        'License :: OSI Approved :: MIT License',
        'Natural Language :: English',
        'Operating System :: POSIX :: Linux',
        'Programming Language :: Python :: 3',
        'Topic :: Utilities',
    ],
    platforms   = 'POSIX',
    license     = 'MIT License'
)</pre>
        <p>
</p>
        <p><strong><span class="strong"><strong>MANIFEST.in</strong></span>（v=1.1）. </strong>
</p>
        <pre class="screen"> $ cat debhello-1.1/MANIFEST.in
include MANIFEST.in
include LICENSE</pre>
        <p>
</p>
        <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">
          <table border="0" summary="Tip">
            <tr>
              <td rowspan="2" align="center" valign="top">
                <img alt="[提示]" src="images/tip.png"/>
              </td>
              <th align="left">提示</th>
            </tr>
            <tr>
              <td align="left" valign="top">
                <p>许多现代的 Python 软件包使用 <a class="ulink" href="https://setuptools.pypa.io/en/latest/setuptools.html">setuptools</a> 来分发。因为 setuptools 是 disutils 的增强替代品，因此该示例对它们也很有用。</p>
              </td>
            </tr>
          </table>
        </div>
        <p>让我们使用 <span class="strong"><strong>debmake</strong></span> 命令来打包。这里使用 <span class="strong"><strong>-b':py3'</strong></span> 选项来指明生成的二进制包包含 Python3 脚本和模块文件。</p>
        <pre class="screen"> $ cd debhello-1.1
 $ debmake -b':py3'
I: set parameters
I: sanity check of parameters
I: pkg="debhello", ver="1.1", rev="1"
I: *** start packaging in "debhello-1.1". ***
I: provide debhello_1.1.orig.tar.gz for non-native Debian package
I: pwd = "/path/to"
I: $ ln -sf debhello-1.1.tar.gz debhello_1.1.orig.tar.gz
I: pwd = "/path/to/debhello-1.1"
I: parse binary package settings: :py3
I: binary package=debhello Type=python3 / Arch=all M-A=foreign
...</pre>
        <p>让我们来检查一下自动产生的模板文件。</p>
        <p><strong><span class="strong"><strong>debian/rules</strong></span>（模板文件，v=1.1）：. </strong>
</p>
        <pre class="screen"> $ cat debhello-1.1/debian/rules
#!/usr/bin/make -f
# You must remove unused comment lines for the released package.
#export DH_VERBOSE = 1

%:
        dh $@ --with python3 --buildsystem=pybuild</pre>
        <p>
</p>
        <p>这基本上是带有 <span class="strong"><strong>dh</strong></span> 命令的标准 <span class="strong"><strong>debian/rules</strong></span> 文件。</p>
        <p>使用“<span class="strong"><strong>--with python3</strong></span>”选项会调用 <span class="strong"><strong>dh_python3</strong></span> 来计算 Python 依赖项、将维护者脚本添加到字节码文件等。参见 <span class="strong"><strong>dh_python3</strong></span>(1)。</p>
        <p>使用“<span class="strong"><strong>--buildsystem=pybuild</strong></span>”选项会为要求的 Python 版本调用各种构建系统，以便构建模块和扩展。参见 <span class="strong"><strong>pybuild</strong></span>(1)。</p>
        <p><strong><span class="strong"><strong>debian/control</strong></span>（模板文件，v=1.1）：. </strong>
</p>
        <pre class="screen"> $ cat debhello-1.1/debian/control
Source: debhello
Section: unknown
Priority: optional
Maintainer: "Firstname Lastname" &lt;email.address@example.org&gt;
Build-Depends: debhelper (&gt;=11~), dh-python, python3-all
Standards-Version: 4.1.4
Homepage: &lt;insert the upstream URL, if relevant&gt;
X-Python3-Version: &gt;= 3.2

Package: debhello
Architecture: all
Multi-Arch: foreign
Depends: ${misc:Depends}, ${python3:Depends}
Description: auto-generated package by debmake
 This Debian binary package was auto-generated by the
 debmake(1) command provided by the debmake package.</pre>
        <p>
</p>
        <p>因为这是 Python3 软件包，<span class="strong"><strong>debmake</strong></span> 命令会设置“<span class="strong"><strong>Architecture: all</strong></span>”和“<span class="strong"><strong>Multi-Arch: foreign</strong></span>”。此外，它还将所需的 <span class="strong"><strong>substvar</strong></span> 参数设置为“<span class="strong"><strong>Depends: ${python3:Depends}, ${misc:Depends}</strong></span>”。<a class="xref" href="ch05.zh-cn.html" title="第 5 章 基本内容">第 5 章 <em>基本内容</em></a> 对这些做出了解释。</p>
        <p>作为维护者，我们要把这个 Debian 软件包做得更好。</p>
        <p><strong><span class="strong"><strong>debian/rules</strong></span>（维护者版本，v=1.1）：. </strong>
</p>
        <pre class="screen"> $ vim debhello-1.1/debian/rules
 ... hack, hack, hack, ...
 $ cat debhello-1.1/debian/rules
#!/usr/bin/make -f
export DH_VERBOSE = 1

%:
        dh $@ --with python3 --buildsystem=pybuild</pre>
        <p>
</p>
        <p><strong><span class="strong"><strong>debian/control</strong></span>（维护者版本，v=1.1）：. </strong>
</p>
        <pre class="screen"> $ vim debhello-1.1/debian/control
 ... hack, hack, hack, ...
 $ cat debhello-1.1/debian/control
Source: debhello
Section: devel
Priority: optional
Maintainer: Osamu Aoki &lt;osamu@debian.org&gt;
Build-Depends: debhelper (&gt;= 12~), dh-python, python3-all
Standards-Version: 4.3.0
Homepage: https://salsa.debian.org/debian/debmake-doc
X-Python3-Version: &gt;= 3.2

Package: debhello
Architecture: all
Multi-Arch: foreign
Depends: ${misc:Depends}, ${python3:Depends}
Description: example package in the debmake-doc package
 This is an example package to demonstrate Debian packaging using
 the debmake command.
 .
 The generated Debian package uses the dh command offered by the
 debhelper package and the dpkg source format `3.0 (quilt)'.</pre>
        <p>
</p>
        <p><span class="strong"><strong>hello</strong></span> 命令没有附带上游提供的手册页。让我们这些维护者给它添上。</p>
        <p><strong><span class="strong"><strong>debian/manpages</strong></span> 等。（维护者版本，v=1.1）：. </strong>
</p>
        <pre class="screen"> $ vim debhello-1.1/debian/hello.1
 ... hack, hack, hack, ...
 $ vim debhello-1.1/debian/manpages
 ... hack, hack, hack, ...
 $ cat debhello-1.1/debian/manpages
debian/hello.1</pre>
        <p>
</p>
        <p>在 <span class="strong"><strong>debian/</strong></span> 目录下还有一些其它的模板文件。它们也需要进行更新。</p>
        <p>其余的打包工作与 <a class="xref" href="ch08.zh-cn.html#makefile-sh" title="8.3. Makefile（shell，命令行界面）">第 8.3 节 “Makefile（shell，命令行界面）”</a> 中的几乎一致。</p>
        <p><strong><span class="strong"><strong>debian/</strong></span> 目录下的模板文件。（v=1.1）：. </strong>
</p>
        <pre class="screen"> $ tree debhello-1.1/debian
debhello-1.1/debian
├── README.Debian
├── changelog
├── compat
├── control
├── copyright
├── hello.1
├── manpages
├── patches
│   └── series
├── rules
├── source
│   ├── format
│   └── local-options
└── watch

2 directories, 12 files</pre>
        <p>
</p>
        <p>此处是生成的 <span class="strong"><strong>debhello_1.1-1_all.deb</strong></span> 包的依赖项列表。</p>
        <p><strong><span class="strong"><strong>debhello_1.1-1_all.deb</strong></span> 的依赖项列表：. </strong>
</p>
        <pre class="screen"> $ dpkg -f debhello_1.1-1_all.deb pre-depends depends recommends conflicts br...
Depends: python3:any (&gt;= 3.2~)</pre>
        <p>
</p>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="makefile-sh-gui"/>8.5. Makefile（shell，图形界面）</h2>
            </div>
          </div>
        </div>
        <p>此处是一个从 POSIX shell 图形界面程序构建简单的 Debian 软件包的示例，我们假设程序使用 <span class="strong"><strong>Makefile</strong></span> 作为构建系统。</p>
        <p>上游是基于 <a class="xref" href="ch08.zh-cn.html#makefile-sh" title="8.3. Makefile（shell，命令行界面）">第 8.3 节 “Makefile（shell，命令行界面）”</a> 中的源代码，并带有增强的图形界面支持。</p>
        <p>让我们假设上游的源码包为 <span class="strong"><strong>debhello-1.2.tar.gz</strong></span>。</p>
        <p>让我们取得源码并制作 Debian 软件包。</p>
        <p><strong>下载 <span class="strong"><strong>debhello-1.2.tar.gz</strong></span>. </strong>
</p>
        <pre class="screen"> $ wget http://www.example.org/download/debhello-1.2.tar.gz
 ...
 $ tar -xzmf debhello-1.2.tar.gz
 $ tree
.
├── debhello-1.2
│   ├── LICENSE
│   ├── Makefile
│   ├── data
│   │   ├── hello.desktop
│   │   └── hello.png
│   ├── man
│   │   └── hello.1
│   └── scripts
│       └── hello
└── debhello-1.2.tar.gz

4 directories, 7 files</pre>
        <p>
</p>
        <p>此处的 <span class="strong"><strong>hello</strong></span> 已经被重写以便使用 <span class="strong"><strong>zenity</strong></span> 命令来使其成为 GTK+ 图形界面程序。</p>
        <p><strong><span class="strong"><strong>hello</strong></span>（v=1.2）. </strong>
</p>
        <pre class="screen"> $ cat debhello-1.2/scripts/hello
#!/bin/sh -e
zenity --info --title "hello" --text "Hello from the shell!"</pre>
        <p>
</p>
        <p>这里，作为图形界面程序，桌面文件被更新为 <span class="strong"><strong>Terminal=false</strong></span>。</p>
        <p><strong><span class="strong"><strong>hello.desktop</strong></span>（v=1.2）. </strong>
</p>
        <pre class="screen"> $ cat debhello-1.2/data/hello.desktop
[Desktop Entry]
Name=Hello
Name[fr]=Bonjour
Comment=Greetings
Comment[fr]=Salutations
Type=Application
Keywords=hello
Exec=hello
Terminal=false
Icon=hello.png
Categories=Utility;</pre>
        <p>
</p>
        <p>其余的所有文件都与 <a class="xref" href="ch08.zh-cn.html#makefile-sh" title="8.3. Makefile（shell，命令行界面）">第 8.3 节 “Makefile（shell，命令行界面）”</a> 中的一致。</p>
        <p>让我们使用 <span class="strong"><strong>debmake</strong></span> 命令来打包。这里使用 <span class="strong"><strong>-b':sh'</strong></span> 选项来指明生成的二进制包是一个 shell 脚本。</p>
        <pre class="screen"> $ cd debhello-1.2
 $ debmake -b':sh'
I: set parameters
I: sanity check of parameters
I: pkg="debhello", ver="1.2", rev="1"
I: *** start packaging in "debhello-1.2". ***
I: provide debhello_1.2.orig.tar.gz for non-native Debian package
I: pwd = "/path/to"
I: $ ln -sf debhello-1.2.tar.gz debhello_1.2.orig.tar.gz
I: pwd = "/path/to/debhello-1.2"
I: parse binary package settings: :sh
I: binary package=debhello Type=script / Arch=all M-A=foreign
...</pre>
        <p>让我们来检查一下自动产生的模板文件。</p>
        <p><strong><span class="strong"><strong>debian/control</strong></span>（模板文件，v=1.2）：. </strong>
</p>
        <pre class="screen"> $ cat debhello-1.2/debian/control
Source: debhello
Section: unknown
Priority: optional
Maintainer: "Firstname Lastname" &lt;email.address@example.org&gt;
Build-Depends: debhelper (&gt;=11~)
Standards-Version: 4.1.4
Homepage: &lt;insert the upstream URL, if relevant&gt;

Package: debhello
Architecture: all
Multi-Arch: foreign
Depends: ${misc:Depends}
Description: auto-generated package by debmake
 This Debian binary package was auto-generated by the
 debmake(1) command provided by the debmake package.</pre>
        <p>
</p>
        <p>作为维护者，我们要把这个 Debian 软件包做得更好。</p>
        <p><strong><span class="strong"><strong>debian/control</strong></span>（维护者版本，v=1.2）：. </strong>
</p>
        <pre class="screen"> $ vim debhello-1.2/debian/control
 ... hack, hack, hack, ...
 $ cat debhello-1.2/debian/control
Source: debhello
Section: devel
Priority: optional
Maintainer: Osamu Aoki &lt;osamu@debian.org&gt;
Build-Depends: debhelper (&gt;=11~)
Standards-Version: 4.3.0
Homepage: https://salsa.debian.org/debian/debmake-doc

Package: debhello
Architecture: all
Multi-Arch: foreign
Depends: zenity, ${misc:Depends}
Description: example package in the debmake-doc package
 This is an example package to demonstrate Debian packaging using
 the debmake command.
 .
 The generated Debian package uses the dh command offered by the
 debhelper package and the dpkg source format `3.0 (quilt)'.</pre>
        <p>
</p>
        <p>请注意，这里需要手动添加 <span class="strong"><strong>zenity</strong></span> 依赖。</p>
        <p><span class="strong"><strong>debian/rules</strong></span> 文件与 <a class="xref" href="ch08.zh-cn.html#makefile-sh" title="8.3. Makefile（shell，命令行界面）">第 8.3 节 “Makefile（shell，命令行界面）”</a> 中的完全一致。</p>
        <p>在 <span class="strong"><strong>debian/</strong></span> 目录下还有一些其它的模板文件。它们也需要进行更新。</p>
        <p><strong><span class="strong"><strong>debian/</strong></span> 目录下的模板文件。（v=1.2）：. </strong>
</p>
        <pre class="screen"> $ tree debhello-1.2/debian
debhello-1.2/debian
├── README.Debian
├── changelog
├── compat
├── control
├── copyright
├── patches
│   └── series
├── rules
├── source
│   ├── format
│   └── local-options
└── watch

2 directories, 10 files</pre>
        <p>
</p>
        <p>其余的打包工作与 <a class="xref" href="ch08.zh-cn.html#makefile-sh" title="8.3. Makefile（shell，命令行界面）">第 8.3 节 “Makefile（shell，命令行界面）”</a> 中的几乎一致。</p>
        <p>此处是 <span class="strong"><strong>debhello_1.2-1_all.deb</strong></span> 的依赖项列表。</p>
        <p><strong><span class="strong"><strong>debhello_1.2-1_all.deb</strong></span> 的依赖项列表：. </strong>
</p>
        <pre class="screen"> $ dpkg -f debhello_1.2-1_all.deb pre-depends depends recommends conflicts br...
Depends: zenity</pre>
        <p>
</p>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="setup-py-gui"/>8.6. setup.py（Python3，图形界面）</h2>
            </div>
          </div>
        </div>
        <p>此处是一个从 Python3 图形界面程序构建简单的 Debian 软件包的示例，我们假设程序使用 <span class="strong"><strong>setup.py</strong></span> 作为自身的构建系统。</p>
        <p>上游是基于 <a class="xref" href="ch08.zh-cn.html#setup-py" title="8.4. setup.py（Python3，命令行界面）">第 8.4 节 “setup.py（Python3，命令行界面）”</a> 中的源代码，并带有增强的图形界面、桌面图标、手册页。</p>
        <p>让我们假设上游源码包为 <span class="strong"><strong>debhello-1.3.tar.gz</strong></span>。</p>
        <p>让我们取得源码并制作 Debian 软件包。</p>
        <p><strong>下载 <span class="strong"><strong>debhello-1.3.tar.gz</strong></span>. </strong>
</p>
        <pre class="screen"> $ wget http://www.example.org/download/debhello-1.3.tar.gz
 ...
 $ tar -xzmf debhello-1.3.tar.gz
 $ tree
.
├── debhello-1.3
│   ├── LICENSE
│   ├── MANIFEST.in
│   ├── PKG-INFO
│   ├── data
│   │   ├── hello.desktop
│   │   └── hello.png
│   ├── hello_py
│   │   └── __init__.py
│   ├── man
│   │   └── hello.1
│   ├── scripts
│   │   └── hello
│   └── setup.py
└── debhello-1.3.tar.gz

5 directories, 10 files</pre>
        <p>
</p>
        <p>以下是上游源码。</p>
        <p><strong><span class="strong"><strong>hello</strong></span>（v=1.3）. </strong>
</p>
        <pre class="screen"> $ cat debhello-1.3/scripts/hello
#!/usr/bin/python3
import hello_py

if __name__ == '__main__':
    hello_py.main()</pre>
        <p>
</p>
        <p><strong><span class="strong"><strong>hello_py/__init__.py</strong></span>（v=1.3）. </strong>
</p>
        <pre class="screen"> $ cat debhello-1.3/hello_py/__init__.py
#!/usr/bin/python3
from gi.repository import Gtk

class TopWindow(Gtk.Window):

    def __init__(self):
        Gtk.Window.__init__(self)
        self.title = "Hello World!"
        self.counter = 0
        self.border_width = 10
        self.set_default_size(400, 100)
        self.set_position(Gtk.WindowPosition.CENTER)
        self.button = Gtk.Button(label="Click me!")
        self.button.connect("clicked", self.on_button_clicked)
        self.add(self.button)
        self.connect("delete-event", self.on_window_destroy)

    def on_window_destroy(self, *args):
        Gtk.main_quit(*args)

    def on_button_clicked(self, widget):
        self.counter += 1
        widget.set_label("Hello, World!\nClick count = %i" % self.counter)

def main():
    window = TopWindow()
    window.show_all()
    Gtk.main()

if __name__ == '__main__':
    main()</pre>
        <p>
</p>
        <p><strong><span class="strong"><strong>setup.py</strong></span>（v=1.3）. </strong>
</p>
        <pre class="screen"> $ cat debhello-1.3/setup.py
#!/usr/bin/python3
# vi:se ts=4 sts=4 et ai:
from distutils.core import setup

setup(name='debhello',
    version='4.1',
    description='Hello Python',
    long_description='Hello Python program.',
    author='Osamu Aoki',
    author_email='osamu@debian.org',
    url='http://people.debian.org/~osamu/',
    packages=['hello_py'],
    package_dir={'hello_py': 'hello_py'},
    scripts=['scripts/hello'],
    data_files=[
        ('share/applications', ['data/hello.desktop']),
        ('share/pixmaps', ['data/hello.png']),
        ('share/man/man1', ['man/hello.1']),
    ],
    classifiers = ['Development Status :: 3 - Alpha',
        'Environment :: Console',
        'Intended Audience :: Developers',
        'License :: OSI Approved :: MIT License',
        'Natural Language :: English',
        'Operating System :: POSIX :: Linux',
        'Programming Language :: Python :: 3',
        'Topic :: Utilities',
    ],
    platforms   = 'POSIX',
    license     = 'MIT License'
)</pre>
        <p>
</p>
        <p><strong><span class="strong"><strong>MANIFEST.in</strong></span>（v=1.3）. </strong>
</p>
        <pre class="screen"> $ cat debhello-1.3/MANIFEST.in
include MANIFEST.in
include LICENSE
include data/hello.deskto
include data/hello.png
include man/hello.1</pre>
        <p>
</p>
        <p>让我们使用 <span class="strong"><strong>debmake</strong></span> 命令来打包。这里使用 <span class="strong"><strong>-b':py3'</strong></span> 选项来指明生成的二进制包包含 Python3 脚本和模块文件。</p>
        <pre class="screen"> $ cd debhello-1.3
 $ debmake -b':py3'
I: set parameters
I: sanity check of parameters
I: pkg="debhello", ver="1.3", rev="1"
I: *** start packaging in "debhello-1.3". ***
I: provide debhello_1.3.orig.tar.gz for non-native Debian package
I: pwd = "/path/to"
I: $ ln -sf debhello-1.3.tar.gz debhello_1.3.orig.tar.gz
I: pwd = "/path/to/debhello-1.3"
I: parse binary package settings: :py3
I: binary package=debhello Type=python3 / Arch=all M-A=foreign
...</pre>
        <p>其余的步骤与 <a class="xref" href="ch08.zh-cn.html#setup-py" title="8.4. setup.py（Python3，命令行界面）">第 8.4 节 “setup.py（Python3，命令行界面）”</a> 中的基本一致。</p>
        <p>作为维护者，我们要把这个 Debian 软件包做得更好。</p>
        <p><strong><span class="strong"><strong>debian/rules</strong></span>（维护者版本，v=1.3）：. </strong>
</p>
        <pre class="screen"> $ vim debhello-1.3/debian/rules
 ... hack, hack, hack, ...
 $ cat debhello-1.3/debian/rules
#!/usr/bin/make -f
export DH_VERBOSE = 1

%:
        dh $@ --with python3 --buildsystem=pybuild</pre>
        <p>
</p>
        <p><strong><span class="strong"><strong>debian/control</strong></span>（维护者版本，v=1.3）：. </strong>
</p>
        <pre class="screen"> $ vim debhello-1.3/debian/control
 ... hack, hack, hack, ...
 $ cat debhello-1.3/debian/control
Source: debhello
Section: devel
Priority: optional
Maintainer: Osamu Aoki &lt;osamu@debian.org&gt;
Build-Depends: debhelper (&gt;=11~), dh-python, python3-all
Standards-Version: 4.3.0
Homepage: https://salsa.debian.org/debian/debmake-doc
X-Python3-Version: &gt;= 3.2

Package: debhello
Architecture: all
Multi-Arch: foreign
Depends: gir1.2-gtk-3.0, python3-gi, ${misc:Depends}, ${python3:Depends}
Description: example package in the debmake-doc package
 This is an example package to demonstrate Debian packaging using
 the debmake command.
 .
 The generated Debian package uses the dh command offered by the
 debhelper package and the dpkg source format `3.0 (quilt)'.</pre>
        <p>
</p>
        <p>请注意，此处需要手动添加 <span class="strong"><strong>python3-gi</strong></span> 和 <span class="strong"><strong>gir1.2-gtk-3.0</strong></span> 依赖。</p>
        <p>因为上游源码已经自带手册页，并且其余的文件在 <span class="strong"><strong>setup.py</strong></span> 文件中都有对应条目，就没有必要再去创建 <a class="xref" href="ch08.zh-cn.html#setup-py" title="8.4. setup.py（Python3，命令行界面）">第 8.4 节 “setup.py（Python3，命令行界面）”</a> 中所要求的 <span class="strong"><strong>debian/install</strong></span> 和 <span class="strong"><strong>debian/manpages</strong></span> 文件。</p>
        <p>其余的打包工作与 <a class="xref" href="ch08.zh-cn.html#setup-py" title="8.4. setup.py（Python3，命令行界面）">第 8.4 节 “setup.py（Python3，命令行界面）”</a> 中的几乎完全一致。</p>
        <p>此处是 <span class="strong"><strong>debhello_1.3-1_all.deb</strong></span> 的依赖项列表。</p>
        <p><strong><span class="strong"><strong>debhello_1.3-1_all.deb</strong></span> 的依赖项列表：. </strong>
</p>
        <pre class="screen"> $ dpkg -f debhello_1.3-1_all.deb pre-depends depends recommends conflicts br...
Depends: gir1.2-gtk-3.0, python3-gi, python3:any (&gt;= 3.2~)</pre>
        <p>
</p>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="makefile-single"/>8.7. Makefile（单个二进制软件包）</h2>
            </div>
          </div>
        </div>
        <p>这里给出了从简单的 C 语言源代码创建简单的 Debian 软件包的例子，并假设上游使用了 <span class="strong"><strong>Makefile</strong></span> 作为构建系统。</p>
        <p>此处的上游源代码是 <a class="xref" href="ch04.zh-cn.html" title="第 4 章 简单例子">第 4 章 <em>简单例子</em></a> 中的源代码的增强版本。它带有手册页、桌面文件和桌面图标。并且为了更加贴合实际，它还有一个外部库文件 <span class="strong"><strong>libm</strong></span>。</p>
        <p>让我们假设上游源码包为 <span class="strong"><strong>debhello-1.4.tar.gz</strong></span>。</p>
        <p>这一类源代码设计可以用这样的方式安装成为非系统文件：</p>
        <pre class="screen"> $ tar -xzmf debhello-1.4.tar.gz
 $ cd debhello-1.4
 $ make
 $ make install</pre>
        <p>Debian 的打包需要对“<span class="strong"><strong>make install</strong></span>”流程进行改变，从而将文件安装至系统镜像所在位置，而非通常使用的 <span class="strong"><strong>/usr/local</strong></span> 下的位置。</p>
        <p>让我们取得源码并制作 Debian 软件包。</p>
        <p><strong>下载 <span class="strong"><strong>debhello-1.4.tar.gz</strong></span>. </strong>
</p>
        <pre class="screen"> $ wget http://www.example.org/download/debhello-1.4.tar.gz
 ...
 $ tar -xzmf debhello-1.4.tar.gz
 $ tree
.
├── debhello-1.4
│   ├── LICENSE
│   ├── Makefile
│   ├── data
│   │   ├── hello.desktop
│   │   └── hello.png
│   ├── man
│   │   └── hello.1
│   └── src
│       ├── config.h
│       └── hello.c
└── debhello-1.4.tar.gz

4 directories, 8 files</pre>
        <p>
</p>
        <p>此处的源码如下所示。</p>
        <p><strong><span class="strong"><strong>src/hello.c</strong></span>（v=1.4）：. </strong>
</p>
        <pre class="screen"> $ cat debhello-1.4/src/hello.c
#include "config.h"
#include &lt;math.h&gt;
#include &lt;stdio.h&gt;
int
main()
{
        printf("Hello, I am " PACKAGE_AUTHOR "!\n");
        printf("4.0 * atan(1.0) = %10f8\n", 4.0*atan(1.0));
        return 0;
}</pre>
        <p>
</p>
        <p><strong><span class="strong"><strong>src/config.h</strong></span>（v=1.4）：. </strong>
</p>
        <pre class="screen"> $ cat debhello-1.4/src/config.h
#define PACKAGE_AUTHOR "Osamu Aoki"</pre>
        <p>
</p>
        <p><strong><span class="strong"><strong>Makefile</strong></span>（v=1.4）：. </strong>
</p>
        <pre class="screen"> $ cat debhello-1.4/Makefile
prefix = /usr/local

all: src/hello

src/hello: src/hello.c
        $(CC) $(CPPFLAGS) $(CFLAGS) $(LDFLAGS) -o $@ $^ -lm

install: src/hello
        install -D src/hello \
                $(DESTDIR)$(prefix)/bin/hello
        install -m 644 -D data/hello.desktop \
                $(DESTDIR)$(prefix)/share/applications/hello.desktop
        install -m 644 -D data/hello.png \
                $(DESTDIR)$(prefix)/share/pixmaps/hello.png
        install -m 644 -D man/hello.1 \
                $(DESTDIR)$(prefix)/share/man/man1/hello.1

clean:
        -rm -f src/hello

distclean: clean

uninstall:
        -rm -f $(DESTDIR)$(prefix)/bin/hello
        -rm -f $(DESTDIR)$(prefix)/share/applications/hello.desktop
        -rm -f $(DESTDIR)$(prefix)/share/pixmaps/hello.png
        -rm -f $(DESTDIR)$(prefix)/share/man/man1/hello.1

.PHONY: all install clean distclean uninstall</pre>
        <p>
</p>
        <p>请注意，此 <span class="strong"><strong>Makefile</strong></span> 含有正确的手册页、桌面文件、桌面图标的 <span class="strong"><strong>install</strong></span> 对象。</p>
        <p>让我们使用 <span class="strong"><strong>debmake</strong></span> 命令打包。</p>
        <pre class="screen"> $ cd debhello-1.4
 $ debmake
I: set parameters
I: sanity check of parameters
I: pkg="debhello", ver="1.4", rev="1"
I: *** start packaging in "debhello-1.4". ***
I: provide debhello_1.4.orig.tar.gz for non-native Debian package
I: pwd = "/path/to"
I: $ ln -sf debhello-1.4.tar.gz debhello_1.4.orig.tar.gz
I: pwd = "/path/to/debhello-1.4"
I: parse binary package settings:
I: binary package=debhello Type=bin / Arch=any M-A=foreign
...</pre>
        <p>其余的工作与 <a class="xref" href="ch04.zh-cn.html#step-debmake" title="4.5. 第二步：使用 debmake 产生模板文件">第 4.5 节 “第二步：使用 debmake 产生模板文件”</a> 中的几乎一致。</p>
        <p>像 <a class="xref" href="ch04.zh-cn.html#step-maintainer" title="4.6. 第三步：编辑模板文件">第 4.6 节 “第三步：编辑模板文件”</a> 中所写的一样，让我们这些维护者来把这个 Debian 软件包做的更好。</p>
        <p>如果环境变量 <span class="strong"><strong>DEB_BUILD_MAINT_OPTIONS</strong></span> 没有在 <span class="strong"><strong>debian/rules</strong></span> 文件中进行导出，lintian 会在链接 <span class="strong"><strong>libm</strong></span> 时抛出警告：“W: debhello: hardening-no-relro usr/bin/hello”。</p>
        <p><span class="strong"><strong>debian/control</strong></span> 文件与 <a class="xref" href="ch04.zh-cn.html#step-maintainer" title="4.6. 第三步：编辑模板文件">第 4.6 节 “第三步：编辑模板文件”</a> 中的完全一致，因为 <span class="strong"><strong>libm</strong></span> 库是 <span class="strong"><strong>libc6</strong></span> 库的一部分，所以它总是可获得的（优先级：必需 / Priority: required）。</p>
        <p>在 <span class="strong"><strong>debian/</strong></span> 目录下还有一些其它的模板文件。它们也需要进行更新。</p>
        <p><strong><span class="strong"><strong>debian/</strong></span> 目录下的模板文件。（v=1.4）：. </strong>
</p>
        <pre class="screen"> $ tree debhello-1.4/debian
debhello-1.4/debian
├── README.Debian
├── changelog
├── compat
├── control
├── copyright
├── patches
│   └── series
├── rules
├── source
│   ├── format
│   └── local-options
└── watch

2 directories, 10 files</pre>
        <p>
</p>
        <p>其余的打包步骤与 <a class="xref" href="ch04.zh-cn.html#step-debuild" title="4.7. 第四步：使用 debuild 构建软件包">第 4.7 节 “第四步：使用 debuild 构建软件包”</a> 中的基本一致。</p>
        <p>此处是生成的二进制包的依赖项列表。</p>
        <p><strong>生成的二进制包的依赖项列表（v=1.4）：. </strong>
</p>
        <pre class="screen"> $ dpkg -f debhello-dbgsym_1.4-1_amd64.deb pre-depends depends recommends con...
Depends: debhello (= 1.4-1)
 $ dpkg -f debhello_1.4-1_amd64.deb pre-depends depends recommends conflicts ...
Depends: libc6 (&gt;= 2.3.4)</pre>
        <p>
</p>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="configure-single"/>8.8. Makefile.in + configure（单个二进制软件包）</h2>
            </div>
          </div>
        </div>
        <p>这里给出了从简单的 C 语言源代码创建简单的 Debian 软件包的例子，并假设上游使用了 <span class="strong"><strong>Makefile.in</strong></span> 和 <span class="strong"><strong>configure</strong></span> 作为构建系统。</p>
        <p>此处的源码示例是 <a class="xref" href="ch08.zh-cn.html#makefile-single" title="8.7. Makefile（单个二进制软件包）">第 8.7 节 “Makefile（单个二进制软件包）”</a> 中的源代码的增强版本。它也有一个外部链接库 <span class="strong"><strong>libm</strong></span>，并且它的源代码可以使用 <span class="strong"><strong>configure</strong></span> 脚本进行配置，然后生成相应的 <span class="strong"><strong>Makefile</strong></span>、<span class="strong"><strong>src/config.h</strong></span> 文件。</p>
        <p>让我们假设上游源码包为 <span class="strong"><strong>debhello-1.5.tar.gz</strong></span>。</p>
        <p>此类型的源码旨在作为非系统文件安装，例如：</p>
        <pre class="screen"> $ tar -xzmf debhello-1.5.tar.gz
 $ cd debhello-1.5
 $ ./configure --with-math
 $ make
 $ make install</pre>
        <p>让我们取得源码并制作 Debian 软件包。</p>
        <p><strong>下载 <span class="strong"><strong>debhello-1.5.tar.gz</strong></span>. </strong>
</p>
        <pre class="screen"> $ wget http://www.example.org/download/debhello-1.5.tar.gz
 ...
 $ tar -xzmf debhello-1.5.tar.gz
 $ tree
.
├── debhello-1.5
│   ├── LICENSE
│   ├── Makefile.in
│   ├── configure
│   ├── data
│   │   ├── hello.desktop
│   │   └── hello.png
│   ├── man
│   │   └── hello.1
│   └── src
│       └── hello.c
└── debhello-1.5.tar.gz

4 directories, 8 files</pre>
        <p>
</p>
        <p>此处的源码如下所示。</p>
        <p><strong><span class="strong"><strong>src/hello.c</strong></span>（v=1.5）：. </strong>
</p>
        <pre class="screen"> $ cat debhello-1.5/src/hello.c
#include "config.h"
#ifdef WITH_MATH
#  include &lt;math.h&gt;
#endif
#include &lt;stdio.h&gt;
int
main()
{
        printf("Hello, I am " PACKAGE_AUTHOR "!\n");
#ifdef WITH_MATH
        printf("4.0 * atan(1.0) = %10f8\n", 4.0*atan(1.0));
#else
        printf("I can't do MATH!\n");
#endif
        return 0;
}</pre>
        <p>
</p>
        <p><strong><span class="strong"><strong>Makefile.in</strong></span>（v=1.5）：. </strong>
</p>
        <pre class="screen"> $ cat debhello-1.5/Makefile.in
prefix = @prefix@

all: src/hello

src/hello: src/hello.c
        $(CC) @VERBOSE@ \
                $(CPPFLAGS) \
                $(CFLAGS) \
                $(LDFLAGS) \
                -o $@ $^ \
                @LINKLIB@

install: src/hello
        install -D src/hello \
                $(DESTDIR)$(prefix)/bin/hello
        install -m 644 -D data/hello.desktop \
                $(DESTDIR)$(prefix)/share/applications/hello.desktop
        install -m 644 -D data/hello.png \
                $(DESTDIR)$(prefix)/share/pixmaps/hello.png
        install -m 644 -D man/hello.1 \
                $(DESTDIR)$(prefix)/share/man/man1/hello.1

clean:
        -rm -f src/hello

distclean: clean

uninstall:
        -rm -f $(DESTDIR)$(prefix)/bin/hello
        -rm -f $(DESTDIR)$(prefix)/share/applications/hello.desktop
        -rm -f $(DESTDIR)$(prefix)/share/pixmaps/hello.png
        -rm -f $(DESTDIR)$(prefix)/share/man/man1/hello.1

.PHONY: all install clean distclean uninstall</pre>
        <p>
</p>
        <p><strong><span class="strong"><strong>configure</strong></span>（v=1.5）：. </strong>
</p>
        <pre class="screen"> $ cat debhello-1.5/configure
#!/bin/sh -e
# default values
PREFIX="/usr/local"
VERBOSE=""
WITH_MATH="0"
LINKLIB=""
PACKAGE_AUTHOR="John Doe"

# parse arguments
while [ "${1}" != "" ]; do
  VAR="${1%=*}" # Drop suffix =*
  VAL="${1#*=}" # Drop prefix *=
  case "${VAR}" in
  --prefix)
    PREFIX="${VAL}"
    ;;
  --verbose|-v)
    VERBOSE="-v"
    ;;
  --with-math)
    WITH_MATH="1"
    LINKLIB="-lm"
    ;;
  --author)
    PACKAGE_AUTHOR="${VAL}"
    ;;
  *)
    echo "W: Unknown argument: ${1}"
  esac
  shift
done

# setup configured Makefile and src/config.h
sed -e "s,@prefix@,${PREFIX}," \
    -e "s,@VERBOSE@,${VERBOSE}," \
    -e "s,@LINKLIB@,${LINKLIB}," \
    &lt;Makefile.in &gt;Makefile
if [ "${WITH_MATH}" = 1 ]; then
echo "#define WITH_MATH" &gt;src/config.h
else
echo "/* not defined: WITH_MATH */" &gt;src/config.h
fi
echo "#define PACKAGE_AUTHOR \"${PACKAGE_AUTHOR}\"" &gt;&gt;src/config.h</pre>
        <p>
</p>
        <p>请注意，<span class="strong"><strong>configure</strong></span> 命令替换 <span class="strong"><strong>Makefile.in</strong></span> 文件中的 <span class="strong"><strong>@…@</strong></span> 字符串以生成 <span class="strong"><strong>Makefile</strong></span> 与 <span class="strong"><strong>src/config.h</strong></span>。</p>
        <p>让我们使用 <span class="strong"><strong>debmake</strong></span> 命令打包。</p>
        <pre class="screen"> $ cd debhello-1.5
 $ debmake
I: set parameters
I: sanity check of parameters
I: pkg="debhello", ver="1.5", rev="1"
I: *** start packaging in "debhello-1.5". ***
I: provide debhello_1.5.orig.tar.gz for non-native Debian package
I: pwd = "/path/to"
I: $ ln -sf debhello-1.5.tar.gz debhello_1.5.orig.tar.gz
I: pwd = "/path/to/debhello-1.5"
I: parse binary package settings:
I: binary package=debhello Type=bin / Arch=any M-A=foreign
...</pre>
        <p>结果与 <a class="xref" href="ch04.zh-cn.html#step-debmake" title="4.5. 第二步：使用 debmake 产生模板文件">第 4.5 节 “第二步：使用 debmake 产生模板文件”</a> 中的相似，但是并不完全一致。</p>
        <p>让我们来检查一下自动产生的模板文件。</p>
        <p><strong><span class="strong"><strong>debian/rules</strong></span>（模板文件，v=1.5）：. </strong>
</p>
        <pre class="screen"> $ cat debhello-1.5/debian/rules
#!/usr/bin/make -f
# You must remove unused comment lines for the released package.
#export DH_VERBOSE = 1
#export DEB_BUILD_MAINT_OPTIONS = hardening=+all
#export DEB_CFLAGS_MAINT_APPEND  = -Wall -pedantic
#export DEB_LDFLAGS_MAINT_APPEND = -Wl,--as-needed

%:
        dh $@</pre>
        <p>
</p>
        <p>作为维护者，我们要把这个 Debian 软件包做得更好。</p>
        <p><strong><span class="strong"><strong>debian/rules</strong></span>（维护者版本，v=1.5）：. </strong>
</p>
        <pre class="screen"> $ vim debhello-1.5/debian/rules
 ... hack, hack, hack, ...
 $ cat debhello-1.5/debian/rules
#!/usr/bin/make -f
export DH_VERBOSE = 1
export DEB_BUILD_MAINT_OPTIONS = hardening=+all
export DEB_CFLAGS_MAINT_APPEND  = -Wall -pedantic
export DEB_LDFLAGS_MAINT_APPEND = -Wl,--as-needed

%:
        dh $@

override_dh_auto_configure:
        dh_auto_configure -- \
                --with-math \
                --author="Osamu Aoki"</pre>
        <p>
</p>
        <p>在 <span class="strong"><strong>debian/</strong></span> 目录下还有一些其它的模板文件。它们也需要进行更新。</p>
        <p>其余的打包步骤与 <a class="xref" href="ch04.zh-cn.html#step-debuild" title="4.7. 第四步：使用 debuild 构建软件包">第 4.7 节 “第四步：使用 debuild 构建软件包”</a> 中的基本一致。</p>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="autotools-single"/>8.9. Autotools（单个二进制文件）</h2>
            </div>
          </div>
        </div>
        <p>这里给出了从简单的 C 语言源代码创建简单的 Debian 软件包的例子，并假设上游使用了 Autotools = Autoconf （<span class="strong"><strong>Makefile.am</strong></span> 和 <span class="strong"><strong>configure.ac</strong></span>） 作为构建系统。参见 <a class="xref" href="ch05.zh-cn.html#autotools" title="5.16.1. Autotools">第 5.16.1 节 “Autotools”</a>。</p>
        <p>此种源码通常也带有上游自动生成的 <span class="strong"><strong>Makefile.in</strong></span> 和 <span class="strong"><strong>configure</strong></span> 文件。在 <span class="strong"><strong>autotools-dev</strong></span> 软件包的帮助下，我们可以按 <a class="xref" href="ch08.zh-cn.html#configure-single" title="8.8. Makefile.in + configure（单个二进制软件包）">第 8.8 节 “Makefile.in + configure（单个二进制软件包）”</a> 中所介绍的，使用这些文件进行打包。</p>
        <p>更好的做法是，如果上游提供的 <span class="strong"><strong>Makefile.am</strong></span> 和 <span class="strong"><strong>configure.ac</strong></span> 兼容最新版本，我们可以使用最新的 Autoconf 和 Automake 软件包重新生成这些（Makefile 和 configure）文件。这么做有利于移植到新的 CPU 架构上等优势。此项工作可以使用带有 “<span class="strong"><strong>--with autoreconf</strong></span>” 选项的 <span class="strong"><strong>dh</strong></span> 命令来自动化。</p>
        <p>让我们假设上游的源码包为 <span class="strong"><strong>debhello-1.6.tar.gz</strong></span>。</p>
        <p>此类型的源码旨在作为非系统文件安装，例如：</p>
        <pre class="screen"> $ tar -xzmf debhello-1.6.tar.gz
 $ cd debhello-1.6
 $ autoreconf -ivf # optional
 $ ./configure --with-math
 $ make
 $ make install</pre>
        <p>让我们取得源码并制作 Debian 软件包。</p>
        <p><strong>下载 <span class="strong"><strong>debhello-1.6.tar.gz</strong></span>. </strong>
</p>
        <pre class="screen"> $ wget http://www.example.org/download/debhello-1.6.tar.gz
 ...
 $ tar -xzmf debhello-1.6.tar.gz
 $ tree
.
├── debhello-1.6
│   ├── Makefile.am
│   ├── configure.ac
│   ├── data
│   │   ├── hello.desktop
│   │   └── hello.png
│   ├── man
│   │   ├── Makefile.am
│   │   └── hello.1
│   └── src
│       ├── Makefile.am
│       └── hello.c
└── debhello-1.6.tar.gz

4 directories, 9 files</pre>
        <p>
</p>
        <p>此处的源码如下所示。</p>
        <p><strong><span class="strong"><strong>src/hello.c</strong></span>（v=1.6）：. </strong>
</p>
        <pre class="screen"> $ cat debhello-1.6/src/hello.c
#include "config.h"
#ifdef WITH_MATH
#  include &lt;math.h&gt;
#endif
#include &lt;stdio.h&gt;
int
main()
{
        printf("Hello, I am " PACKAGE_AUTHOR "!\n");
#ifdef WITH_MATH
        printf("4.0 * atan(1.0) = %10f8\n", 4.0*atan(1.0));
#else
        printf("I can't do MATH!\n");
#endif
        return 0;
}</pre>
        <p>
</p>
        <p><strong><span class="strong"><strong>Makefile.am</strong></span>（v=1.6）：. </strong>
</p>
        <pre class="screen"> $ cat debhello-1.6/Makefile.am
SUBDIRS = src man
 $ cat debhello-1.6/man/Makefile.am
dist_man_MANS = hello.1
 $ cat debhello-1.6/src/Makefile.am
bin_PROGRAMS = hello
hello_SOURCES = hello.c</pre>
        <p>
</p>
        <p><strong><span class="strong"><strong>configure.ac</strong></span>（v=1.6）：. </strong>
</p>
        <pre class="screen"> $ cat debhello-1.6/configure.ac
#                                               -*- Autoconf -*-
# Process this file with autoconf to produce a configure script.
AC_PREREQ([2.69])
AC_INIT([debhello],[2.1],[foo@example.org])
AC_CONFIG_SRCDIR([src/hello.c])
AC_CONFIG_HEADERS([config.h])
echo "Standard customization chores"
AC_CONFIG_AUX_DIR([build-aux])
AM_INIT_AUTOMAKE([foreign])
# Add #define PACKAGE_AUTHOR ... in config.h with a comment
AC_DEFINE(PACKAGE_AUTHOR, ["Osamu Aoki"], [Define PACKAGE_AUTHOR])
echo "Add --with-math option functionality to ./configure"
AC_ARG_WITH([math],
  [AS_HELP_STRING([--with-math],
    [compile with math library  @&lt;:@default=yes@:&gt;@])],
  [],
  [with_math="yes"]
  )
echo "==== withval   := \"$withval\""
echo "==== with_math := \"$with_math\""
# m4sh if-else construct
AS_IF([test "x$with_math" != "xno"],[
  echo "==== Check include: math.h"
  AC_CHECK_HEADER(math.h,[],[
    AC_MSG_ERROR([Couldn't find math.h.] )
  ])
  echo "==== Check library: libm"
  AC_SEARCH_LIBS(atan, [m])
  #AC_CHECK_LIB(m, atan)
  echo "==== Build with LIBS := \"$LIBS\""
  AC_DEFINE(WITH_MATH, [1], [Build with the math library])
],[
  echo "==== Skip building with math.h."
  AH_TEMPLATE(WITH_MATH, [Build without the math library])
])
# Checks for programs.
AC_PROG_CC
AC_CONFIG_FILES([Makefile
                 man/Makefile
                 src/Makefile])
AC_OUTPUT</pre>
        <p>
</p>
        <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">
          <table border="0" summary="Tip">
            <tr>
              <td rowspan="2" align="center" valign="top">
                <img alt="[提示]" src="images/tip.png"/>
              </td>
              <th align="left">提示</th>
            </tr>
            <tr>
              <td align="left" valign="top">
                <p>如果没有像上述例子中，在 <span class="strong"><strong>AM_INIT_AUTOMAKE()</strong></span> 中指定严格级别（strictness level）为 “<span class="strong"><strong>foreign</strong></span>”，那么 <span class="strong"><strong>automake</strong></span> 会默认严格级别为 “<span class="strong"><strong>gnu</strong></span>”，并需要在顶级目录中有若干文件。参见 <span class="strong"><strong>automake</strong></span> 文档的 “3.2 Strictness”。</p>
              </td>
            </tr>
          </table>
        </div>
        <p>让我们使用 <span class="strong"><strong>debmake</strong></span> 命令打包。</p>
        <pre class="screen"> $ cd debhello-1.6
 $ debmake
I: set parameters
I: sanity check of parameters
I: pkg="debhello", ver="1.6", rev="1"
I: *** start packaging in "debhello-1.6". ***
I: provide debhello_1.6.orig.tar.gz for non-native Debian package
I: pwd = "/path/to"
I: $ ln -sf debhello-1.6.tar.gz debhello_1.6.orig.tar.gz
I: pwd = "/path/to/debhello-1.6"
I: parse binary package settings:
I: binary package=debhello Type=bin / Arch=any M-A=foreign
...</pre>
        <p>结果与 <a class="xref" href="ch08.zh-cn.html#configure-single" title="8.8. Makefile.in + configure（单个二进制软件包）">第 8.8 节 “Makefile.in + configure（单个二进制软件包）”</a> 中的类似，但是并不完全一致。</p>
        <p>让我们来检查一下自动产生的模板文件。</p>
        <p><strong><span class="strong"><strong>debian/rules</strong></span>（模板文件，v=1.6）: </strong>
</p>
        <pre class="screen"> $ cat debhello-1.6/debian/rules
#!/usr/bin/make -f
# You must remove unused comment lines for the released package.
#export DH_VERBOSE = 1
#export DEB_BUILD_MAINT_OPTIONS = hardening=+all
#export DEB_CFLAGS_MAINT_APPEND  = -Wall -pedantic
#export DEB_LDFLAGS_MAINT_APPEND = -Wl,--as-needed

%:
        dh $@ --with autoreconf

#override_dh_install:
#       dh_install --list-missing -X.la -X.pyc -X.pyo</pre>
        <p>
</p>
        <p>作为维护者，我们要把这个 Debian 软件包做得更好。</p>
        <p><strong><span class="strong"><strong>debian/rules</strong></span>（维护者版本，v=1.6）：. </strong>
</p>
        <pre class="screen"> $ vim debhello-1.6/debian/rules
 ... hack, hack, hack, ...
 $ cat debhello-1.6/debian/rules
#!/usr/bin/make -f
export DH_VERBOSE = 1
export DEB_BUILD_MAINT_OPTIONS = hardening=+all
export DEB_CFLAGS_MAINT_APPEND  = -Wall -pedantic
export DEB_LDFLAGS_MAINT_APPEND = -Wl,--as-needed

%:
        dh $@ --with autoreconf

override_dh_auto_configure:
        dh_auto_configure -- \
                --with-math</pre>
        <p>
</p>
        <p>在 <span class="strong"><strong>debian/</strong></span> 目录下还有一些其它的模板文件。它们也需要进行更新。</p>
        <p>其余的打包步骤与 <a class="xref" href="ch04.zh-cn.html#step-debuild" title="4.7. 第四步：使用 debuild 构建软件包">第 4.7 节 “第四步：使用 debuild 构建软件包”</a> 中的基本一致。</p>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="cmake-single"/>8.10. CMake（单个二进制软件包）</h2>
            </div>
          </div>
        </div>
        <p>此处是一个从简单的 C 语言源码程序生成简单的 Debian 软件包的示例，我们假设上游使用 CMake（<span class="strong"><strong>CMakeLists.txt</strong></span> 和若干形似 <span class="strong"><strong>config.h.in</strong></span> 的文件）作为构建系统。参见 <a class="xref" href="ch05.zh-cn.html#cmake" title="5.16.2. CMake">第 5.16.2 节 “CMake”</a>。</p>
        <p><span class="strong"><strong>cmake</strong></span> 命令根据 <span class="strong"><strong>CMakeLists.txt</strong></span> 文件和它的 <span class="strong"><strong>-D</strong></span> 选项来生成 <span class="strong"><strong>Makefile</strong></span> 文件。此外，它还会根据 <span class="strong"><strong>configure_file(…)</strong></span> 中指定的条目来替换带有 <span class="strong"><strong>@…@</strong></span> 的字符串、更改 <span class="strong"><strong>#cmakedefine …</strong></span>。</p>
        <p>让我们假设上游的源码包为 <span class="strong"><strong>debhello-1.7.tar.gz</strong></span>。</p>
        <p>此类型的源码旨在作为非系统文件安装，例如：</p>
        <pre class="screen"> $ tar -xzmf debhello-1.7.tar.gz
 $ cd debhello-1.7
 $ mkdir obj-x86_64-linux-gnu # for out-of-tree build
 $ cd obj-x86_64-linux-gnu
 $ cmake ..
 $ make
 $ make install</pre>
        <p>让我们取得源码并制作 Debian 软件包。</p>
        <p><strong>下载 <span class="strong"><strong>debhello-1.7.tar.gz</strong></span>. </strong>
</p>
        <pre class="screen"> $ wget http://www.example.org/download/debhello-1.7.tar.gz
 ...
 $ tar -xzmf debhello-1.7.tar.gz
 $ tree
.
├── debhello-1.7
│   ├── CMakeLists.txt
│   ├── data
│   │   ├── hello.desktop
│   │   └── hello.png
│   ├── man
│   │   ├── CMakeLists.txt
│   │   └── hello.1
│   └── src
│       ├── CMakeLists.txt
│       ├── config.h.in
│       └── hello.c
└── debhello-1.7.tar.gz

4 directories, 9 files</pre>
        <p>
</p>
        <p>此处的源码如下所示。</p>
        <p><strong><span class="strong"><strong>src/hello.c</strong></span>（v=1.7）：. </strong>
</p>
        <pre class="screen"> $ cat debhello-1.7/src/hello.c
#include "config.h"
#ifdef WITH_MATH
#  include &lt;math.h&gt;
#endif
#include &lt;stdio.h&gt;
int
main()
{
        printf("Hello, I am " PACKAGE_AUTHOR "!\n");
#ifdef WITH_MATH
        printf("4.0 * atan(1.0) = %10f8\n", 4.0*atan(1.0));
#else
        printf("I can't do MATH!\n");
#endif
        return 0;
}</pre>
        <p>
</p>
        <p><strong><span class="strong"><strong>src/config.h.in</strong></span>（v=1.7）：. </strong>
</p>
        <pre class="screen"> $ cat debhello-1.7/src/config.h.in
/* name of the package author */
#define PACKAGE_AUTHOR "@PACKAGE_AUTHOR@"
/* math library support */
#cmakedefine WITH_MATH</pre>
        <p>
</p>
        <p><strong><span class="strong"><strong>CMakeLists.txt</strong></span>（v=1.7）：. </strong>
</p>
        <pre class="screen"> $ cat debhello-1.7/CMakeLists.txt
cmake_minimum_required(VERSION 2.8)
project(debhello)
set(PACKAGE_AUTHOR "Osamu Aoki")
add_subdirectory(src)
add_subdirectory(man)
 $ cat debhello-1.7/man/CMakeLists.txt
install(
  FILES ${CMAKE_CURRENT_SOURCE_DIR}/hello.1
  DESTINATION share/man/man1
)
 $ cat debhello-1.7/src/CMakeLists.txt
# Always define HAVE_CONFIG_H
add_definitions(-DHAVE_CONFIG_H)
# Interactively define WITH_MATH
option(WITH_MATH "Build with math support" OFF)
#variable_watch(WITH_MATH)
# Generate config.h from config.h.in
configure_file(
  "${CMAKE_CURRENT_SOURCE_DIR}/config.h.in"
  "${CMAKE_CURRENT_BINARY_DIR}/config.h"
)
include_directories("${CMAKE_CURRENT_BINARY_DIR}")
add_executable(hello hello.c)
install(TARGETS hello
  RUNTIME DESTINATION bin
)</pre>
        <p>
</p>
        <p>让我们使用 <span class="strong"><strong>debmake</strong></span> 命令打包。</p>
        <pre class="screen"> $ cd debhello-1.7
 $ debmake
I: set parameters
I: sanity check of parameters
I: pkg="debhello", ver="1.7", rev="1"
I: *** start packaging in "debhello-1.7". ***
I: provide debhello_1.7.orig.tar.gz for non-native Debian package
I: pwd = "/path/to"
I: $ ln -sf debhello-1.7.tar.gz debhello_1.7.orig.tar.gz
I: pwd = "/path/to/debhello-1.7"
I: parse binary package settings:
I: binary package=debhello Type=bin / Arch=any M-A=foreign
...</pre>
        <p>结果与 <a class="xref" href="ch08.zh-cn.html#configure-single" title="8.8. Makefile.in + configure（单个二进制软件包）">第 8.8 节 “Makefile.in + configure（单个二进制软件包）”</a> 中的类似，但是并不完全一致。</p>
        <p>让我们来检查一下自动产生的模板文件。</p>
        <p><strong><span class="strong"><strong>debian/rules</strong></span>（模板文件，v=1.7）：. </strong>
</p>
        <pre class="screen"> $ cat debhello-1.7/debian/rules
#!/usr/bin/make -f
# You must remove unused comment lines for the released package.
#export DH_VERBOSE = 1
#export DEB_BUILD_MAINT_OPTIONS = hardening=+all
#export DEB_CFLAGS_MAINT_APPEND  = -Wall -pedantic
#export DEB_LDFLAGS_MAINT_APPEND = -Wl,--as-needed

%:
        dh $@

#override_dh_auto_configure:
#       dh_auto_configure -- \
#             -DCMAKE_LIBRARY_ARCHITECTURE="$(DEB_TARGET_MULTIARCH)"</pre>
        <p>
</p>
        <p><strong><span class="strong"><strong>debian/control</strong></span>（模板文件，v=1.7）：. </strong>
</p>
        <pre class="screen"> $ cat debhello-1.7/debian/control
Source: debhello
Section: unknown
Priority: optional
Maintainer: "Firstname Lastname" &lt;email.address@example.org&gt;
Build-Depends: cmake, debhelper (&gt;=11~)
Standards-Version: 4.1.4
Homepage: &lt;insert the upstream URL, if relevant&gt;

Package: debhello
Architecture: any
Multi-Arch: foreign
Depends: ${misc:Depends}, ${shlibs:Depends}
Description: auto-generated package by debmake
 This Debian binary package was auto-generated by the
 debmake(1) command provided by the debmake package.</pre>
        <p>
</p>
        <p>作为维护者，我们要把这个 Debian 软件包做得更好。</p>
        <p><strong><span class="strong"><strong>debian/rules</strong></span>（维护者版本，v=1.7）：. </strong>
</p>
        <pre class="screen"> $ vim debhello-1.7/debian/rules
 ... hack, hack, hack, ...
 $ cat debhello-1.7/debian/rules
#!/usr/bin/make -f
export DH_VERBOSE = 1
export DEB_BUILD_MAINT_OPTIONS = hardening=+all
export DEB_CFLAGS_MAINT_APPEND  = -Wall -pedantic
export DEB_LDFLAGS_MAINT_APPEND = -Wl,--as-needed

%:
        dh $@

override_dh_auto_configure:
        dh_auto_configure -- -DWITH-MATH=1</pre>
        <p>
</p>
        <p><strong><span class="strong"><strong>debian/control</strong></span>（维护者版本，v=1.7）：. </strong>
</p>
        <pre class="screen"> $ vim debhello-1.7/debian/control
 ... hack, hack, hack, ...
 $ cat debhello-1.7/debian/control
Source: debhello
Section: devel
Priority: optional
Maintainer: Osamu Aoki &lt;osamu@debian.org&gt;
Build-Depends: cmake, debhelper (&gt;=11~)
Standards-Version: 4.3.0
Homepage: https://salsa.debian.org/debian/debmake-doc

Package: debhello
Architecture: any
Multi-Arch: foreign
Depends: ${misc:Depends}, ${shlibs:Depends}
Description: example package in the debmake-doc package
 This is an example package to demonstrate Debian packaging using
 the debmake command.
 .
 The generated Debian package uses the dh command offered by the
 debhelper package and the dpkg source format `3.0 (quilt)'.</pre>
        <p>
</p>
        <p>在 <span class="strong"><strong>debian/</strong></span> 目录下还有一些其它的模板文件。它们也需要进行更新。</p>
        <p>其余的打包工作与 <a class="xref" href="ch08.zh-cn.html#configure-single" title="8.8. Makefile.in + configure（单个二进制软件包）">第 8.8 节 “Makefile.in + configure（单个二进制软件包）”</a> 中的近乎一致。</p>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="autotools-multi"/>8.11. Autotools（多个二进制软件包）</h2>
            </div>
          </div>
        </div>
        <p>此处是从一个简单的 C 语言源码程序创建一个包含可执行软件包、共享库包、开发文件包和调试符号包的一系列 Debian 二进制包的示例，我们假设上游使用 Autotools = Autoconf 和 Automake （使用 <span class="strong"><strong>Makefile.am</strong></span> 和 <span class="strong"><strong>configure.ac</strong></span> 作为输入文件）作为构建系统。参见 <a class="xref" href="ch05.zh-cn.html#autotools" title="5.16.1. Autotools">第 5.16.1 节 “Autotools”</a>。</p>
        <p>让我们用与 <a class="xref" href="ch08.zh-cn.html#autotools-single" title="8.9. Autotools（单个二进制文件）">第 8.9 节 “Autotools（单个二进制文件）”</a> 中的相同的方式打包。</p>
        <p>让我们假设上游源码包为 <span class="strong"><strong>debhello-2.0.tar.gz</strong></span>。</p>
        <p>此类型的源码旨在作为非系统文件安装，例如：</p>
        <pre class="screen"> $ tar -xzmf debhello-2.0.tar.gz
 $ cd debhello-2.0
 $ autoreconf -ivf # optional
 $ ./configure --with-math
 $ make
 $ make install</pre>
        <p>让我们取得源码并制作 Debian 软件包。</p>
        <p><strong>下载 <span class="strong"><strong>debhello-2.0.tar.gz</strong></span>. </strong>
</p>
        <pre class="screen"> $ wget http://www.example.org/download/debhello-2.0.tar.gz
 ...
 $ tar -xzmf debhello-2.0.tar.gz
 $ tree
.
├── debhello-2.0
│   ├── Makefile.am
│   ├── configure.ac
│   ├── data
│   │   ├── hello.desktop
│   │   └── hello.png
│   ├── lib
│   │   ├── Makefile.am
│   │   ├── sharedlib.c
│   │   └── sharedlib.h
│   ├── man
│   │   ├── Makefile.am
│   │   └── hello.1
│   └── src
│       ├── Makefile.am
│       └── hello.c
└── debhello-2.0.tar.gz

5 directories, 12 files</pre>
        <p>
</p>
        <p>此处的源码如下所示。</p>
        <p><strong><span class="strong"><strong>src/hello.c</strong></span>（v=2.0）：. </strong>
</p>
        <pre class="screen"> $ cat debhello-2.0/src/hello.c
#include "config.h"
#include &lt;stdio.h&gt;
#include &lt;sharedlib.h&gt;
int
main()
{
        printf("Hello, I am " PACKAGE_AUTHOR "!\n");
        sharedlib();
        return 0;
}</pre>
        <p>
</p>
        <p><strong><span class="strong"><strong>lib/sharedlib.h</strong></span> 与 <span class="strong"><strong>lib/sharedlib.c</strong></span>（v=1.6）：. </strong>
</p>
        <pre class="screen"> $ cat debhello-2.0/lib/sharedlib.h
int sharedlib();
 $ cat debhello-2.0/lib/sharedlib.c
#include &lt;stdio.h&gt;
int
sharedlib()
{
        printf("This is a shared library!\n");
        return 0;
}</pre>
        <p>
</p>
        <p><strong><span class="strong"><strong>Makefile.am</strong></span>（v=2.0）：. </strong>
</p>
        <pre class="screen"> $ cat debhello-2.0/Makefile.am
# recursively process `Makefile.am` in SUBDIRS
SUBDIRS = lib src man
 $ cat debhello-2.0/man/Makefile.am
# manpages (distributed in the source package)
dist_man_MANS = hello.1
 $ cat debhello-2.0/lib/Makefile.am
# libtool librares to be produced
lib_LTLIBRARIES = libsharedlib.la

# source files used for lib_LTLIBRARIES
libsharedlib_la_SOURCES = sharedlib.c

# C pre-processor flags used for lib_LTLIBRARIES
#libsharedlib_la_CPPFLAGS =

# Headers files to be installed in &lt;prefix&gt;/include
include_HEADERS = sharedlib.h

# Versioning Libtool Libraries with version triplets
libsharedlib_la_LDFLAGS = -version-info 1:0:0
 $ cat debhello-2.0/src/Makefile.am
# program executables to be produced
bin_PROGRAMS = hello

# source files used for bin_PROGRAMS
hello_SOURCES = hello.c

# C pre-processor flags used for bin_PROGRAMS
AM_CPPFLAGS = -I$(srcdir) -I$(top_srcdir)/lib

# Extra options for the linker for hello
# hello_LDFLAGS =

# Libraries the `hello` binary to be linked
hello_LDADD = $(top_srcdir)/lib/libsharedlib.la</pre>
        <p>
</p>
        <p><strong><span class="strong"><strong>configure.ac</strong></span>（v=2.0）：. </strong>
</p>
        <pre class="screen"> $ cat debhello-2.0/configure.ac
#                                               -*- Autoconf -*-
# Process this file with autoconf to produce a configure script.
AC_PREREQ([2.69])
AC_INIT([debhello],[2.2],[foo@example.org])
AC_CONFIG_SRCDIR([src/hello.c])
AC_CONFIG_HEADERS([config.h])
echo "Standard customization chores"
AC_CONFIG_AUX_DIR([build-aux])

AM_INIT_AUTOMAKE([foreign])

# Set default to --enable-shared --disable-static
LT_INIT([shared disable-static])

# find the libltdl sources in the libltdl sub-directory
LT_CONFIG_LTDL_DIR([libltdl])

# choose one
LTDL_INIT([recursive])
#LTDL_INIT([subproject])
#LTDL_INIT([nonrecursive])

# Add #define PACKAGE_AUTHOR ... in config.h with a comment
AC_DEFINE(PACKAGE_AUTHOR, ["Osamu Aoki"], [Define PACKAGE_AUTHOR])
# Checks for programs.
AC_PROG_CC

# only for the recursive case
AC_CONFIG_FILES([Makefile
                 lib/Makefile
                 man/Makefile
                 src/Makefile])
AC_OUTPUT</pre>
        <p>
</p>
        <p>让我们用 <span class="strong"><strong>debmake</strong></span> 命令将这些打包到多个包中：</p>
        <div class="itemizedlist">
          <ul class="itemizedlist">
            <li class="listitem"><span class="strong"><strong>debhello</strong></span>: type = <span class="strong"><strong>bin</strong></span></li>
            <li class="listitem"><span class="strong"><strong>libsharedlib1</strong></span>: type = <span class="strong"><strong>lib</strong></span></li>
            <li class="listitem"><span class="strong"><strong>libsharedlib-dev</strong></span>: type = <span class="strong"><strong>dev</strong></span></li>
          </ul>
        </div>
        <p>此处的 <span class="strong"><strong>-b',libsharedlib1,libsharedlib-dev'</strong></span> 选项是用以指明生成的二进制包。</p>
        <pre class="screen"> $ cd debhello-2.0
 $ debmake -b',libsharedlib1,libsharedlib-dev'
I: set parameters
I: sanity check of parameters
I: pkg="debhello", ver="2.0", rev="1"
I: *** start packaging in "debhello-2.0". ***
I: provide debhello_2.0.orig.tar.gz for non-native Debian package
I: pwd = "/path/to"
I: $ ln -sf debhello-2.0.tar.gz debhello_2.0.orig.tar.gz
I: pwd = "/path/to/debhello-2.0"
I: parse binary package settings: ,libsharedlib1,libsharedlib-dev
I: binary package=debhello Type=bin / Arch=any M-A=foreign
I: binary package=libsharedlib1 Type=lib / Arch=any M-A=same
I: binary package=libsharedlib-dev Type=dev / Arch=any M-A=same
I: analyze the source tree
I: build_type = Autotools with autoreconf
...</pre>
        <p>结果与 <a class="xref" href="ch08.zh-cn.html#configure-single" title="8.8. Makefile.in + configure（单个二进制软件包）">第 8.8 节 “Makefile.in + configure（单个二进制软件包）”</a> 中的相似，但是这个具有更多的模板文件。</p>
        <p>让我们来检查一下自动产生的模板文件。</p>
        <p><strong><span class="strong"><strong>debian/rules</strong></span>（模板文件，v=2.0）：. </strong>
</p>
        <pre class="screen"> $ cat debhello-2.0/debian/rules
#!/usr/bin/make -f
# You must remove unused comment lines for the released package.
#export DH_VERBOSE = 1
#export DEB_BUILD_MAINT_OPTIONS = hardening=+all
#export DEB_CFLAGS_MAINT_APPEND  = -Wall -pedantic
#export DEB_LDFLAGS_MAINT_APPEND = -Wl,--as-needed

%:
        dh $@ --with autoreconf

#override_dh_install:
#       dh_install --list-missing -X.la -X.pyc -X.pyo</pre>
        <p>
</p>
        <p>作为维护者，我们要把这个 Debian 软件包做得更好。</p>
        <p><strong><span class="strong"><strong>debian/rules</strong></span>（维护者版本，v=2.0）：. </strong>
</p>
        <pre class="screen"> $ vim debhello-2.0/debian/rules
 ... hack, hack, hack, ...
 $ cat debhello-2.0/debian/rules
#!/usr/bin/make -f
export DH_VERBOSE = 1
export DEB_BUILD_MAINT_OPTIONS = hardening=+all
export DEB_CFLAGS_MAINT_APPEND  = -Wall -pedantic
export DEB_LDFLAGS_MAINT_APPEND = -Wl,--as-needed

%:
        dh $@ --with autoreconf

override_dh_install:
        dh_install --list-missing -X.la</pre>
        <p>
</p>
        <p><strong><span class="strong"><strong>debian/control</strong></span>（维护者版本，v=2.0）：. </strong>
</p>
        <pre class="screen"> $ vim debhello-2.0/debian/control
 ... hack, hack, hack, ...
 $ cat debhello-2.0/debian/control
Source: debhello
Section: devel
Priority: optional
Maintainer: Osamu Aoki &lt;osamu@debian.org&gt;
Build-Depends: debhelper (&gt;=11~), dh-autoreconf
Standards-Version: 4.3.0
Homepage: https://salsa.debian.org/debian/debmake-doc

Package: debhello
Architecture: any
Multi-Arch: foreign
Depends: libsharedlib1 (= ${binary:Version}),
         ${misc:Depends},
         ${shlibs:Depends}
Description: example executable package
 This is an example package to demonstrate Debian packaging using
 the debmake command.
 .
 The generated Debian package uses the dh command offered by the
 debhelper package and the dpkg source format `3.0 (quilt)'.
 .
 This package provides the executable program.

Package: libsharedlib1
Section: libs
Architecture: any
Multi-Arch: same
Pre-Depends: ${misc:Pre-Depends}
Depends: ${misc:Depends}, ${shlibs:Depends}
Description: example shared library package
 This is an example package to demonstrate Debian packaging using
 the debmake command.
 .
 The generated Debian package uses the dh command offered by the
 debhelper package and the dpkg source format `3.0 (quilt)'.
 .
 This package contains the shared library.

Package: libsharedlib-dev
Section: libdevel
Architecture: any
Multi-Arch: same
Depends: libsharedlib1 (= ${binary:Version}), ${misc:Depends}
Description: example development package
 This is an example package to demonstrate Debian packaging using
 the debmake command.
 .
 The generated Debian package uses the dh command offered by the
 debhelper package and the dpkg source format `3.0 (quilt)'.
 .
 This package contains the development files.</pre>
        <p>
</p>
        <p><strong><span class="strong"><strong>debian/*.install</strong></span>（维护者版本，v=2.0）：. </strong>
</p>
        <pre class="screen"> $ vim debhello-2.0/debian/debhello.install
 ... hack, hack, hack, ...
 $ cat debhello-2.0/debian/debhello.install
usr/bin/*
usr/share/man/*
 $ vim debhello-2.0/debian/libsharedlib1.install
 ... hack, hack, hack, ...
 $ cat debhello-2.0/debian/libsharedlib1.install
usr/lib/*/*.so.*
 $ vim debhello-2.0/debian/libsharedlib-dev.install
 ... hack, hack, hack, ...
 $ cat debhello-2.0/debian/libsharedlib-dev.install
###usr/lib/*/pkgconfig/*.pc
usr/include
usr/lib/*/*.so</pre>
        <p>
</p>
        <p>因为上游源码已经具有正确的自动生成的 <span class="strong"><strong>Makefile</strong></span> 文件，所以没有必要再去创建 <span class="strong"><strong>debian/install</strong></span> 和 <span class="strong"><strong>debian/manpages</strong></span> 文件。</p>
        <p>在 <span class="strong"><strong>debian/</strong></span> 目录下还有一些其它的模板文件。它们也需要进行更新。</p>
        <p><strong><span class="strong"><strong>debian/</strong></span> 目录下的模板文件。（v=2.0）：. </strong>
</p>
        <pre class="screen"> $ tree debhello-2.0/debian
debhello-2.0/debian
├── README.Debian
├── changelog
├── compat
├── control
├── copyright
├── debhello.install
├── libsharedlib-dev.install
├── libsharedlib1.install
├── libsharedlib1.symbols
├── patches
│   └── series
├── rules
├── source
│   ├── format
│   └── local-options
└── watch

2 directories, 14 files</pre>
        <p>
</p>
        <p>其余的打包工作与 <a class="xref" href="ch08.zh-cn.html#configure-single" title="8.8. Makefile.in + configure（单个二进制软件包）">第 8.8 节 “Makefile.in + configure（单个二进制软件包）”</a> 中的近乎一致。</p>
        <p>此处是生成的二进制包的依赖项列表。</p>
        <p><strong>生成的二进制包的依赖项列表（v=2.0）：. </strong>
</p>
        <pre class="screen"> $ dpkg -f debhello-dbgsym_2.0-1_amd64.deb pre-depends depends recommends con...
Depends: debhello (= 2.0-1)
 $ dpkg -f debhello_2.0-1_amd64.deb pre-depends depends recommends conflicts ...
Depends: libsharedlib1 (= 2.0-1), libc6 (&gt;= 2.2.5)
 $ dpkg -f libsharedlib-dev_2.0-1_amd64.deb pre-depends depends recommends co...
Depends: libsharedlib1 (= 2.0-1)
 $ dpkg -f libsharedlib1-dbgsym_2.0-1_amd64.deb pre-depends depends recommend...
Depends: libsharedlib1 (= 2.0-1)
 $ dpkg -f libsharedlib1_2.0-1_amd64.deb pre-depends depends recommends confl...
Depends: libc6 (&gt;= 2.2.5)</pre>
        <p>
</p>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="cmake-multi"/>8.12. CMake（多个二进制软件包）</h2>
            </div>
          </div>
        </div>
        <p>此处是从一个简单的 C 语言源码程序创建一系列包含可执行软件包、共享库包、开发文件包和调试符号包的 Debian 二进制包的示例，我们假设上游使用 CMake（<span class="strong"><strong>CMakeLists.txt</strong></span> 和其他形如 <span class="strong"><strong>config.h.in</strong></span> 的文件）作为构建系统。参见 <a class="xref" href="ch05.zh-cn.html#cmake" title="5.16.2. CMake">第 5.16.2 节 “CMake”</a>。</p>
        <p>让我们假设上游源码包为 <span class="strong"><strong>debhello-2.1.tar.gz</strong></span>。</p>
        <p>此类型的源码旨在作为非系统文件安装，例如：</p>
        <pre class="screen"> $ tar -xzmf debhello-2.1.tar.gz
 $ cd debhello-2.1
 $ mkdir obj-x86_64-linux-gnu
 $ cd obj-x86_64-linux-gnu
 $ cmake ..
 $ make
 $ make install</pre>
        <p>让我们取得源码并制作 Debian 软件包。</p>
        <p><strong>下载 <span class="strong"><strong>debhello-2.1.tar.gz</strong></span>. </strong>
</p>
        <pre class="screen"> $ wget http://www.example.org/download/debhello-2.1.tar.gz
 ...
 $ tar -xzmf debhello-2.1.tar.gz
 $ tree
.
├── debhello-2.1
│   ├── CMakeLists.txt
│   ├── data
│   │   ├── hello.desktop
│   │   └── hello.png
│   ├── lib
│   │   ├── CMakeLists.txt
│   │   ├── sharedlib.c
│   │   └── sharedlib.h
│   ├── man
│   │   ├── CMakeLists.txt
│   │   └── hello.1
│   └── src
│       ├── CMakeLists.txt
│       ├── config.h.in
│       └── hello.c
└── debhello-2.1.tar.gz

5 directories, 12 files</pre>
        <p>
</p>
        <p>此处的源码如下所示。</p>
        <p><strong><span class="strong"><strong>src/hello.c</strong></span>（v=2.1）：. </strong>
</p>
        <pre class="screen"> $ cat debhello-2.1/src/hello.c
#include "config.h"
#include &lt;stdio.h&gt;
#include &lt;sharedlib.h&gt;
int
main()
{
        printf("Hello, I am " PACKAGE_AUTHOR "!\n");
        sharedlib();
        return 0;
}</pre>
        <p>
</p>
        <p><strong><span class="strong"><strong>src/config.h.in</strong></span>（v=2.1）：. </strong>
</p>
        <pre class="screen"> $ cat debhello-2.1/src/config.h.in
/* name of the package author */
#define PACKAGE_AUTHOR "@PACKAGE_AUTHOR@"</pre>
        <p>
</p>
        <p><strong><span class="strong"><strong>lib/sharedlib.c</strong></span> 与 <span class="strong"><strong>lib/sharedlib.h</strong></span>（v=2.1）：. </strong>
</p>
        <pre class="screen"> $ cat debhello-2.1/lib/sharedlib.h
int sharedlib();
 $ cat debhello-2.1/lib/sharedlib.c
#include &lt;stdio.h&gt;
int
sharedlib()
{
        printf("This is a shared library!\n");
        return 0;
}</pre>
        <p>
</p>
        <p><strong><span class="strong"><strong>CMakeLists.txt</strong></span>（v=2.1）：. </strong>
</p>
        <pre class="screen"> $ cat debhello-2.1/CMakeLists.txt
cmake_minimum_required(VERSION 2.8)
project(debhello)
set(PACKAGE_AUTHOR "Osamu Aoki")
add_subdirectory(lib)
add_subdirectory(src)
add_subdirectory(man)
 $ cat debhello-2.1/man/CMakeLists.txt
install(
  FILES ${CMAKE_CURRENT_SOURCE_DIR}/hello.1
  DESTINATION share/man/man1
)
 $ cat debhello-2.1/src/CMakeLists.txt
# Always define HAVE_CONFIG_H
add_definitions(-DHAVE_CONFIG_H)
# Generate config.h from config.h.in
configure_file(
  "${CMAKE_CURRENT_SOURCE_DIR}/config.h.in"
  "${CMAKE_CURRENT_BINARY_DIR}/config.h"
  )
include_directories("${CMAKE_CURRENT_BINARY_DIR}")
include_directories("${CMAKE_SOURCE_DIR}/lib")

add_executable(hello hello.c)
target_link_libraries(hello sharedlib)
install(TARGETS hello
  RUNTIME DESTINATION bin
)</pre>
        <p>
</p>
        <p>让我们使用 <span class="strong"><strong>debmake</strong></span> 命令打包。</p>
        <pre class="screen"> $ cd debhello-2.1
 $ debmake -b',libsharedlib1,libsharedlib-dev'
I: set parameters
I: sanity check of parameters
I: pkg="debhello", ver="2.1", rev="1"
I: *** start packaging in "debhello-2.1". ***
I: provide debhello_2.1.orig.tar.gz for non-native Debian package
I: pwd = "/path/to"
I: $ ln -sf debhello-2.1.tar.gz debhello_2.1.orig.tar.gz
I: pwd = "/path/to/debhello-2.1"
I: parse binary package settings: ,libsharedlib1,libsharedlib-dev
I: binary package=debhello Type=bin / Arch=any M-A=foreign
...</pre>
        <p>结果与 <a class="xref" href="ch08.zh-cn.html#configure-single" title="8.8. Makefile.in + configure（单个二进制软件包）">第 8.8 节 “Makefile.in + configure（单个二进制软件包）”</a> 中的类似，但是并不完全一致。</p>
        <p>让我们来检查一下自动产生的模板文件。</p>
        <p><strong><span class="strong"><strong>debian/rules</strong></span>（模板文件，v=2.1）：. </strong>
</p>
        <pre class="screen"> $ cat debhello-2.1/debian/rules
#!/usr/bin/make -f
# You must remove unused comment lines for the released package.
#export DH_VERBOSE = 1
#export DEB_BUILD_MAINT_OPTIONS = hardening=+all
#export DEB_CFLAGS_MAINT_APPEND  = -Wall -pedantic
#export DEB_LDFLAGS_MAINT_APPEND = -Wl,--as-needed

%:
        dh $@

#override_dh_auto_configure:
#       dh_auto_configure -- \
#             -DCMAKE_LIBRARY_ARCHITECTURE="$(DEB_TARGET_MULTIARCH)"</pre>
        <p>
</p>
        <p>作为维护者，我们要把这个 Debian 软件包做得更好。</p>
        <p><strong><span class="strong"><strong>debian/rules</strong></span>（维护者版本，v=2.1）：. </strong>
</p>
        <pre class="screen"> $ vim debhello-2.1/debian/rules
 ... hack, hack, hack, ...
 $ cat debhello-2.1/debian/rules
#!/usr/bin/make -f
export DH_VERBOSE = 1
export DEB_BUILD_MAINT_OPTIONS = hardening=+all
export DEB_CFLAGS_MAINT_APPEND  = -Wall -pedantic
export DEB_LDFLAGS_MAINT_APPEND = -Wl,--as-needed
DEB_HOST_MULTIARCH ?= $(shell dpkg-architecture -qDEB_HOST_MULTIARCH)

%:
        dh $@

override_dh_auto_configure:
        dh_auto_configure -- \
              -DCMAKE_LIBRARY_ARCHITECTURE="$(DEB_HOST_MULTIARCH)"

override_dh_install:
        dh_install --list-missing</pre>
        <p>
</p>
        <p><strong><span class="strong"><strong>debian/control</strong></span>（维护者版本，v=2.1）：. </strong>
</p>
        <pre class="screen"> $ vim debhello-2.1/debian/control
 ... hack, hack, hack, ...
 $ cat debhello-2.1/debian/control
Source: debhello
Section: devel
Priority: optional
Maintainer: Osamu Aoki &lt;osamu@debian.org&gt;
Build-Depends: cmake, debhelper (&gt;=11~)
Standards-Version: 4.3.0
Homepage: https://salsa.debian.org/debian/debmake-doc

Package: debhello
Architecture: any
Multi-Arch: foreign
Depends: libsharedlib1 (= ${binary:Version}),
         ${misc:Depends},
         ${shlibs:Depends}
Description: example executable package
 This is an example package to demonstrate Debian packaging using
 the debmake command.
 .
 The generated Debian package uses the dh command offered by the
 debhelper package and the dpkg source format `3.0 (quilt)'.
 .
 This package provides the executable program.

Package: libsharedlib1
Section: libs
Architecture: any
Multi-Arch: same
Pre-Depends: ${misc:Pre-Depends}
Depends: ${misc:Depends}, ${shlibs:Depends}
Description: example shared library package
 This is an example package to demonstrate Debian packaging using
 the debmake command.
 .
 The generated Debian package uses the dh command offered by the
 debhelper package and the dpkg source format `3.0 (quilt)'.
 .
 This package contains the shared library.

Package: libsharedlib-dev
Section: libdevel
Architecture: any
Multi-Arch: same
Depends: libsharedlib1 (= ${binary:Version}), ${misc:Depends}
Description: example development package
 This is an example package to demonstrate Debian packaging using
 the debmake command.
 .
 The generated Debian package uses the dh command offered by the
 debhelper package and the dpkg source format `3.0 (quilt)'.
 .
 This package contains the development files.</pre>
        <p>
</p>
        <p><strong><span class="strong"><strong>debian/*.install</strong></span>（维护者版本，v=2.1）：. </strong>
</p>
        <pre class="screen"> $ vim debhello-2.1/debian/debhello.install
 ... hack, hack, hack, ...
 $ cat debhello-2.1/debian/debhello.install
usr/bin/*
usr/share/man/*
 $ vim debhello-2.1/debian/libsharedlib1.install
 ... hack, hack, hack, ...
 $ cat debhello-2.1/debian/libsharedlib1.install
usr/lib/*/*.so.*
 $ vim debhello-2.1/debian/libsharedlib-dev.install
 ... hack, hack, hack, ...
 $ cat debhello-2.1/debian/libsharedlib-dev.install
###usr/lib/*/pkgconfig/*.pc
usr/include
usr/lib/*/*.so</pre>
        <p>
</p>
        <p>需要对上游的 CMakeList.txt 进行修补，以便应对多架构的路径。</p>
        <p><strong><span class="strong"><strong>debian/patches/</strong></span>*（维护者版本，v=2.1）：. </strong>
</p>
        <pre class="screen"> ... hack, hack, hack, ...
 $ cat debhello-2.1/debian/libsharedlib1.symbols
libsharedlib.so.1 libsharedlib1 #MINVER#
 sharedlib@Base 2.1</pre>
        <p>
</p>
        <p>因为上游源码已经具有正确的自动生成的 <span class="strong"><strong>Makefile</strong></span> 文件，所以没有必要再去创建 <span class="strong"><strong>debian/install</strong></span> 和 <span class="strong"><strong>debian/manpages</strong></span> 文件。</p>
        <p>在 <span class="strong"><strong>debian/</strong></span> 目录下还有一些其它的模板文件。它们也需要进行更新。</p>
        <p><strong><span class="strong"><strong>debian/</strong></span> 目录下的模板文件。（v=2.1）：. </strong>
</p>
        <pre class="screen"> $ tree debhello-2.1/debian
debhello-2.1/debian
├── README.Debian
├── changelog
├── compat
├── control
├── copyright
├── debhello.install
├── libsharedlib-dev.install
├── libsharedlib1.install
├── libsharedlib1.symbols
├── patches
│   ├── 000-cmake-multiarch.patch
│   └── series
├── rules
├── source
│   ├── format
│   └── local-options
└── watch

2 directories, 15 files</pre>
        <p>
</p>
        <p>其余的打包工作与 <a class="xref" href="ch08.zh-cn.html#configure-single" title="8.8. Makefile.in + configure（单个二进制软件包）">第 8.8 节 “Makefile.in + configure（单个二进制软件包）”</a> 中的近乎一致。</p>
        <p>此处是生成的二进制包的依赖项列表。</p>
        <p><strong>生成的二进制包的依赖项列表（v=2.1）：. </strong>
</p>
        <pre class="screen"> $ dpkg -f debhello-dbgsym_2.1-1_amd64.deb pre-depends depends recommends con...
Depends: debhello (= 2.1-1)
 $ dpkg -f debhello_2.1-1_amd64.deb pre-depends depends recommends conflicts ...
Depends: libsharedlib1 (= 2.1-1), libc6 (&gt;= 2.2.5)
 $ dpkg -f libsharedlib-dev_2.1-1_amd64.deb pre-depends depends recommends co...
Depends: libsharedlib1 (= 2.1-1)
 $ dpkg -f libsharedlib1-dbgsym_2.1-1_amd64.deb pre-depends depends recommend...
Depends: libsharedlib1 (= 2.1-1)
 $ dpkg -f libsharedlib1_2.1-1_amd64.deb pre-depends depends recommends confl...
Depends: libc6 (&gt;= 2.2.5)</pre>
        <p>
</p>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="i18n-example"/>8.13. 国际化</h2>
            </div>
          </div>
        </div>
        <p>此处是更新 <a class="xref" href="ch08.zh-cn.html#autotools-multi" title="8.11. Autotools（多个二进制软件包）">第 8.11 节 “Autotools（多个二进制软件包）”</a> 中提供的简单上游 C 语言源代码 <span class="strong"><strong>debhello-2.0.tar.gz</strong></span> 以便进行国际化（i18n）并创建更新后的上游 C 语言源代码 <span class="strong"><strong>debhello-2.0.tar.gz</strong></span> 的示例。</p>
        <p>在实际情况中，此软件包应该已被国际化过。所以此示例用作帮助您了解国际化的具体实现方法。</p>
        <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">
          <table border="0" summary="Tip">
            <tr>
              <td rowspan="2" align="center" valign="top">
                <img alt="[提示]" src="images/tip.png"/>
              </td>
              <th align="left">提示</th>
            </tr>
            <tr>
              <td align="left" valign="top">
                <p>负责维护国际化的维护者的日常活动就是将通过缺陷追踪系统（BTS）反馈给您的 po 翻译文件添加至 <span class="strong"><strong>po/</strong></span> 目录，然后更新 <span class="strong"><strong>po/LINGUAS</strong></span> 文件的语言列表。</p>
              </td>
            </tr>
          </table>
        </div>
        <p>让我们取得源码并制作 Debian 软件包。</p>
        <p><strong>下载 <span class="strong"><strong>debhello-2.0.tar.gz</strong></span>（国际化版）. </strong>
</p>
        <pre class="screen"> $ wget http://www.example.org/download/debhello-2.0.tar.gz
 ...
 $ tar -xzmf debhello-2.0.tar.gz
 $ tree
.
├── debhello-2.0
│   ├── Makefile.am
│   ├── configure.ac
│   ├── data
│   │   ├── hello.desktop
│   │   └── hello.png
│   ├── lib
│   │   ├── Makefile.am
│   │   ├── sharedlib.c
│   │   └── sharedlib.h
│   ├── man
│   │   ├── Makefile.am
│   │   └── hello.1
│   └── src
│       ├── Makefile.am
│       └── hello.c
└── debhello-2.0.tar.gz

5 directories, 12 files</pre>
        <p>
</p>
        <p>使用 <span class="strong"><strong>gettextize</strong></span> 命令将此源代码树国际化，并删除由 Autotools 自动生成的文件。</p>
        <p><strong>运行 <span class="strong"><strong>gettextize</strong></span>（国际化版）：. </strong>
</p>
        <pre class="screen"> $ cd debhello-2.0
 $ gettextize
Creating po/ subdirectory
Creating build-aux/ subdirectory
Copying file ABOUT-NLS
Copying file build-aux/config.rpath
Not copying intl/ directory.
Copying file po/Makefile.in.in
Copying file po/Makevars.template
Copying file po/Rules-quot
Copying file po/boldquot.sed
Copying file po/en@boldquot.header
Copying file po/en@quot.header
Copying file po/insert-header.sin
Copying file po/quot.sed
Copying file po/remove-potcdate.sin
Creating initial po/POTFILES.in
Creating po/ChangeLog
Creating directory m4
Copying file m4/gettext.m4
Copying file m4/iconv.m4
Copying file m4/lib-ld.m4
Copying file m4/lib-link.m4
Copying file m4/lib-prefix.m4
Copying file m4/nls.m4
Copying file m4/po.m4
Copying file m4/progtest.m4
Creating m4/ChangeLog
Updating Makefile.am (backup is in Makefile.am~)
Updating configure.ac (backup is in configure.ac~)
Creating ChangeLog

Please use AM_GNU_GETTEXT([external]) in order to cause autoconfiguration
to look for an external libintl.

Please create po/Makevars from the template in po/Makevars.template.
You can then remove po/Makevars.template.

Please fill po/POTFILES.in as described in the documentation.

Please run 'aclocal' to regenerate the aclocal.m4 file.
You need aclocal from GNU automake 1.9 (or newer) to do this.
Then run 'autoconf' to regenerate the configure file.

You will also need config.guess and config.sub, which you can get from the CV...
of the 'config' project at http://savannah.gnu.org/. The commands to fetch th...
are
$ wget 'http://savannah.gnu.org/cgi-bin/viewcvs/*checkout*/config/config/conf...
$ wget 'http://savannah.gnu.org/cgi-bin/viewcvs/*checkout*/config/config/conf...

You might also want to copy the convenience header file gettext.h
from the /usr/share/gettext directory into your package.
It is a wrapper around &lt;libintl.h&gt; that implements the configure --disable-nl...
option.

Press Return to acknowledge the previous 6 paragraphs.
 $ rm -rf m4 build-aux *~</pre>
        <p>
</p>
        <p>让我们确认一下 <span class="strong"><strong>po/</strong></span> 目录下生成的文件。</p>
        <p><strong><span class="strong"><strong>po</strong></span> 目录下的文件（国际化版）：. </strong>
</p>
        <pre class="screen"> $ ls -l po
/build/debmake-doc-UII19c/debmake-doc-1.14/debhello-2.0-pkg2/step151.cmd: 2: ...
total 60
-rw-rw-r-- 1 hosiet hosiet   494 Sep  7 19:23 ChangeLog
-rw-r--r-- 1 hosiet hosiet 17577 Sep  7 19:23 Makefile.in.in
-rw-r--r-- 1 hosiet hosiet  3376 Sep  7 19:23 Makevars.template
-rw-rw-r-- 1 hosiet hosiet    59 Sep  7 19:23 POTFILES.in
-rw-r--r-- 1 hosiet hosiet  2203 Sep  7 19:23 Rules-quot
-rw-r--r-- 1 hosiet hosiet   217 Sep  7 19:23 boldquot.sed
-rw-r--r-- 1 hosiet hosiet  1337 Sep  7 19:23 en@boldquot.header
-rw-r--r-- 1 hosiet hosiet  1203 Sep  7 19:23 en@quot.header
-rw-r--r-- 1 hosiet hosiet   672 Sep  7 19:23 insert-header.sin
-rw-r--r-- 1 hosiet hosiet   153 Sep  7 19:23 quot.sed
-rw-r--r-- 1 hosiet hosiet   432 Sep  7 19:23 remove-potcdate.sin</pre>
        <p>
</p>
        <p>让我们在 <span class="strong"><strong>configure.ac</strong></span> 文件中添加 “<span class="strong"><strong>AM_GNU_GETTEXT([external])</strong></span>” 等条目。</p>
        <p><strong><span class="strong"><strong>configure.ac</strong></span>（国际化版）：. </strong>
</p>
        <pre class="screen"> $ vim configure.ac
 ... hack, hack, hack, ...
 $ cat configure.ac
#                                               -*- Autoconf -*-
# Process this file with autoconf to produce a configure script.
AC_PREREQ([2.69])
AC_INIT([debhello],[2.2],[foo@example.org])
AC_CONFIG_SRCDIR([src/hello.c])
AC_CONFIG_HEADERS([config.h])
echo "Standard customization chores"
AC_CONFIG_AUX_DIR([build-aux])

AM_INIT_AUTOMAKE([foreign])

# Set default to --enable-shared --disable-static
LT_INIT([shared disable-static])

# find the libltdl sources in the libltdl sub-directory
LT_CONFIG_LTDL_DIR([libltdl])

# choose one
LTDL_INIT([recursive])
#LTDL_INIT([subproject])
#LTDL_INIT([nonrecursive])

# Add #define PACKAGE_AUTHOR ... in config.h with a comment
AC_DEFINE(PACKAGE_AUTHOR, ["Osamu Aoki"], [Define PACKAGE_AUTHOR])
# Checks for programs.
AC_PROG_CC

# desktop file support required
AM_GNU_GETTEXT_VERSION([0.19.3])
AM_GNU_GETTEXT([external])

# only for the recursive case
AC_CONFIG_FILES([Makefile
                 po/Makefile.in
                 lib/Makefile
                 man/Makefile
                 src/Makefile])
AC_OUTPUT</pre>
        <p>
</p>
        <p>让我们从 <span class="strong"><strong>po/Makevars.template</strong></span> 文件中创建 <span class="strong"><strong>po/Makevars</strong></span> 文件。</p>
        <p><strong><span class="strong"><strong>po/Makevars</strong></span>（国际化版）：. </strong>
</p>
        <pre class="screen"> ... hack, hack, hack, ...
 $ diff -u po/Makevars.template po/Makevars
--- po/Makevars.template        2019-03-14 19:18:03.970235562 +0000
+++ po/Makevars 2019-03-14 19:18:06.522250356 +0000
@@ -18,14 +18,14 @@
 # or entity, or to disclaim their copyright.  The empty string stands for
 # the public domain; in this case the translators are expected to disclaim
 # their copyright.
-COPYRIGHT_HOLDER = Free Software Foundation, Inc.
+COPYRIGHT_HOLDER = Osamu Aoki &lt;osamu@debian.org&gt;

 # This tells whether or not to prepend "GNU " prefix to the package
 # name that gets inserted into the header of the $(DOMAIN).pot file.
 # Possible values are "yes", "no", or empty.  If it is empty, try to
 # detect it automatically by scanning the files in $(top_srcdir) for
 # "GNU packagename" string.
-PACKAGE_GNU =
+PACKAGE_GNU = no

 # This is the email address or URL to which the translators shall report
 # bugs in the untranslated strings:
 $ rm po/Makevars.template</pre>
        <p>
</p>
        <p>让我们通过用 <span class="strong"><strong>_(…)</strong></span> 包裹字符串的方式来更新国际化版本的 C 语言源代码。</p>
        <p><strong><span class="strong"><strong>src/hello.c</strong></span> （国际化版）：. </strong>
</p>
        <pre class="screen"> ... hack, hack, hack, ...
 $ cat src/hello.c
#include "config.h"
#include &lt;stdio.h&gt;
#include &lt;sharedlib.h&gt;
#define _(string) gettext (string)
int
main()
{
        printf(_("Hello, I am " PACKAGE_AUTHOR "!\n"));
        sharedlib();
        return 0;
}</pre>
        <p>
</p>
        <p><strong><span class="strong"><strong>lib/sharedlib.c</strong></span>（国际化版）：. </strong>
</p>
        <pre class="screen"> ... hack, hack, hack, ...
 $ cat lib/sharedlib.c
#include &lt;stdio.h&gt;
#define _(string) gettext (string)
int
sharedlib()
{
        printf(_("This is a shared library!\n"));
        return 0;
}</pre>
        <p>
</p>
        <p>新版本的 <span class="strong"><strong>gettext</strong></span>（v = 0.19）可以直接处理桌面文件的国际化版本。</p>
        <p><strong><span class="strong"><strong>data/hello.desktop.in</strong></span>（国际化版）：. </strong>
</p>
        <pre class="screen"> $ fgrep -v '[ja]=' data/hello.desktop &gt; data/hello.desktop.in
 $ rm data/hello.desktop
 $ cat data/hello.desktop.in
[Desktop Entry]
Name=Hello
Comment=Greetings
Type=Application
Keywords=hello
Exec=hello
Terminal=true
Icon=hello.png
Categories=Utility;</pre>
        <p>
</p>
        <p>让我们列出输入文件，以便在 <span class="strong"><strong>po/POTFILES.in</strong></span> 中提取可翻译的字符串。</p>
        <p><strong><span class="strong"><strong>po/POTFILES.in</strong></span>（国际化版）：. </strong>
</p>
        <pre class="screen"> ... hack, hack, hack, ...
 $ cat po/POTFILES.in
src/hello.c
lib/sharedlib.c
data/hello.desktop.in</pre>
        <p>
</p>
        <p>此处是在 <span class="strong"><strong>SUBDIRS</strong></span> 环境变量中添加 <span class="strong"><strong>po</strong></span> 目录后更新过的根 <span class="strong"><strong>Makefile.am</strong></span> 文件。</p>
        <p><strong><span class="strong"><strong>Makefile.am</strong></span> （国际化版）：. </strong>
</p>
        <pre class="screen"> $ cat Makefile.am
# recursively process `Makefile.am` in SUBDIRS
SUBDIRS = po lib src man

ACLOCAL_AMFLAGS = -I m4

EXTRA_DIST = build-aux/config.rpath m4/ChangeLog</pre>
        <p>
</p>
        <p>让我们创建一个翻译模板文件 <span class="strong"><strong>debhello.pot</strong></span>。</p>
        <p><strong><span class="strong"><strong>po/debhello.pot</strong></span>（国际化版）：. </strong>
</p>
        <pre class="screen"> $ xgettext -f po/POTFILES.in -d debhello -o po/debhello.pot -k_
 $ cat po/debhello.pot
# SOME DESCRIPTIVE TITLE.
# Copyright (C) YEAR THE PACKAGE'S COPYRIGHT HOLDER
# This file is distributed under the same license as the PACKAGE package.
# FIRST AUTHOR &lt;EMAIL@ADDRESS&gt;, YEAR.
#
#, fuzzy
msgid ""
msgstr ""
"Project-Id-Version: PACKAGE VERSION\n"
"Report-Msgid-Bugs-To: \n"
"POT-Creation-Date: 2019-03-14 19:18+0000\n"
"PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
"Last-Translator: FULL NAME &lt;EMAIL@ADDRESS&gt;\n"
"Language-Team: LANGUAGE &lt;LL@li.org&gt;\n"
"Language: \n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=CHARSET\n"
"Content-Transfer-Encoding: 8bit\n"

#: src/hello.c:8
#, c-format
msgid "Hello, I am "
msgstr ""

#: lib/sharedlib.c:6
#, c-format
msgid "This is a shared library!\n"
msgstr ""

#: data/hello.desktop.in:3
msgid "Hello"
msgstr ""

#: data/hello.desktop.in:4
msgid "Greetings"
msgstr ""

#: data/hello.desktop.in:6
msgid "hello"
msgstr ""

#: data/hello.desktop.in:9
msgid "hello.png"
msgstr ""</pre>
        <p>
</p>
        <p>让我们添加法语的翻译。</p>
        <p><strong><span class="strong"><strong>po/LINGUAS</strong></span> 与 <span class="strong"><strong>po/fr.po</strong></span>（国际化版）：. </strong>
</p>
        <pre class="screen"> $ echo 'fr' &gt; po/LINGUAS
 $ cp po/debhello.pot po/fr.po
 $ vim po/fr.po
 ... hack, hack, hack, ...
 $ cat po/fr.po
# SOME DESCRIPTIVE TITLE.
# This file is put in the public domain.
# FIRST AUTHOR &lt;EMAIL@ADDRESS&gt;, YEAR.
#
msgid ""
msgstr ""
"Project-Id-Version: debhello 2.2\n"
"Report-Msgid-Bugs-To: foo@example.org\n"
"POT-Creation-Date: 2015-03-01 20:22+0900\n"
"PO-Revision-Date: 2015-02-21 23:18+0900\n"
"Last-Translator: Osamu Aoki &lt;osamu@debian.org&gt;\n"
"Language-Team: French &lt;LL@li.org&gt;\n"
"Language: ja\n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=UTF-8\n"
"Content-Transfer-Encoding: 8bit\n"

#: src/hello.c:34
#, c-format
msgid "Hello, my name is %s!\n"
msgstr "Bonjour, je m'appelle %s!\n"

#: lib/sharedlib.c:29
#, c-format
msgid "This is a shared library!\n"
msgstr "Ceci est une bibliothèque partagée!\n"

#: data/hello.desktop.in:3
msgid "Hello"
msgstr ""

#: data/hello.desktop.in:4
msgid "Greetings"
msgstr "Salutations"

#: data/hello.desktop.in:6
msgid "hello"
msgstr ""

#: data/hello.desktop.in:9
msgid "hello.png"
msgstr ""</pre>
        <p>
</p>
        <p>打包工作与 <a class="xref" href="ch08.zh-cn.html#autotools-multi" title="8.11. Autotools（多个二进制软件包）">第 8.11 节 “Autotools（多个二进制软件包）”</a> 中的近乎一致。</p>
        <p>您可以在 <a class="xref" href="ch08.zh-cn.html#details" title="8.14. 细节">第 8.14 节 “细节”</a> 中寻找更多国际化的例子：</p>
        <div class="itemizedlist">
          <ul class="itemizedlist">
            <li class="listitem">带有Makefile 的 POSIX shell 脚本（v=3.0），</li>
            <li class="listitem">带有 distutils 的 Python3 脚本 （v=3.1），</li>
            <li class="listitem">带有 Makefile.in + configure 的 C 语言源代码（v=3.2），</li>
            <li class="listitem">带有 Autotools 的 C 语言源代码（v=3.3），以及</li>
            <li class="listitem">带有 CMake 的 C 语言源代码（v=3.4）。</li>
          </ul>
        </div>
      </div>
      <div class="section">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title"><a id="details"/>8.14. 细节</h2>
            </div>
          </div>
        </div>
        <p>所示示例的实际细节及其变体可通过以下方式获得。</p>
        <p><strong>如何取得细节. </strong>
</p>
        <pre class="screen"> $ apt-get source debmake-doc
 $ sudo apt-get install devscripts build-essentials
 $ cd debmake-doc*
 $ sudo apt-get build-dep ./
 $ make</pre>
        <p>
</p>
        <p>带 <span class="strong"><strong>-pkg[0-9]</strong></span> 后缀的每个目录都包含 Debian 打包示例。</p>
        <div class="itemizedlist">
          <ul class="itemizedlist">
            <li class="listitem">模拟控制台命令行活动日志：<span class="strong"><strong>.log</strong></span> 文件</li>
            <li class="listitem">模拟控制台命令行活动日志（缩略版）：<span class="strong"><strong>.slog</strong></span> 文件</li>
            <li class="listitem">执行 <span class="strong"><strong>debmake</strong></span> 命令后的源码树快照：<span class="strong"><strong>debmake</strong></span> 目录</li>
            <li class="listitem">打包后的源码树快照：<span class="strong"><strong>packge</strong></span> 目录</li>
            <li class="listitem">执行 <span class="strong"><strong>debuild</strong></span> 命令后的源码树快照：<span class="strong"><strong>test</strong></span> 目录</li>
          </ul>
        </div>
      </div>
    </div>
    <div class="navfooter">
      <hr/>
      <table width="100%" summary="Navigation footer">
        <tr>
          <td align="left"><a accesskey="p" href="ch07.zh-cn.html"><img src="images/prev.png" alt="上一页"/></a> </td>
          <td align="center"> </td>
          <td align="right"> <a accesskey="n" href="apa.zh-cn.html"><img src="images/next.png" alt="下一页"/></a></td>
        </tr>
        <tr>
          <td align="left" valign="top">第 7 章 提示 </td>
          <td align="center">
            <a accesskey="h" href="index.zh-cn.html">
              <img src="images/home.png" alt="起始页"/>
            </a>
          </td>
          <td align="right" valign="top"> 附录 A. <span class="strong"><strong>debmake</strong></span>(1) 手册页</td>
        </tr>
      </table>
    </div>
  </body>
</html>
